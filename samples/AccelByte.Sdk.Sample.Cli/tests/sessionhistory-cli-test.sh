#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 
# - template file: 

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..3"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 CreateXrayTicketObservability
# body param: body
echo '{"action": "chvKIvLo", "activeAllianceRule": {"max_number": 59, "min_number": 76, "player_max_number": 48, "player_min_number": 34}, "activeMatchingRule": [{"attribute": "CClJHuZh", "criteria": "OqzkY2AG", "reference": 0.32391955878270673}, {"attribute": "i0p3aM1i", "criteria": "gwXnemjW", "reference": 0.09759242564043136}, {"attribute": "n0WG4r2O", "criteria": "V3ewT3Ls", "reference": 0.1015454934264024}], "function": "7dUQRw31", "gameMode": "95IIYrD3", "isBackfillMatch": true, "isRuleSetFlexed": false, "iteration": 37, "matchID": "GcxSlYJq", "namespace": "IOjk0RBr", "remainingPlayersPerTicket": [24, 60, 40], "remainingTickets": 83, "sessionTickID": "8UdADpXr", "tickID": 68, "ticketID": "aAR14dRZ", "timeToMatchSec": 0.9604096463382324, "timestamp": "1985-12-31T00:00:00Z", "unbackfillReason": "yMpsbj9i", "unmatchReason": "oJm4qFPc"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn sessionhistory \
    --op CreateXrayTicketObservability \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 2 'CreateXrayTicketObservability' test.out

#- 3 CreateXrayBulkTicketObservability
# body param: body
echo '{"ticketObservabilities": [{"action": "GzNbdkOY", "activeAllianceRule": {"max_number": 46, "min_number": 51, "player_max_number": 26, "player_min_number": 55}, "activeMatchingRule": [{"attribute": "aCeo0kcE", "criteria": "Jd2qKtTi", "reference": 0.40637306285612707}, {"attribute": "18BKBjB4", "criteria": "3luDB02s", "reference": 0.04618095311997217}, {"attribute": "QztikCB7", "criteria": "8Aj2mLaS", "reference": 0.24092731711117976}], "function": "5yx5yI0C", "gameMode": "ElxDchNM", "isBackfillMatch": false, "isRuleSetFlexed": true, "iteration": 68, "matchID": "VXF8iUu9", "namespace": "ow7E0eyP", "remainingPlayersPerTicket": [86, 57, 2], "remainingTickets": 59, "sessionTickID": "RmDYUr9i", "tickID": 25, "ticketID": "gl15Etml", "timeToMatchSec": 0.6640921312351191, "timestamp": "1979-03-09T00:00:00Z", "unbackfillReason": "cHCB18F2", "unmatchReason": "Ou40otR6"}, {"action": "SVOXL6dD", "activeAllianceRule": {"max_number": 99, "min_number": 98, "player_max_number": 78, "player_min_number": 19}, "activeMatchingRule": [{"attribute": "ZDYGGD2F", "criteria": "0DJs5skT", "reference": 0.5426928282299549}, {"attribute": "NIbsGOnk", "criteria": "jbS4lIdg", "reference": 0.996187236804249}, {"attribute": "LrlEYY6X", "criteria": "czmERUit", "reference": 0.8280582387808353}], "function": "hSlgd1lP", "gameMode": "gzrNBKrY", "isBackfillMatch": false, "isRuleSetFlexed": true, "iteration": 91, "matchID": "O6qVxfoE", "namespace": "g4IbpI9U", "remainingPlayersPerTicket": [16, 97, 21], "remainingTickets": 56, "sessionTickID": "Wgs4y8qj", "tickID": 6, "ticketID": "7oStd4Fm", "timeToMatchSec": 0.6175619409614457, "timestamp": "1979-10-02T00:00:00Z", "unbackfillReason": "eCsg48Bi", "unmatchReason": "XvEgupml"}, {"action": "7G8c0mC9", "activeAllianceRule": {"max_number": 24, "min_number": 81, "player_max_number": 69, "player_min_number": 42}, "activeMatchingRule": [{"attribute": "RTEabphM", "criteria": "7wthafyp", "reference": 0.2751289920028811}, {"attribute": "N9MrZ68o", "criteria": "KI47ptOs", "reference": 0.651037786917675}, {"attribute": "PaQyeP9N", "criteria": "Nv3PS3xA", "reference": 0.45166629117802115}], "function": "bIzJy4CE", "gameMode": "7VzinjGK", "isBackfillMatch": false, "isRuleSetFlexed": false, "iteration": 11, "matchID": "RI8gheDU", "namespace": "6dMtfdh1", "remainingPlayersPerTicket": [5, 18, 53], "remainingTickets": 77, "sessionTickID": "qFWGC1pJ", "tickID": 89, "ticketID": "KXdbXuFo", "timeToMatchSec": 0.4558744545756942, "timestamp": "1972-09-10T00:00:00Z", "unbackfillReason": "TOdjGbeW", "unmatchReason": "BWcS0sRp"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn sessionhistory \
    --op CreateXrayBulkTicketObservability \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 3 'CreateXrayBulkTicketObservability' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE