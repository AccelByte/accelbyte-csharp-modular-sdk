#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 
# - template file: 

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..3"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 CreateXrayTicketObservability
# body param: body
echo '{"action": "vRpIb8JC", "activeAllianceRule": {"max_number": 21, "min_number": 35, "player_max_number": 58, "player_min_number": 95}, "activeMatchingRule": [{"attribute": "9GcM68ck", "criteria": "nor6cxGq", "reference": 0.34152233272992516}, {"attribute": "PcrZ5ivS", "criteria": "uoZBmG9T", "reference": 0.395784753698046}, {"attribute": "JpP7K1MV", "criteria": "KqW2JFJ8", "reference": 0.3824268690566628}], "function": "uqCHExSl", "gameMode": "0MtsLbqr", "isBackfillMatch": true, "isRuleSetFlexed": false, "iteration": 41, "matchID": "k4DpOlw4", "namespace": "hkh732AO", "remainingPlayersPerTicket": [60, 51, 27], "remainingTickets": 40, "sessionTickID": "z7u6Nuyy", "tickID": 31, "ticketID": "cxxwNt1a", "timeToMatchSec": 0.6665041531711349, "timestamp": "1978-08-27T00:00:00Z", "unbackfillReason": "ffsJp4do", "unmatchReason": "Vxp4WLPm"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn sessionhistory \
    --op CreateXrayTicketObservability \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 2 'CreateXrayTicketObservability' test.out

#- 3 CreateXrayBulkTicketObservability
# body param: body
echo '{"ticketObservabilities": [{"action": "yvAxsGoq", "activeAllianceRule": {"max_number": 41, "min_number": 44, "player_max_number": 49, "player_min_number": 43}, "activeMatchingRule": [{"attribute": "bHTLBNFL", "criteria": "BTu4XYlQ", "reference": 0.6145903242740961}, {"attribute": "qpauiTpw", "criteria": "FtLECDuE", "reference": 0.876721770338731}, {"attribute": "D8gS05AP", "criteria": "NREWkcGs", "reference": 0.7568413430831693}], "function": "7nBebl4I", "gameMode": "7EINEMQn", "isBackfillMatch": true, "isRuleSetFlexed": false, "iteration": 67, "matchID": "IXEos518", "namespace": "m4cbyT7q", "remainingPlayersPerTicket": [67, 10, 23], "remainingTickets": 8, "sessionTickID": "tpq3nY2i", "tickID": 82, "ticketID": "kW3LLdsc", "timeToMatchSec": 0.6035528050857548, "timestamp": "1996-11-01T00:00:00Z", "unbackfillReason": "kekFfREa", "unmatchReason": "v5PxPBVI"}, {"action": "3bCD7jLd", "activeAllianceRule": {"max_number": 65, "min_number": 81, "player_max_number": 36, "player_min_number": 86}, "activeMatchingRule": [{"attribute": "dwI6LFKL", "criteria": "1lwg5trz", "reference": 0.9125218907504359}, {"attribute": "CQWAJgUZ", "criteria": "TmVWXwGp", "reference": 0.4051015038909438}, {"attribute": "zzI3XTFr", "criteria": "xhZWv081", "reference": 0.1948591169391497}], "function": "a1TFP4Ej", "gameMode": "pezBEYQa", "isBackfillMatch": false, "isRuleSetFlexed": false, "iteration": 68, "matchID": "rXimv38H", "namespace": "06k2YUnT", "remainingPlayersPerTicket": [7, 56, 19], "remainingTickets": 70, "sessionTickID": "0ecyXuLx", "tickID": 75, "ticketID": "T3jP1Cjr", "timeToMatchSec": 0.988637600173288, "timestamp": "1993-01-13T00:00:00Z", "unbackfillReason": "PU4y5GW5", "unmatchReason": "mrfoaDey"}, {"action": "FT7iMGN1", "activeAllianceRule": {"max_number": 91, "min_number": 72, "player_max_number": 71, "player_min_number": 38}, "activeMatchingRule": [{"attribute": "dfikMR2Q", "criteria": "oVKV2GYH", "reference": 0.22511454310600143}, {"attribute": "XQhTx3Xx", "criteria": "cYOh4Ykv", "reference": 0.05772868267418052}, {"attribute": "PfIxwmff", "criteria": "POcv7oP7", "reference": 0.08929878574440753}], "function": "mEq4r5Q9", "gameMode": "qEcS8q1L", "isBackfillMatch": false, "isRuleSetFlexed": true, "iteration": 0, "matchID": "JBhhWhyH", "namespace": "hgsbHrx4", "remainingPlayersPerTicket": [69, 15, 33], "remainingTickets": 77, "sessionTickID": "c8oGScF5", "tickID": 21, "ticketID": "H5ZAprZA", "timeToMatchSec": 0.6655704638012293, "timestamp": "1990-08-25T00:00:00Z", "unbackfillReason": "8oSRXhld", "unmatchReason": "gwxlYWtX"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn sessionhistory \
    --op CreateXrayBulkTicketObservability \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 3 'CreateXrayBulkTicketObservability' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE