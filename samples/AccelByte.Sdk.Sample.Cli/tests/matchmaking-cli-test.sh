#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 
# - template file: 

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..39"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 GetHealthcheckInfo
$CLI_EXE \
    --sn matchmaking \
    --op GetHealthcheckInfo \
    > test.out 2>&1
eval_tap $? 2 'GetHealthcheckInfo' test.out

#- 3 HandlerV3Healthz
$CLI_EXE \
    --sn matchmaking \
    --op HandlerV3Healthz \
    > test.out 2>&1
eval_tap $? 3 'HandlerV3Healthz' test.out

#- 4 GetAllChannelsHandler
$CLI_EXE \
    --sn matchmaking \
    --op GetAllChannelsHandler \
    --namespace $AB_NAMESPACE \
    --limit '55' \
    --offset '47' \
    > test.out 2>&1
eval_tap $? 4 'GetAllChannelsHandler' test.out

#- 5 CreateChannelHandler
# body param: body
echo '{"deployment": "b206m8In", "description": "N98XKK3H", "find_match_timeout_seconds": 15, "game_mode": "GNjwCv9i", "joinable": false, "max_delay_ms": 47, "region_expansion_range_ms": 36, "region_expansion_rate_ms": 84, "region_latency_initial_range_ms": 51, "region_latency_max_ms": 3, "rule_set": {"alliance": {"combination": {"alliances": [[{"max": 36, "min": 48, "name": "oAAoAQ9i"}, {"max": 83, "min": 14, "name": "iWNScSOY"}, {"max": 52, "min": 28, "name": "r0YI0vhx"}], [{"max": 52, "min": 76, "name": "ztAMsq8J"}, {"max": 76, "min": 54, "name": "mstW0Mz5"}, {"max": 68, "min": 67, "name": "X4lcntET"}], [{"max": 41, "min": 86, "name": "n2VerydY"}, {"max": 98, "min": 97, "name": "52wIZATr"}, {"max": 80, "min": 25, "name": "jeK5Mody"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 46, "role_flexing_second": 67}, "max_number": 39, "min_number": 17, "player_max_number": 83, "player_min_number": 53}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 90, "min": 16, "name": "ZA0iDr5r"}, {"max": 34, "min": 1, "name": "vZxQZVmd"}, {"max": 60, "min": 66, "name": "ET3vuPFY"}], [{"max": 100, "min": 87, "name": "arFGXdHe"}, {"max": 39, "min": 64, "name": "yOyNMvGm"}, {"max": 39, "min": 61, "name": "WddxX1tI"}], [{"max": 16, "min": 24, "name": "mOyRWwjt"}, {"max": 89, "min": 81, "name": "85KT5S2o"}, {"max": 0, "min": 62, "name": "MfjHcv04"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 5, "role_flexing_second": 54}, "duration": 4, "max_number": 15, "min_number": 99, "player_max_number": 26, "player_min_number": 24}, {"combination": {"alliances": [[{"max": 20, "min": 48, "name": "QSPtUdH4"}, {"max": 8, "min": 73, "name": "WPSATS7I"}, {"max": 58, "min": 9, "name": "BMLzqpO7"}], [{"max": 11, "min": 22, "name": "6FcdjwEo"}, {"max": 76, "min": 57, "name": "D9xRmulO"}, {"max": 62, "min": 41, "name": "PMHakoIw"}], [{"max": 59, "min": 85, "name": "c4fupD4n"}, {"max": 17, "min": 41, "name": "s1FwxFoM"}, {"max": 97, "min": 65, "name": "MAUzpSfM"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 60, "role_flexing_second": 69}, "duration": 67, "max_number": 92, "min_number": 100, "player_max_number": 71, "player_min_number": 36}, {"combination": {"alliances": [[{"max": 13, "min": 93, "name": "wWna8e5Y"}, {"max": 20, "min": 61, "name": "foviaZI1"}, {"max": 49, "min": 80, "name": "phclqlw5"}], [{"max": 78, "min": 12, "name": "Le6eHrD3"}, {"max": 96, "min": 81, "name": "zd0940KY"}, {"max": 24, "min": 68, "name": "hbCl6j2o"}], [{"max": 68, "min": 38, "name": "oNfFxfl5"}, {"max": 40, "min": 37, "name": "eTM4ZFTX"}, {"max": 27, "min": 30, "name": "cq3ajcRc"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 13, "role_flexing_second": 97}, "duration": 1, "max_number": 5, "min_number": 98, "player_max_number": 97, "player_min_number": 8}], "batch_size": 69, "bucket_mmr_rule": {"disable_authority": true, "flex_authority_count": 19, "flex_flat_step_range": 85, "flex_immunity_count": 90, "flex_range_max": 97, "flex_rate_ms": 99, "flex_step_max": 53, "force_authority_match": true, "initial_step_range": 87, "mmr_max": 27, "mmr_mean": 68, "mmr_min": 95, "mmr_std_dev": 34, "override_mmr_data": false, "use_bucket_mmr": true, "use_flat_flex_step": false}, "flexing_rule": [{"attribute": "TP1InsME", "criteria": "zIJDcCYh", "duration": 44, "reference": 0.5681240084249941}, {"attribute": "f9KRwrSa", "criteria": "XmWgh5EZ", "duration": 11, "reference": 0.3809600264018541}, {"attribute": "EwWHb0Jo", "criteria": "IN4YEQ5d", "duration": 76, "reference": 0.32807857188197176}], "match_options": {"options": [{"name": "zjYtcwpH", "type": "D6NPeYmc"}, {"name": "d0DQB6m2", "type": "LXJL64Pd"}, {"name": "qFsxDapR", "type": "aIXDtQr0"}]}, "matching_rule": [{"attribute": "lVWNMtId", "criteria": "Odr0jbma", "reference": 0.8940672948887908}, {"attribute": "1efVgCrQ", "criteria": "zrl7bcdP", "reference": 0.748123108357722}, {"attribute": "TsbRTKPn", "criteria": "QL46C7eO", "reference": 0.946435784201537}], "rebalance_enable": true, "sort_ticket": {"search_result": "largestPartySize", "ticket_queue": "random"}, "sort_tickets": [{"search_result": "largestPartySize", "threshold": 1, "ticket_queue": "random"}, {"search_result": "random", "threshold": 88, "ticket_queue": "largestPartySize"}, {"search_result": "distance", "threshold": 91, "ticket_queue": "distance"}], "sub_game_modes": {"5fWzgkFL": {"alliance": {"combination": {"alliances": [[{"max": 90, "min": 95, "name": "YoJawTeA"}, {"max": 31, "min": 72, "name": "EFajOqRQ"}, {"max": 30, "min": 99, "name": "66ofj3W4"}], [{"max": 27, "min": 41, "name": "OXItk5WA"}, {"max": 3, "min": 55, "name": "tjGxpf6e"}, {"max": 2, "min": 63, "name": "SGeA7Nj3"}], [{"max": 93, "min": 5, "name": "T3GmsQ04"}, {"max": 38, "min": 51, "name": "0MVzw43k"}, {"max": 82, "min": 32, "name": "cKhNKiP9"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 70, "role_flexing_second": 20}, "max_number": 43, "min_number": 18, "player_max_number": 76, "player_min_number": 93}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 29, "min": 16, "name": "4gZ0qfiE"}, {"max": 21, "min": 89, "name": "PdJY4gKb"}, {"max": 91, "min": 26, "name": "7Ftqfy7x"}], [{"max": 52, "min": 16, "name": "HMPvWDI6"}, {"max": 77, "min": 83, "name": "zax4Wp5C"}, {"max": 56, "min": 94, "name": "hvEcX1uC"}], [{"max": 32, "min": 39, "name": "t655Hg40"}, {"max": 16, "min": 3, "name": "S70pTIQn"}, {"max": 77, "min": 79, "name": "6JFzMspD"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 44, "role_flexing_second": 88}, "duration": 25, "max_number": 31, "min_number": 79, "player_max_number": 29, "player_min_number": 2}, {"combination": {"alliances": [[{"max": 9, "min": 0, "name": "EjpuTrQZ"}, {"max": 79, "min": 27, "name": "bHBjRQTT"}, {"max": 57, "min": 1, "name": "goHijYvE"}], [{"max": 76, "min": 62, "name": "7cggYsT4"}, {"max": 5, "min": 69, "name": "QFJhIF2l"}, {"max": 85, "min": 44, "name": "6Lst4ims"}], [{"max": 2, "min": 25, "name": "ujlpKAvm"}, {"max": 13, "min": 81, "name": "r4TibQ6h"}, {"max": 79, "min": 79, "name": "fIynAGBr"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 64, "role_flexing_second": 99}, "duration": 64, "max_number": 99, "min_number": 89, "player_max_number": 91, "player_min_number": 99}, {"combination": {"alliances": [[{"max": 82, "min": 43, "name": "9WF0RS28"}, {"max": 93, "min": 39, "name": "ZMq5hiPK"}, {"max": 85, "min": 68, "name": "mFLIz6Ny"}], [{"max": 1, "min": 95, "name": "iEdMGX36"}, {"max": 30, "min": 22, "name": "DiOl8Pnr"}, {"max": 41, "min": 6, "name": "5g9iAjFq"}], [{"max": 95, "min": 69, "name": "CmuQzmpr"}, {"max": 37, "min": 75, "name": "gwuG6QpA"}, {"max": 47, "min": 31, "name": "yPeDQDGn"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 73, "role_flexing_second": 58}, "duration": 54, "max_number": 32, "min_number": 27, "player_max_number": 92, "player_min_number": 52}], "name": "8WoSLuwd"}, "62IR2hF9": {"alliance": {"combination": {"alliances": [[{"max": 95, "min": 33, "name": "POdLjvkB"}, {"max": 10, "min": 62, "name": "rthaWjFl"}, {"max": 92, "min": 46, "name": "yNTRL1GY"}], [{"max": 100, "min": 50, "name": "U5zadPH9"}, {"max": 3, "min": 46, "name": "0MwuHuwn"}, {"max": 75, "min": 8, "name": "U7U4pph9"}], [{"max": 62, "min": 31, "name": "oaQIgnXr"}, {"max": 44, "min": 50, "name": "dzQAbBxJ"}, {"max": 83, "min": 86, "name": "toOF1aeO"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 66, "role_flexing_second": 8}, "max_number": 16, "min_number": 93, "player_max_number": 1, "player_min_number": 49}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 96, "min": 36, "name": "AW2PojcD"}, {"max": 81, "min": 56, "name": "mFvyquqs"}, {"max": 50, "min": 81, "name": "l5Zi1Vsj"}], [{"max": 28, "min": 68, "name": "tH7gFvlW"}, {"max": 21, "min": 83, "name": "PRnWDSuq"}, {"max": 87, "min": 50, "name": "quJES6PX"}], [{"max": 47, "min": 85, "name": "ZyXd1Ciy"}, {"max": 71, "min": 99, "name": "2x5UOkAf"}, {"max": 1, "min": 33, "name": "TNlrAydV"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 75, "role_flexing_second": 79}, "duration": 53, "max_number": 4, "min_number": 78, "player_max_number": 90, "player_min_number": 12}, {"combination": {"alliances": [[{"max": 40, "min": 22, "name": "pmKevbAY"}, {"max": 27, "min": 88, "name": "FTsHEouJ"}, {"max": 52, "min": 13, "name": "r0ATb0Io"}], [{"max": 11, "min": 86, "name": "quoyzEjx"}, {"max": 38, "min": 41, "name": "EKZq5hd1"}, {"max": 19, "min": 0, "name": "t7CZG7OW"}], [{"max": 81, "min": 11, "name": "RzRH07Os"}, {"max": 75, "min": 23, "name": "u8Bc5e2g"}, {"max": 13, "min": 85, "name": "541yWYvr"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 51, "role_flexing_second": 0}, "duration": 3, "max_number": 13, "min_number": 71, "player_max_number": 3, "player_min_number": 86}, {"combination": {"alliances": [[{"max": 74, "min": 38, "name": "lFbo75wk"}, {"max": 38, "min": 57, "name": "gXT8QGqW"}, {"max": 61, "min": 49, "name": "TryaL0wN"}], [{"max": 27, "min": 42, "name": "BORYxSh8"}, {"max": 8, "min": 59, "name": "0SAS96IF"}, {"max": 70, "min": 55, "name": "BnxBM6RR"}], [{"max": 37, "min": 92, "name": "qZRxvi0S"}, {"max": 79, "min": 76, "name": "wh1YVMza"}, {"max": 96, "min": 39, "name": "kJTE81m8"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 95, "role_flexing_second": 55}, "duration": 39, "max_number": 83, "min_number": 8, "player_max_number": 94, "player_min_number": 50}], "name": "nmijIPH3"}, "rZH2L7Rx": {"alliance": {"combination": {"alliances": [[{"max": 26, "min": 9, "name": "87JR3Qfg"}, {"max": 2, "min": 36, "name": "h5CeuyGr"}, {"max": 36, "min": 82, "name": "8qhKcHS2"}], [{"max": 81, "min": 94, "name": "3WtkzW8K"}, {"max": 96, "min": 41, "name": "eXynXDmM"}, {"max": 63, "min": 71, "name": "td7DdXL9"}], [{"max": 7, "min": 80, "name": "SC9AF06C"}, {"max": 89, "min": 50, "name": "L5UTFQ6d"}, {"max": 9, "min": 45, "name": "NfP0byUQ"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 89, "role_flexing_second": 5}, "max_number": 9, "min_number": 24, "player_max_number": 11, "player_min_number": 31}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 17, "min": 56, "name": "UKPl9DB0"}, {"max": 78, "min": 41, "name": "l7M8wjGL"}, {"max": 91, "min": 32, "name": "vSbUJQ7T"}], [{"max": 9, "min": 60, "name": "geE3U88X"}, {"max": 70, "min": 20, "name": "Qfp4QjZg"}, {"max": 58, "min": 50, "name": "aRnDObq0"}], [{"max": 82, "min": 58, "name": "4FVA3AWH"}, {"max": 49, "min": 65, "name": "uykjEZhu"}, {"max": 43, "min": 36, "name": "hw3aGYzE"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 67, "role_flexing_second": 19}, "duration": 12, "max_number": 98, "min_number": 88, "player_max_number": 67, "player_min_number": 47}, {"combination": {"alliances": [[{"max": 50, "min": 19, "name": "L8IVHFgq"}, {"max": 91, "min": 1, "name": "Oxo2J1Gv"}, {"max": 84, "min": 0, "name": "aqYZlwDk"}], [{"max": 90, "min": 17, "name": "iTI7hEFy"}, {"max": 21, "min": 96, "name": "0kBZdFmp"}, {"max": 83, "min": 75, "name": "9WiF7Day"}], [{"max": 71, "min": 99, "name": "tW2QNRNc"}, {"max": 30, "min": 83, "name": "TAJhVy34"}, {"max": 94, "min": 66, "name": "aMHAXwyi"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 44, "role_flexing_second": 44}, "duration": 38, "max_number": 47, "min_number": 55, "player_max_number": 90, "player_min_number": 57}, {"combination": {"alliances": [[{"max": 93, "min": 39, "name": "Mi27kjCM"}, {"max": 44, "min": 11, "name": "ZT9byIGB"}, {"max": 78, "min": 13, "name": "Q9o01zpQ"}], [{"max": 82, "min": 28, "name": "vQj2mprZ"}, {"max": 27, "min": 32, "name": "PbLGVIH6"}, {"max": 55, "min": 59, "name": "o267kz9n"}], [{"max": 60, "min": 3, "name": "nlJ2yBiS"}, {"max": 39, "min": 67, "name": "i1qmozZv"}, {"max": 98, "min": 11, "name": "9wjxkm2E"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 34, "role_flexing_second": 9}, "duration": 38, "max_number": 76, "min_number": 81, "player_max_number": 28, "player_min_number": 45}], "name": "ixlQ4keE"}}, "ticket_flexing_selection": "oldest", "ticket_flexing_selections": [{"selection": "random", "threshold": 76}, {"selection": "pivot", "threshold": 36}, {"selection": "random", "threshold": 24}], "use_newest_ticket_for_flexing": true}, "session_queue_timeout_seconds": 76, "social_matchmaking": false, "ticket_observability_enable": false, "use_sub_gamemode": true}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateChannelHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 5 'CreateChannelHandler' test.out

#- 6 GetMatchPoolMetric
$CLI_EXE \
    --sn matchmaking \
    --op GetMatchPoolMetric \
    --channelName 'OMfO1YaZ' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 6 'GetMatchPoolMetric' test.out

#- 7 DeleteChannelHandler
$CLI_EXE \
    --sn matchmaking \
    --op DeleteChannelHandler \
    --channel 'TSUe538D' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 7 'DeleteChannelHandler' test.out

#- 8 StoreMatchResults
# body param: body
echo '{"match_id": "q6u2RVo2", "players": [{"results": [{"attribute": "NqVf2Sz3", "value": 0.08260997759317501}, {"attribute": "9M634Tiw", "value": 0.7483030239568438}, {"attribute": "tVZEwJqe", "value": 0.3450200838851658}], "user_id": "pGycvehi"}, {"results": [{"attribute": "MxcOWXcM", "value": 0.47288629768203505}, {"attribute": "SeoaeDBA", "value": 0.2837978941397181}, {"attribute": "Y2HoCUCE", "value": 0.4353361085701668}], "user_id": "vBB900Wy"}, {"results": [{"attribute": "oi4famlg", "value": 0.4441098720809299}, {"attribute": "ESy4SwBB", "value": 0.04832920858292766}, {"attribute": "tbF5KKux", "value": 0.04033710842173577}], "user_id": "SXqnAuab"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op StoreMatchResults \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 8 'StoreMatchResults' test.out

#- 9 Rebalance
# body param: body
echo '{"match_id": "OMV3HptK"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op Rebalance \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 9 'Rebalance' test.out

#- 10 QueueSessionHandler
# body param: body
echo '{"channel": "Ekg1vxZL", "client_version": "Ze9i3FPy", "deployment": "ikt8NgD1", "error_code": 47, "error_message": "3cKl2TrN", "game_mode": "qSLrgvyY", "is_mock": "ux3iHUWP", "joinable": true, "match_id": "YI6ufDBw", "matching_allies": [{"matching_parties": [{"first_ticket_created_at": 49, "party_attributes": {"FjV52vwx": {}, "xwOfDiqt": {}, "nZZBKu9P": {}}, "party_id": "TvDBYivx", "party_members": [{"extra_attributes": {"TFYvEulN": {}, "CVVpdjpP": {}, "z3njUnOr": {}}, "user_id": "sUYNLmWb"}, {"extra_attributes": {"WUJYY23o": {}, "Jr9vWENG": {}, "9rDhe9vF": {}}, "user_id": "Z2ywzxyP"}, {"extra_attributes": {"9kCxPJg5": {}, "3uu6TQWs": {}, "jmSgwjtt": {}}, "user_id": "AK1QmzYM"}], "ticket_created_at": 3, "ticket_id": "QyieYtKl"}, {"first_ticket_created_at": 16, "party_attributes": {"G8yciRHg": {}, "FcpcaiGw": {}, "j78iqIU4": {}}, "party_id": "7jm3LsfM", "party_members": [{"extra_attributes": {"ZOXErqUZ": {}, "ZjUBJCm3": {}, "JfrQl81p": {}}, "user_id": "lK5p0AF6"}, {"extra_attributes": {"xzkq1nnP": {}, "aXSZfnew": {}, "vsUc5wOg": {}}, "user_id": "JaycgFcI"}, {"extra_attributes": {"O6R48cKw": {}, "O3FU1sPs": {}, "XIY2diol": {}}, "user_id": "twR0gwnJ"}], "ticket_created_at": 67, "ticket_id": "GE5itte1"}, {"first_ticket_created_at": 89, "party_attributes": {"a7wCH956": {}, "M3Dgbysf": {}, "jGqpbJb9": {}}, "party_id": "ChqJOsgb", "party_members": [{"extra_attributes": {"jMe4cfB5": {}, "eDzlibS6": {}, "9WNP0HcP": {}}, "user_id": "tokH8IPl"}, {"extra_attributes": {"yuOjiGMO": {}, "Ca7N9r5R": {}, "GTBLkB6N": {}}, "user_id": "3eKfh1Oh"}, {"extra_attributes": {"k87sjEJW": {}, "UzGOD13q": {}, "nF7TpWPW": {}}, "user_id": "D822ZUQF"}], "ticket_created_at": 28, "ticket_id": "X9KgpDSL"}]}, {"matching_parties": [{"first_ticket_created_at": 69, "party_attributes": {"rNphr0Ug": {}, "EnE9OK8L": {}, "t2btd9OU": {}}, "party_id": "1Rq5RJGp", "party_members": [{"extra_attributes": {"FdnpYK6T": {}, "k9a7JjWl": {}, "SkUfVJjy": {}}, "user_id": "oiGxkMnG"}, {"extra_attributes": {"qLOlio7k": {}, "4ls3um7u": {}, "Bq6EAwOK": {}}, "user_id": "TNZtUfvd"}, {"extra_attributes": {"Y1eW0Fww": {}, "er1gV6uJ": {}, "wI2LtMrC": {}}, "user_id": "J6WWorZN"}], "ticket_created_at": 50, "ticket_id": "ZGSq5YIp"}, {"first_ticket_created_at": 88, "party_attributes": {"1Cjbzaun": {}, "MAm5ymLW": {}, "Y3JBq2u7": {}}, "party_id": "tMx4CTd1", "party_members": [{"extra_attributes": {"pmJy0yk7": {}, "KpSCRKWd": {}, "CFZZ3gwE": {}}, "user_id": "3EApnSLm"}, {"extra_attributes": {"0xvpuJd9": {}, "HgzTowAA": {}, "MSFaktjw": {}}, "user_id": "e3XpH2Cz"}, {"extra_attributes": {"r8tSfGdB": {}, "uFo9ezyw": {}, "COtkg0sr": {}}, "user_id": "lzwCWX1n"}], "ticket_created_at": 94, "ticket_id": "BaUzrIDB"}, {"first_ticket_created_at": 40, "party_attributes": {"vHYX4fnT": {}, "lw1ZRAMb": {}, "oYoD1fUD": {}}, "party_id": "N1FxlAar", "party_members": [{"extra_attributes": {"0dzXNdwh": {}, "CNuXISDm": {}, "VQSdXThc": {}}, "user_id": "RynZitFc"}, {"extra_attributes": {"QTrNywL2": {}, "HOpOLyoO": {}, "4w2xcWil": {}}, "user_id": "z3tyHoNG"}, {"extra_attributes": {"oEfEkPM0": {}, "qyVMwJOh": {}, "kUMmnreo": {}}, "user_id": "CfJNHHzK"}], "ticket_created_at": 67, "ticket_id": "q4s5f2lA"}]}, {"matching_parties": [{"first_ticket_created_at": 46, "party_attributes": {"8DH5MJIJ": {}, "xOBxKDDz": {}, "wKFKfgLj": {}}, "party_id": "lA8KXWaT", "party_members": [{"extra_attributes": {"BfAbSRNV": {}, "1qsUZHf9": {}, "NJj4SLyv": {}}, "user_id": "UGhn7hL3"}, {"extra_attributes": {"mmVQTMuA": {}, "jnBmWH7u": {}, "NjCrEc7V": {}}, "user_id": "K6fHTPMP"}, {"extra_attributes": {"rhSLkeSW": {}, "KXBadPfH": {}, "Eb7msGPq": {}}, "user_id": "5NNXmnXW"}], "ticket_created_at": 89, "ticket_id": "qNCO5Tw9"}, {"first_ticket_created_at": 68, "party_attributes": {"owbfRqSU": {}, "wjVURjg6": {}, "oa9S2UMa": {}}, "party_id": "Lj1D82TH", "party_members": [{"extra_attributes": {"TCNOBcUi": {}, "e6vxoiOP": {}, "R5cZi0mW": {}}, "user_id": "be28jyDq"}, {"extra_attributes": {"vjzprhsN": {}, "3rdyjXRy": {}, "pCsixcvH": {}}, "user_id": "NuEhbLvp"}, {"extra_attributes": {"2A0BG6cu": {}, "cT0qLSka": {}, "8l5WqYy9": {}}, "user_id": "sFM9MeD6"}], "ticket_created_at": 60, "ticket_id": "4qvMhyql"}, {"first_ticket_created_at": 88, "party_attributes": {"vyzniE4T": {}, "IeJKlFya": {}, "Fca7qnM1": {}}, "party_id": "5D80SMny", "party_members": [{"extra_attributes": {"aRmrsk0A": {}, "H9KEmcyh": {}, "T9qNSM6i": {}}, "user_id": "MfPgV3aM"}, {"extra_attributes": {"mx3mXKgT": {}, "7B9ffsEF": {}, "t0bgVTNQ": {}}, "user_id": "7zMJ6L7H"}, {"extra_attributes": {"m1nEj4l1": {}, "X3cidOKp": {}, "y0gwmNUe": {}}, "user_id": "ko2WkNlD"}], "ticket_created_at": 31, "ticket_id": "DYya5kAW"}]}], "namespace": "hZ8SSgZT", "party_attributes": {"btmmWg5O": {}, "yfhPQogG": {}, "GAJoZDC6": {}}, "party_id": "ZievcvP6", "queued_at": 37, "region": "2HRkMZ9a", "server_name": "2WwmmDzO", "status": "l84UXYc9", "ticket_id": "wT5QHBlX", "ticket_ids": ["qYugu7D5", "wf1nPoh5", "3LBw68M4"], "updated_at": "1979-04-04T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op QueueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 10 'QueueSessionHandler' test.out

#- 11 DequeueSessionHandler
# body param: body
echo '{"match_id": "GSC6kpLl"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op DequeueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 11 'DequeueSessionHandler' test.out

#- 12 QuerySessionHandler
$CLI_EXE \
    --sn matchmaking \
    --op QuerySessionHandler \
    --matchID 'RsHFLQEJ' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 12 'QuerySessionHandler' test.out

#- 13 UpdatePlayTimeWeight
# body param: body
echo '{"playtime": 94, "userID": "77k9NLzA", "weight": 0.7010660844719432}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdatePlayTimeWeight \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 13 'UpdatePlayTimeWeight' test.out

#- 14 GetAllPartyInAllChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInAllChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 14 'GetAllPartyInAllChannel' test.out

#- 15 BulkGetSessions
$CLI_EXE \
    --sn matchmaking \
    --op BulkGetSessions \
    --namespace $AB_NAMESPACE \
    --matchIDs '1ryAlucs' \
    > test.out 2>&1
eval_tap $? 15 'BulkGetSessions' test.out

#- 16 ExportChannels
$CLI_EXE \
    --sn matchmaking \
    --op ExportChannels \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 16 'ExportChannels' test.out

#- 17 ImportChannels
# form data upload: file
echo 'tmp.dat' > $TEMP_FILE_UPLOAD
$CLI_EXE \
    --sn matchmaking \
    --op ImportChannels \
    --namespace $AB_NAMESPACE \
    --upload $TEMP_FILE_UPLOAD \
    --strategy '2bB5Cpue' \
    > test.out 2>&1
eval_tap $? 17 'ImportChannels' test.out

#- 18 GetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetSingleMatchmakingChannel \
    --channelName 'qnEGh7Qb' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 18 'GetSingleMatchmakingChannel' test.out

#- 19 UpdateMatchmakingChannel
# body param: body
echo '{"deployment": "W58WdJ4k", "description": "xSObBfpQ", "findMatchTimeoutSeconds": 94, "joinable": false, "max_delay_ms": 15, "region_expansion_range_ms": 76, "region_expansion_rate_ms": 61, "region_latency_initial_range_ms": 21, "region_latency_max_ms": 76, "ruleSet": {"alliance": {"combination": {"alliances": [[{"max": 43, "min": 33, "name": "PSNI3cXo"}, {"max": 93, "min": 30, "name": "Qjo3DpWw"}, {"max": 58, "min": 8, "name": "0MXlWN0C"}], [{"max": 9, "min": 46, "name": "0Mw6z7rR"}, {"max": 93, "min": 3, "name": "PsrFuF7j"}, {"max": 12, "min": 26, "name": "9lW78vJa"}], [{"max": 8, "min": 24, "name": "kN39X3dU"}, {"max": 19, "min": 91, "name": "xBh2i84r"}, {"max": 72, "min": 78, "name": "Bngi1alB"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 96, "role_flexing_second": 15}, "maxNumber": 80, "minNumber": 48, "playerMaxNumber": 59, "playerMinNumber": 58}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 7, "min": 22, "name": "Oq25jtP5"}, {"max": 64, "min": 1, "name": "ELd9bUbx"}, {"max": 53, "min": 15, "name": "UfCt9gLp"}], [{"max": 33, "min": 30, "name": "h0oFlzIX"}, {"max": 17, "min": 56, "name": "dqagqrwA"}, {"max": 54, "min": 5, "name": "3OINkyjK"}], [{"max": 78, "min": 79, "name": "tYP73vYA"}, {"max": 41, "min": 12, "name": "UFeaPuho"}, {"max": 40, "min": 81, "name": "1GOmwLGE"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 88, "role_flexing_second": 51}, "duration": 15, "max_number": 68, "min_number": 65, "player_max_number": 56, "player_min_number": 83}, {"combination": {"alliances": [[{"max": 76, "min": 26, "name": "CAFzyuTt"}, {"max": 82, "min": 77, "name": "OJZ6AsEZ"}, {"max": 40, "min": 96, "name": "Ueu9Ote0"}], [{"max": 33, "min": 71, "name": "EM2MUfA6"}, {"max": 87, "min": 41, "name": "ZrmmCSLF"}, {"max": 49, "min": 31, "name": "6SAiQSYn"}], [{"max": 39, "min": 90, "name": "0hon2dXv"}, {"max": 93, "min": 2, "name": "XSIhnkpY"}, {"max": 60, "min": 66, "name": "klp3oyWK"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 13, "role_flexing_second": 3}, "duration": 93, "max_number": 65, "min_number": 96, "player_max_number": 56, "player_min_number": 47}, {"combination": {"alliances": [[{"max": 29, "min": 15, "name": "FuwNNIZn"}, {"max": 71, "min": 50, "name": "usd3u3KZ"}, {"max": 7, "min": 59, "name": "e4Yr4kBC"}], [{"max": 94, "min": 34, "name": "r1j6Os3w"}, {"max": 37, "min": 54, "name": "FQ7KJ2Qr"}, {"max": 5, "min": 21, "name": "Q2QR1tCM"}], [{"max": 93, "min": 77, "name": "59jL5Xub"}, {"max": 38, "min": 48, "name": "nwPrrLZX"}, {"max": 27, "min": 67, "name": "EuogkWMQ"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 79, "role_flexing_second": 13}, "duration": 10, "max_number": 70, "min_number": 89, "player_max_number": 73, "player_min_number": 14}], "batch_size": 25, "bucket_mmr_rule": {"disable_authority": false, "flex_authority_count": 84, "flex_flat_step_range": 26, "flex_immunity_count": 77, "flex_range_max": 12, "flex_rate_ms": 84, "flex_step_max": 77, "force_authority_match": true, "initial_step_range": 42, "mmr_max": 76, "mmr_mean": 43, "mmr_min": 78, "mmr_std_dev": 30, "override_mmr_data": true, "use_bucket_mmr": false, "use_flat_flex_step": true}, "flexingRules": [{"attribute": "OQYL8u7O", "criteria": "6NcM3ki8", "duration": 53, "reference": 0.9494601284287667}, {"attribute": "IjqvDDJt", "criteria": "ElPlILpD", "duration": 12, "reference": 0.0960592427311131}, {"attribute": "8KtyfG6A", "criteria": "hxBm0fXT", "duration": 29, "reference": 0.22007582964510064}], "match_options": {"options": [{"name": "VNQuTY4f", "type": "qeLYQ24x"}, {"name": "9jGCQaPT", "type": "MTwEBlFJ"}, {"name": "VFT1XhDB", "type": "zwPeR2bU"}]}, "matchingRules": [{"attribute": "pkl9Bt1H", "criteria": "QbbXoR4s", "reference": 0.2594262950935662}, {"attribute": "O1BTywD8", "criteria": "EM9maXTM", "reference": 0.09336484073032236}, {"attribute": "6LXjnjOe", "criteria": "pVL9FYTb", "reference": 0.3657342650738904}], "sort_ticket": {"search_result": "distance", "ticket_queue": "largestPartySize"}, "sort_tickets": [{"search_result": "largestPartySize", "threshold": 56, "ticket_queue": "none"}, {"search_result": "oldestTicketAge", "threshold": 87, "ticket_queue": "distance"}, {"search_result": "random", "threshold": 83, "ticket_queue": "none"}], "sub_game_modes": {}, "ticket_flexing_selection": "random", "ticket_flexing_selections": [{"selection": "pivot", "threshold": 70}, {"selection": "random", "threshold": 52}, {"selection": "random", "threshold": 28}], "use_newest_ticket_for_flexing": true}, "sessionQueueTimeoutSeconds": 89, "socialMatchmaking": true, "ticket_observability_enable": false, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdateMatchmakingChannel \
    --channelName '1dXYOMhi' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 19 'UpdateMatchmakingChannel' test.out

#- 20 CleanAllMocks
$CLI_EXE \
    --sn matchmaking \
    --op CleanAllMocks \
    --channelName 'SX0mHPN1' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 20 'CleanAllMocks' test.out

#- 21 GetAllMockMatches
$CLI_EXE \
    --sn matchmaking \
    --op GetAllMockMatches \
    --channelName 'mxTPO2UU' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 21 'GetAllMockMatches' test.out

#- 22 GetMockMatchesByTimestamp
# body param: body
echo '{"timestamp_after": 34}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op GetMockMatchesByTimestamp \
    --channelName 'DIvoQDYL' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 22 'GetMockMatchesByTimestamp' test.out

#- 23 GetAllMockTickets
$CLI_EXE \
    --sn matchmaking \
    --op GetAllMockTickets \
    --channelName 'raYh6SCo' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 23 'GetAllMockTickets' test.out

#- 24 CreateMockTickets
# body param: body
echo '{"attribute_name": "6tw6Hiz0", "count": 37, "mmrMax": 0.1615615563179278, "mmrMean": 0.30248642534251946, "mmrMin": 0.2723432673994661, "mmrStdDev": 0.8196743544280212}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateMockTickets \
    --channelName 'FOOr5PrF' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 24 'CreateMockTickets' test.out

#- 25 BulkCreateMockTickets
# body param: body
echo '[{"first_ticket_created_at": 43, "party_attributes": {"6KX68BIc": {}, "6tDSwgqk": {}, "ADps6Gbw": {}}, "party_id": "4DnScfcJ", "party_members": [{"extra_attributes": {"QrD86XGx": {}, "rWDDibjf": {}, "xpwJhpVm": {}}, "user_id": "DdEKzjf0"}, {"extra_attributes": {"LsovEB3s": {}, "aocpz5eV": {}, "VsJQBX29": {}}, "user_id": "E1L8Df5k"}, {"extra_attributes": {"zVPmUEJA": {}, "yjKMtAmh": {}, "Ugte4ORt": {}}, "user_id": "nd5mdJ9o"}], "ticket_created_at": 71, "ticket_id": "SJi9lC5N"}, {"first_ticket_created_at": 81, "party_attributes": {"rR2oNAE6": {}, "MFdiNBgw": {}, "dz0gddqI": {}}, "party_id": "KgeJjDTo", "party_members": [{"extra_attributes": {"Y2ieF7y4": {}, "X0iSpaeF": {}, "e0Etc8wq": {}}, "user_id": "gnoz3kpn"}, {"extra_attributes": {"Q33cYMQL": {}, "znPYuGRh": {}, "W8LX2UPn": {}}, "user_id": "d6wy9hvd"}, {"extra_attributes": {"KE9uSphT": {}, "0vCF47OB": {}, "afwDDmdI": {}}, "user_id": "tVuBnyqt"}], "ticket_created_at": 44, "ticket_id": "UWwcW334"}, {"first_ticket_created_at": 28, "party_attributes": {"vVsucIRi": {}, "Vqo6cMfk": {}, "xnVS2erx": {}}, "party_id": "6XmKUbf6", "party_members": [{"extra_attributes": {"5IFinB5i": {}, "q7hIbBFJ": {}, "sWAtzHCT": {}}, "user_id": "zAQ448Pt"}, {"extra_attributes": {"PBoRF5Xz": {}, "J9HEBpZv": {}, "5Mxtv5Pa": {}}, "user_id": "zisfNkwq"}, {"extra_attributes": {"B5F4vSH7": {}, "t4G396dh": {}, "GX1aVjxW": {}}, "user_id": "Ss5Yva6M"}], "ticket_created_at": 59, "ticket_id": "vmE8s44p"}]' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op BulkCreateMockTickets \
    --channelName '39BYNCvR' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 25 'BulkCreateMockTickets' test.out

#- 26 GetMockTicketsByTimestamp
# body param: body
echo '{"timestamp_after": 71}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op GetMockTicketsByTimestamp \
    --channelName 'zs8ffTLq' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 26 'GetMockTicketsByTimestamp' test.out

#- 27 GetAllPartyInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInChannel \
    --channelName 'rntJq8yi' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 27 'GetAllPartyInChannel' test.out

#- 28 GetAllSessionsInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllSessionsInChannel \
    --channelName 'JYq5Uqnb' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 28 'GetAllSessionsInChannel' test.out

#- 29 AddUserIntoSessionInChannel
# body param: body
echo '{"blocked_players": ["Y35s4NaZ", "anvFyzKm", "mxl6uaVM"], "party_id": "FKgA6dn1", "user_id": "mTccqohq"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op AddUserIntoSessionInChannel \
    --channelName '4ZZtQnic' \
    --matchID 'fCHFKsAQ' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 29 'AddUserIntoSessionInChannel' test.out

#- 30 DeleteSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteSessionInChannel \
    --channelName 'hNKclBVN' \
    --matchID 'jNtVDfcv' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 30 'DeleteSessionInChannel' test.out

#- 31 DeleteUserFromSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteUserFromSessionInChannel \
    --channelName 'f83A10iv' \
    --matchID 'P8OZ22vK' \
    --namespace $AB_NAMESPACE \
    --userID '6jEwi4L1' \
    > test.out 2>&1
eval_tap $? 31 'DeleteUserFromSessionInChannel' test.out

#- 32 GetStatData
$CLI_EXE \
    --sn matchmaking \
    --op GetStatData \
    --channelName 'UVOEj1m8' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 32 'GetStatData' test.out

#- 33 SearchSessions
eval_tap 0 33 'SearchSessions # SKIP deprecated' test.out

#- 34 GetSessionHistoryDetailed
eval_tap 0 34 'GetSessionHistoryDetailed # SKIP deprecated' test.out

#- 35 PublicGetMessages
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetMessages \
    > test.out 2>&1
eval_tap $? 35 'PublicGetMessages' test.out

#- 36 PublicGetAllMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetAllMatchmakingChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 36 'PublicGetAllMatchmakingChannel' test.out

#- 37 PublicGetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetSingleMatchmakingChannel \
    --channelName 'vWgq6leC' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 37 'PublicGetSingleMatchmakingChannel' test.out

#- 38 SearchSessionsV2
eval_tap 0 38 'SearchSessionsV2 # SKIP deprecated' test.out

#- 39 VersionCheckHandler
$CLI_EXE \
    --sn matchmaking \
    --op VersionCheckHandler \
    > test.out 2>&1
eval_tap $? 39 'VersionCheckHandler' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE