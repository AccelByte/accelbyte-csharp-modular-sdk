#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 
# - template file: 

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..39"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 GetHealthcheckInfo
$CLI_EXE \
    --sn matchmaking \
    --op GetHealthcheckInfo \
    > test.out 2>&1
eval_tap $? 2 'GetHealthcheckInfo' test.out

#- 3 HandlerV3Healthz
$CLI_EXE \
    --sn matchmaking \
    --op HandlerV3Healthz \
    > test.out 2>&1
eval_tap $? 3 'HandlerV3Healthz' test.out

#- 4 GetAllChannelsHandler
$CLI_EXE \
    --sn matchmaking \
    --op GetAllChannelsHandler \
    --namespace $AB_NAMESPACE \
    --limit '48' \
    --offset '16' \
    > test.out 2>&1
eval_tap $? 4 'GetAllChannelsHandler' test.out

#- 5 CreateChannelHandler
# body param: body
echo '{"blocked_player_option": "blockedPlayerCannotMatch", "deployment": "wb6Tjjrk", "description": "WtJ07l1s", "find_match_timeout_seconds": 47, "game_mode": "zFrHuooq", "joinable": false, "max_delay_ms": 10, "region_expansion_range_ms": 4, "region_expansion_rate_ms": 12, "region_latency_initial_range_ms": 39, "region_latency_max_ms": 76, "rule_set": {"alliance": {"combination": {"alliances": [[{"max": 42, "min": 96, "name": "Ib159xfc"}, {"max": 75, "min": 0, "name": "7syR7fHm"}, {"max": 1, "min": 61, "name": "K0fWA74D"}], [{"max": 94, "min": 45, "name": "zphQzhQA"}, {"max": 60, "min": 76, "name": "Ds1kAffT"}, {"max": 57, "min": 64, "name": "6SAm9Vry"}], [{"max": 18, "min": 41, "name": "aXav4iqs"}, {"max": 6, "min": 13, "name": "gh6fwt4l"}, {"max": 22, "min": 59, "name": "eSNICOXq"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 76, "role_flexing_second": 29}, "max_number": 83, "min_number": 15, "player_max_number": 64, "player_min_number": 1}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 16, "min": 41, "name": "6Uild69e"}, {"max": 78, "min": 28, "name": "DSyM9XsB"}, {"max": 57, "min": 84, "name": "Zl7z6Z7i"}], [{"max": 2, "min": 95, "name": "v4SX1JNm"}, {"max": 28, "min": 26, "name": "KFtxYJ53"}, {"max": 75, "min": 48, "name": "1jYXpwP4"}], [{"max": 24, "min": 92, "name": "si5pSoKz"}, {"max": 38, "min": 0, "name": "BWz7u5oO"}, {"max": 81, "min": 36, "name": "K2uSjjej"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 15, "role_flexing_second": 24}, "duration": 20, "max_number": 79, "min_number": 6, "player_max_number": 42, "player_min_number": 80}, {"combination": {"alliances": [[{"max": 5, "min": 10, "name": "NKplK2KE"}, {"max": 99, "min": 16, "name": "kN6ouTAo"}, {"max": 29, "min": 93, "name": "yqAj29Zf"}], [{"max": 55, "min": 17, "name": "p6TrEoTr"}, {"max": 30, "min": 20, "name": "eGctIKCq"}, {"max": 5, "min": 0, "name": "BO2PNLVW"}], [{"max": 68, "min": 29, "name": "NlP2SjJe"}, {"max": 90, "min": 39, "name": "ku58kxk8"}, {"max": 33, "min": 67, "name": "VCjKbvyH"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 6, "role_flexing_second": 13}, "duration": 83, "max_number": 53, "min_number": 12, "player_max_number": 2, "player_min_number": 68}, {"combination": {"alliances": [[{"max": 15, "min": 44, "name": "MtyQJcqq"}, {"max": 24, "min": 33, "name": "q2PwUjbK"}, {"max": 70, "min": 7, "name": "4JECm4Sq"}], [{"max": 100, "min": 46, "name": "m4Ix0VJi"}, {"max": 100, "min": 61, "name": "KsYh92yZ"}, {"max": 68, "min": 5, "name": "DiPDNtyg"}], [{"max": 78, "min": 60, "name": "HyEhS2Ws"}, {"max": 34, "min": 19, "name": "ZnyJC3O3"}, {"max": 3, "min": 90, "name": "w835YMdk"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 0, "role_flexing_second": 46}, "duration": 82, "max_number": 90, "min_number": 90, "player_max_number": 2, "player_min_number": 27}], "batch_size": 29, "bucket_mmr_rule": {"disable_authority": false, "flex_authority_count": 66, "flex_flat_step_range": 93, "flex_immunity_count": 5, "flex_range_max": 32, "flex_rate_ms": 85, "flex_step_max": 70, "force_authority_match": false, "initial_step_range": 56, "mmr_max": 61, "mmr_mean": 65, "mmr_min": 76, "mmr_std_dev": 26, "override_mmr_data": true, "use_bucket_mmr": true, "use_flat_flex_step": false}, "flexing_rule": [{"attribute": "PdE5i3Ew", "criteria": "Pj7DJqUm", "duration": 4, "reference": 0.7532043678687884}, {"attribute": "e9bP4jNm", "criteria": "rv1pVTuA", "duration": 96, "reference": 0.5794431646973458}, {"attribute": "93MBceRl", "criteria": "2iD3ay7V", "duration": 95, "reference": 0.7484109348975257}], "match_options": {"options": [{"name": "Nuj4lWi5", "type": "Nf3HMstB"}, {"name": "dWzydK5M", "type": "NGG6aEGQ"}, {"name": "aQTFJ2Ad", "type": "QtF48944"}]}, "matching_rule": [{"attribute": "f9BF20jL", "criteria": "QJpoINx4", "reference": 0.5262948639764431}, {"attribute": "9AhK4kG1", "criteria": "tyqOd2WR", "reference": 0.9499485293219841}, {"attribute": "Ua8m6VOZ", "criteria": "xI0SOhjS", "reference": 0.04623552358309568}], "rebalance_enable": true, "sort_ticket": {"search_result": "0b423qmY", "ticket_queue": "BzWAonPS"}, "sort_tickets": [{"search_result": "k1c5WQrn", "threshold": 83, "ticket_queue": "OiiqYVMQ"}, {"search_result": "seOU5UWK", "threshold": 31, "ticket_queue": "FuQxm28L"}, {"search_result": "7ppfFiNt", "threshold": 36, "ticket_queue": "hFEwECTa"}], "sub_game_modes": {"JC92XOmG": {"alliance": {"combination": {"alliances": [[{"max": 18, "min": 88, "name": "GnU5UNzh"}, {"max": 66, "min": 38, "name": "257O4mDq"}, {"max": 1, "min": 68, "name": "Eulp0o4u"}], [{"max": 60, "min": 43, "name": "a84HMLne"}, {"max": 77, "min": 36, "name": "zCnkONzz"}, {"max": 77, "min": 22, "name": "LBOt4FR0"}], [{"max": 21, "min": 51, "name": "RoogAyNN"}, {"max": 57, "min": 56, "name": "W1qqSSaW"}, {"max": 29, "min": 97, "name": "0U3tkSUx"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 32, "role_flexing_second": 91}, "max_number": 66, "min_number": 18, "player_max_number": 26, "player_min_number": 86}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 12, "min": 75, "name": "MOvx5uaI"}, {"max": 10, "min": 51, "name": "YTs6lXEE"}, {"max": 63, "min": 36, "name": "3sn4Zx5C"}], [{"max": 44, "min": 62, "name": "r319o5UO"}, {"max": 82, "min": 98, "name": "BcKqoXtQ"}, {"max": 46, "min": 39, "name": "XUHViudU"}], [{"max": 88, "min": 26, "name": "Xr9VHV6L"}, {"max": 78, "min": 27, "name": "TxxaTGUY"}, {"max": 2, "min": 90, "name": "mr9v2LV4"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 87, "role_flexing_second": 52}, "duration": 36, "max_number": 3, "min_number": 67, "player_max_number": 10, "player_min_number": 6}, {"combination": {"alliances": [[{"max": 53, "min": 9, "name": "p1TNpLnH"}, {"max": 17, "min": 88, "name": "OXedOyAI"}, {"max": 52, "min": 23, "name": "klPhwt5J"}], [{"max": 100, "min": 69, "name": "KKRf3Rf6"}, {"max": 50, "min": 5, "name": "mC3vgig5"}, {"max": 59, "min": 75, "name": "Gmvb1dVF"}], [{"max": 93, "min": 88, "name": "5W06HItI"}, {"max": 21, "min": 16, "name": "TOTa1E9l"}, {"max": 35, "min": 89, "name": "thzlPtvm"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 97, "role_flexing_second": 39}, "duration": 25, "max_number": 2, "min_number": 43, "player_max_number": 44, "player_min_number": 91}, {"combination": {"alliances": [[{"max": 58, "min": 34, "name": "Tg8ilBFW"}, {"max": 91, "min": 43, "name": "ffunzzOe"}, {"max": 63, "min": 44, "name": "INEjW5Lw"}], [{"max": 15, "min": 61, "name": "dev6eAlC"}, {"max": 43, "min": 95, "name": "bPJp71DP"}, {"max": 60, "min": 85, "name": "RYNlqMhM"}], [{"max": 30, "min": 56, "name": "GD9uHNXn"}, {"max": 7, "min": 100, "name": "dxrPzYm5"}, {"max": 11, "min": 54, "name": "yVoJh1pk"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 66, "role_flexing_second": 39}, "duration": 55, "max_number": 25, "min_number": 81, "player_max_number": 0, "player_min_number": 24}], "name": "EwWsbbiz"}, "QdZH5XrD": {"alliance": {"combination": {"alliances": [[{"max": 22, "min": 53, "name": "BEC58ddw"}, {"max": 11, "min": 0, "name": "7BQquAzj"}, {"max": 72, "min": 5, "name": "5yHzkbPa"}], [{"max": 13, "min": 13, "name": "o8Jclq99"}, {"max": 28, "min": 66, "name": "EA5JHK0Y"}, {"max": 0, "min": 40, "name": "tHox8srw"}], [{"max": 79, "min": 86, "name": "HK9IqHki"}, {"max": 85, "min": 22, "name": "yv8J8BZ3"}, {"max": 34, "min": 25, "name": "DL3ZmnxI"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 4, "role_flexing_second": 88}, "max_number": 54, "min_number": 3, "player_max_number": 14, "player_min_number": 56}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 82, "min": 30, "name": "usLmyETo"}, {"max": 6, "min": 95, "name": "F1uIoHEg"}, {"max": 27, "min": 81, "name": "vILObR0k"}], [{"max": 48, "min": 45, "name": "UYOTrW15"}, {"max": 30, "min": 78, "name": "fHVwS4r3"}, {"max": 20, "min": 86, "name": "dWa8Mqtt"}], [{"max": 30, "min": 14, "name": "djmaNSxo"}, {"max": 46, "min": 26, "name": "K9tUJgSZ"}, {"max": 47, "min": 49, "name": "nCc2UQPe"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 14, "role_flexing_second": 69}, "duration": 70, "max_number": 45, "min_number": 16, "player_max_number": 52, "player_min_number": 85}, {"combination": {"alliances": [[{"max": 68, "min": 17, "name": "22LokA3y"}, {"max": 67, "min": 47, "name": "brx0G78b"}, {"max": 82, "min": 88, "name": "sDwAJavU"}], [{"max": 21, "min": 52, "name": "qABTW5q6"}, {"max": 49, "min": 20, "name": "LOIr4hlf"}, {"max": 4, "min": 6, "name": "knPw0uRD"}], [{"max": 81, "min": 12, "name": "sNF6VOWd"}, {"max": 50, "min": 81, "name": "lkrQWJgQ"}, {"max": 34, "min": 58, "name": "BBalwE9d"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 14, "role_flexing_second": 8}, "duration": 0, "max_number": 4, "min_number": 12, "player_max_number": 5, "player_min_number": 21}, {"combination": {"alliances": [[{"max": 81, "min": 18, "name": "rPbQ3dOJ"}, {"max": 17, "min": 14, "name": "FCgj0dHt"}, {"max": 51, "min": 9, "name": "FI8k9eJL"}], [{"max": 98, "min": 56, "name": "iyPDDDZL"}, {"max": 2, "min": 55, "name": "QtZeAMhZ"}, {"max": 40, "min": 1, "name": "NtIHqVAO"}], [{"max": 0, "min": 61, "name": "uk7hGTzx"}, {"max": 93, "min": 42, "name": "6LxVlGgm"}, {"max": 7, "min": 50, "name": "kzjWvdMZ"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 40, "role_flexing_second": 37}, "duration": 67, "max_number": 54, "min_number": 94, "player_max_number": 90, "player_min_number": 38}], "name": "oWJ7E3CS"}, "u3PScdpE": {"alliance": {"combination": {"alliances": [[{"max": 64, "min": 55, "name": "FQjZU9hu"}, {"max": 64, "min": 56, "name": "gi6AGSSx"}, {"max": 74, "min": 13, "name": "N56uzwnd"}], [{"max": 57, "min": 84, "name": "j4xCGxn7"}, {"max": 57, "min": 18, "name": "BuSC3dYr"}, {"max": 51, "min": 99, "name": "Hys5wwKA"}], [{"max": 79, "min": 49, "name": "yI60mXSz"}, {"max": 75, "min": 46, "name": "7m7Oeb0Y"}, {"max": 6, "min": 60, "name": "fswN4yR4"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 46, "role_flexing_second": 18}, "max_number": 31, "min_number": 7, "player_max_number": 16, "player_min_number": 62}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 9, "min": 42, "name": "bvcC7rgv"}, {"max": 38, "min": 72, "name": "nemAwcmr"}, {"max": 77, "min": 48, "name": "wsr5wWIu"}], [{"max": 53, "min": 35, "name": "cr9raiaD"}, {"max": 78, "min": 34, "name": "wri8huHk"}, {"max": 11, "min": 75, "name": "cTSub77W"}], [{"max": 36, "min": 43, "name": "pQT461I5"}, {"max": 66, "min": 20, "name": "AlPEe09L"}, {"max": 54, "min": 31, "name": "qVbH33Eq"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 89, "role_flexing_second": 76}, "duration": 88, "max_number": 17, "min_number": 68, "player_max_number": 74, "player_min_number": 9}, {"combination": {"alliances": [[{"max": 89, "min": 41, "name": "jJKeMRIR"}, {"max": 87, "min": 48, "name": "r8387kP5"}, {"max": 33, "min": 65, "name": "hM8DIJFW"}], [{"max": 57, "min": 24, "name": "l98B4M7y"}, {"max": 53, "min": 96, "name": "BiXjFPhR"}, {"max": 61, "min": 55, "name": "p46Ue9NQ"}], [{"max": 79, "min": 42, "name": "gyeSNkO5"}, {"max": 79, "min": 28, "name": "B3qxF1Ez"}, {"max": 45, "min": 3, "name": "eAbx38qe"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 70, "role_flexing_second": 35}, "duration": 53, "max_number": 57, "min_number": 14, "player_max_number": 58, "player_min_number": 66}, {"combination": {"alliances": [[{"max": 31, "min": 12, "name": "hnWLD5cS"}, {"max": 25, "min": 12, "name": "L6pbYJwJ"}, {"max": 54, "min": 3, "name": "Y1PcnJlr"}], [{"max": 43, "min": 14, "name": "vPIAwSCU"}, {"max": 60, "min": 83, "name": "wouUb0Qn"}, {"max": 47, "min": 40, "name": "ddFoemZ1"}], [{"max": 1, "min": 1, "name": "KCsJl4FG"}, {"max": 62, "min": 38, "name": "4H3PB0os"}, {"max": 71, "min": 51, "name": "BjwwbrYf"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 92, "role_flexing_second": 30}, "duration": 12, "max_number": 45, "min_number": 10, "player_max_number": 31, "player_min_number": 9}], "name": "9LcUkrUm"}}, "ticket_flexing_selection": "0zePsO1h", "ticket_flexing_selections": [{"selection": "rvVaGTEg", "threshold": 35}, {"selection": "7T7T7U25", "threshold": 38}, {"selection": "DgIGHGCi", "threshold": 80}], "use_newest_ticket_for_flexing": false}, "session_queue_timeout_seconds": 5, "social_matchmaking": false, "sub_gamemode_selection": "ticketOrder", "ticket_observability_enable": false, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateChannelHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 5 'CreateChannelHandler' test.out

#- 6 GetMatchPoolMetric
$CLI_EXE \
    --sn matchmaking \
    --op GetMatchPoolMetric \
    --channelName 'C3UTjSMv' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 6 'GetMatchPoolMetric' test.out

#- 7 DeleteChannelHandler
$CLI_EXE \
    --sn matchmaking \
    --op DeleteChannelHandler \
    --channel 'cLWCnCgE' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 7 'DeleteChannelHandler' test.out

#- 8 StoreMatchResults
# body param: body
echo '{"match_id": "sa6f31nV", "players": [{"results": [{"attribute": "MFDMJhJA", "value": 0.9709013113306234}, {"attribute": "nCKZXuiW", "value": 0.715907495500235}, {"attribute": "hs3qaVq7", "value": 0.3007092507896849}], "user_id": "CsbIdCfO"}, {"results": [{"attribute": "FrzWqh3D", "value": 0.8519643173728437}, {"attribute": "p98pgSPk", "value": 0.7443175543910175}, {"attribute": "Yv1R08Cf", "value": 0.3605810034194933}], "user_id": "cDlbA2Kq"}, {"results": [{"attribute": "Dt7i5Ajp", "value": 0.7390467032842332}, {"attribute": "lWXcJmQ0", "value": 0.4601258319135477}, {"attribute": "A6yuerDp", "value": 0.4241571982194775}], "user_id": "0DL87o08"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op StoreMatchResults \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 8 'StoreMatchResults' test.out

#- 9 Rebalance
# body param: body
echo '{"match_id": "WCmcxR0u"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op Rebalance \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 9 'Rebalance' test.out

#- 10 QueueSessionHandler
# body param: body
echo '{"channel": "uG9ylfbt", "client_version": "RYfjMoYX", "deployment": "meysarEf", "error_code": 53, "error_message": "4P4baUeJ", "game_mode": "MJJyacR0", "is_mock": "G9JR7E0d", "joinable": true, "match_id": "puSIgue3", "matching_allies": [{"matching_parties": [{"first_ticket_created_at": 31, "party_attributes": {"CZGby5N1": {}, "iMcQoA3a": {}, "Dxg5Ixeu": {}}, "party_id": "v9KwNTQZ", "party_members": [{"extra_attributes": {"gHBAWrh3": {}, "sfbhke1b": {}, "zpQGUuUD": {}}, "user_id": "ZFba4CAL"}, {"extra_attributes": {"MFBpXCqx": {}, "QfrMc0TQ": {}, "yghQWFwn": {}}, "user_id": "RBbRAYa7"}, {"extra_attributes": {"5VV5fa2t": {}, "0peebLDR": {}, "XkYy9DR0": {}}, "user_id": "SH5qOgw0"}], "ticket_created_at": 33, "ticket_id": "u0owxz5M"}, {"first_ticket_created_at": 73, "party_attributes": {"k347bkRR": {}, "FBOB4WvP": {}, "XVugBznw": {}}, "party_id": "QmAgy3kj", "party_members": [{"extra_attributes": {"gQYMBuGT": {}, "xIgOi0Sz": {}, "s6aAgikt": {}}, "user_id": "B97VJcrB"}, {"extra_attributes": {"D6du1Zpz": {}, "1QaaTtSb": {}, "P3wWANuy": {}}, "user_id": "mQxtsptE"}, {"extra_attributes": {"riK87w7N": {}, "Tjr93lUo": {}, "uOOzg0h0": {}}, "user_id": "yg9joSPH"}], "ticket_created_at": 5, "ticket_id": "YDXafYBc"}, {"first_ticket_created_at": 23, "party_attributes": {"Zf0mRnQn": {}, "eLn0ShxA": {}, "K3bHtCbA": {}}, "party_id": "NRDKig88", "party_members": [{"extra_attributes": {"KkYU9OcZ": {}, "OnrZ7HaO": {}, "2UbUGTVY": {}}, "user_id": "zRIH7JkS"}, {"extra_attributes": {"fzNWxVd1": {}, "u92Bjnpd": {}, "jn5gLujN": {}}, "user_id": "fQW0e3T9"}, {"extra_attributes": {"fxKjH2uQ": {}, "yAdhU8aA": {}, "FWMWQUBD": {}}, "user_id": "s0LdJonW"}], "ticket_created_at": 43, "ticket_id": "6ekhr3Mj"}]}, {"matching_parties": [{"first_ticket_created_at": 59, "party_attributes": {"tOqbEAol": {}, "GnfT605V": {}, "KrigGbkH": {}}, "party_id": "7FRM37mm", "party_members": [{"extra_attributes": {"11ajtBuu": {}, "z7YZpnrT": {}, "Tmoqd5QF": {}}, "user_id": "dhlMelFQ"}, {"extra_attributes": {"Eh3MZeAL": {}, "IywwMz1m": {}, "iCzNlkmA": {}}, "user_id": "HFt0qoau"}, {"extra_attributes": {"X2fKSCKM": {}, "2u81Qo0X": {}, "fOoRTJth": {}}, "user_id": "SBJtVVPs"}], "ticket_created_at": 74, "ticket_id": "6Tnk7XpD"}, {"first_ticket_created_at": 5, "party_attributes": {"35MSVgBm": {}, "PBErspzJ": {}, "iD1I1Hjs": {}}, "party_id": "fnbIiSuM", "party_members": [{"extra_attributes": {"kYxJIEru": {}, "Po8lJ09r": {}, "vPxDw7nz": {}}, "user_id": "EGfdD1PD"}, {"extra_attributes": {"CRkNTLK4": {}, "emI6yJYZ": {}, "BHMzR74S": {}}, "user_id": "rIRmqnxZ"}, {"extra_attributes": {"Ee55Lc3Y": {}, "begOdXTs": {}, "7QiXdw6L": {}}, "user_id": "0Y06ycqw"}], "ticket_created_at": 90, "ticket_id": "FoyNVN2Y"}, {"first_ticket_created_at": 13, "party_attributes": {"meJXqIj7": {}, "B35lUcqV": {}, "xujGTKsH": {}}, "party_id": "GvfkWCuW", "party_members": [{"extra_attributes": {"sGWpkX9E": {}, "dNlh2lQx": {}, "0gcbtMBl": {}}, "user_id": "2AolKl5B"}, {"extra_attributes": {"4BeLxo2e": {}, "QKOZtU46": {}, "tplr7BaL": {}}, "user_id": "MKfI2AIp"}, {"extra_attributes": {"W3DSKLHI": {}, "IPsq4CmL": {}, "HFMpdzUG": {}}, "user_id": "f70ePo1o"}], "ticket_created_at": 92, "ticket_id": "LYCAWsam"}]}, {"matching_parties": [{"first_ticket_created_at": 92, "party_attributes": {"B1ScSxNT": {}, "uCy1n8he": {}, "HJ1N5zX8": {}}, "party_id": "oDc38bRk", "party_members": [{"extra_attributes": {"rUjB3x37": {}, "7aqvtTug": {}, "hKlde3Tk": {}}, "user_id": "BWX5gZtH"}, {"extra_attributes": {"ai4LvMnn": {}, "By5uvBt4": {}, "ujxxddJp": {}}, "user_id": "3usqNyaP"}, {"extra_attributes": {"1zc01xGx": {}, "I5rIBjU5": {}, "HV7EMVkz": {}}, "user_id": "7p1H5B7M"}], "ticket_created_at": 1, "ticket_id": "xhNkbDmO"}, {"first_ticket_created_at": 35, "party_attributes": {"jVAGtiA1": {}, "kwlXBhaT": {}, "le1wczje": {}}, "party_id": "njftAAVV", "party_members": [{"extra_attributes": {"MY29L3CU": {}, "BicvXg6C": {}, "SkyZGv7v": {}}, "user_id": "2gCilmVf"}, {"extra_attributes": {"hwaTMPZ6": {}, "W0TT5QWI": {}, "tTvOsCzo": {}}, "user_id": "48jZVBiw"}, {"extra_attributes": {"bcx99d1B": {}, "IxvjaOUs": {}, "vnmSxPn9": {}}, "user_id": "AKanN48U"}], "ticket_created_at": 29, "ticket_id": "CqooN0vG"}, {"first_ticket_created_at": 82, "party_attributes": {"tgPeSPmw": {}, "qZLcgmNP": {}, "N7anU7qK": {}}, "party_id": "ai2E9yEl", "party_members": [{"extra_attributes": {"i26whnjv": {}, "0TvymeM5": {}, "uCVlmUXF": {}}, "user_id": "kROJ0eHY"}, {"extra_attributes": {"qLQ6x2wX": {}, "U1ERR5cD": {}, "Majh4Cb9": {}}, "user_id": "3Tm4VJlM"}, {"extra_attributes": {"WmcbB41d": {}, "G8QJOwdU": {}, "otcsZGpQ": {}}, "user_id": "R4k88UkK"}], "ticket_created_at": 76, "ticket_id": "hRe75jL7"}]}], "namespace": "JMAXqujP", "party_attributes": {"XnHECyKX": {}, "CXyOKx8K": {}, "S2xfSZYw": {}}, "party_id": "fVnAYdvL", "queued_at": 64, "region": "5QxMMR1k", "server_name": "UHZX2LK0", "status": "A3B6Lf1L", "ticket_id": "653AQCOv", "ticket_ids": ["8JmFF6ep", "J229NFwV", "YVMfolNr"], "updated_at": "1972-12-08T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op QueueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 10 'QueueSessionHandler' test.out

#- 11 DequeueSessionHandler
# body param: body
echo '{"match_id": "IDmYYtLF"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op DequeueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 11 'DequeueSessionHandler' test.out

#- 12 QuerySessionHandler
$CLI_EXE \
    --sn matchmaking \
    --op QuerySessionHandler \
    --matchID 'YFkKJFqp' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 12 'QuerySessionHandler' test.out

#- 13 UpdatePlayTimeWeight
# body param: body
echo '{"playtime": 23, "userID": "Luv9rmtk", "weight": 0.6630168383658008}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdatePlayTimeWeight \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 13 'UpdatePlayTimeWeight' test.out

#- 14 GetAllPartyInAllChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInAllChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 14 'GetAllPartyInAllChannel' test.out

#- 15 BulkGetSessions
$CLI_EXE \
    --sn matchmaking \
    --op BulkGetSessions \
    --namespace $AB_NAMESPACE \
    --matchIDs 'mzX0wyCJ' \
    > test.out 2>&1
eval_tap $? 15 'BulkGetSessions' test.out

#- 16 ExportChannels
$CLI_EXE \
    --sn matchmaking \
    --op ExportChannels \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 16 'ExportChannels' test.out

#- 17 ImportChannels
# form data upload: file
echo 'tmp.dat' > $TEMP_FILE_UPLOAD
$CLI_EXE \
    --sn matchmaking \
    --op ImportChannels \
    --namespace $AB_NAMESPACE \
    --upload file $TEMP_FILE_UPLOAD \
    --strategy 'AU4bIawU' \
    > test.out 2>&1
eval_tap $? 17 'ImportChannels' test.out

#- 18 GetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetSingleMatchmakingChannel \
    --channelName 'd25CyMAz' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 18 'GetSingleMatchmakingChannel' test.out

#- 19 UpdateMatchmakingChannel
# body param: body
echo '{"blocked_player_option": "blockedPlayerCanMatch", "deployment": "SKHFYxxL", "description": "b4FXIWwb", "findMatchTimeoutSeconds": 33, "joinable": false, "max_delay_ms": 96, "region_expansion_range_ms": 46, "region_expansion_rate_ms": 52, "region_latency_initial_range_ms": 94, "region_latency_max_ms": 47, "ruleSet": {"alliance": {"combination": {"alliances": [[{"max": 90, "min": 40, "name": "UvQapXnU"}, {"max": 16, "min": 58, "name": "SZ5qP2jY"}, {"max": 71, "min": 18, "name": "2prk4kbn"}], [{"max": 3, "min": 13, "name": "tGBD8Sg1"}, {"max": 1, "min": 8, "name": "6CexTC2M"}, {"max": 20, "min": 77, "name": "LsSpD59o"}], [{"max": 31, "min": 8, "name": "QjWTlFQ5"}, {"max": 38, "min": 56, "name": "jdpHqInJ"}, {"max": 9, "min": 71, "name": "gXR8uRt6"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 8, "role_flexing_second": 97}, "maxNumber": 46, "minNumber": 52, "playerMaxNumber": 77, "playerMinNumber": 65}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 42, "min": 64, "name": "JWcaOZuX"}, {"max": 12, "min": 66, "name": "ph3tXGr1"}, {"max": 54, "min": 88, "name": "jX5S4ijq"}], [{"max": 9, "min": 79, "name": "EyyfhJ5K"}, {"max": 7, "min": 53, "name": "bJNeb3HH"}, {"max": 47, "min": 79, "name": "FFXVFURc"}], [{"max": 43, "min": 0, "name": "GwEf3IyH"}, {"max": 59, "min": 66, "name": "U4FfEYDY"}, {"max": 33, "min": 46, "name": "HHgVqKEZ"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 99, "role_flexing_second": 45}, "duration": 41, "max_number": 71, "min_number": 99, "player_max_number": 62, "player_min_number": 64}, {"combination": {"alliances": [[{"max": 100, "min": 84, "name": "IfPeNBWp"}, {"max": 5, "min": 3, "name": "owRh01CW"}, {"max": 85, "min": 97, "name": "ahlO4ox5"}], [{"max": 53, "min": 37, "name": "NaafePTj"}, {"max": 72, "min": 78, "name": "YKfAE22C"}, {"max": 65, "min": 87, "name": "UjYVQOl5"}], [{"max": 99, "min": 7, "name": "ijJe4IjO"}, {"max": 67, "min": 32, "name": "4Il3mf4l"}, {"max": 90, "min": 46, "name": "t8zBb9Ob"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 34, "role_flexing_second": 36}, "duration": 40, "max_number": 52, "min_number": 8, "player_max_number": 67, "player_min_number": 44}, {"combination": {"alliances": [[{"max": 99, "min": 7, "name": "9zRRFAZG"}, {"max": 21, "min": 10, "name": "ORg5bdaU"}, {"max": 4, "min": 51, "name": "9eIjXNWX"}], [{"max": 79, "min": 9, "name": "kg7HScxn"}, {"max": 73, "min": 11, "name": "ZhJb1Eb1"}, {"max": 45, "min": 49, "name": "v28dYxC0"}], [{"max": 21, "min": 81, "name": "n2ZkpfZA"}, {"max": 52, "min": 83, "name": "IQbxEPcY"}, {"max": 57, "min": 62, "name": "UDK1uP5u"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 10, "role_flexing_second": 77}, "duration": 31, "max_number": 2, "min_number": 96, "player_max_number": 40, "player_min_number": 25}], "batch_size": 15, "bucket_mmr_rule": {"disable_authority": true, "flex_authority_count": 57, "flex_flat_step_range": 35, "flex_immunity_count": 45, "flex_range_max": 17, "flex_rate_ms": 50, "flex_step_max": 100, "force_authority_match": false, "initial_step_range": 35, "mmr_max": 84, "mmr_mean": 0, "mmr_min": 32, "mmr_std_dev": 60, "override_mmr_data": false, "use_bucket_mmr": false, "use_flat_flex_step": false}, "flexingRules": [{"attribute": "LStA8d4b", "criteria": "sfcYGD1H", "duration": 91, "reference": 0.528752229609843}, {"attribute": "TI3rGHFd", "criteria": "nMs7Iaz0", "duration": 78, "reference": 0.6683094949354463}, {"attribute": "QsoCD6qN", "criteria": "kmR0XjII", "duration": 43, "reference": 0.7023234972091627}], "match_options": {"options": [{"name": "0u8AUv9r", "type": "BDF5lcAm"}, {"name": "aGeN9y3a", "type": "wVCBWUKg"}, {"name": "EH8mIsul", "type": "19Vsf3Wo"}]}, "matchingRules": [{"attribute": "p8zM3Sm4", "criteria": "fkOytzS1", "reference": 0.7424363442174979}, {"attribute": "EUZiR8eU", "criteria": "tCCQBNqe", "reference": 0.8061441706623826}, {"attribute": "suEG9Npp", "criteria": "R6KPKEZ4", "reference": 0.8231119522020185}], "sort_ticket": {"search_result": "P4X08iAn", "ticket_queue": "oagspCPk"}, "sort_tickets": [{"search_result": "vOVMoSMj", "threshold": 1, "ticket_queue": "FBB4UHcO"}, {"search_result": "Rcim246S", "threshold": 0, "ticket_queue": "vRt109zP"}, {"search_result": "PhPK0JLm", "threshold": 23, "ticket_queue": "5i8nZxBo"}], "sub_game_modes": {}, "ticket_flexing_selection": "2jbVrsTw", "ticket_flexing_selections": [{"selection": "5buHpXOC", "threshold": 33}, {"selection": "wytRUGeW", "threshold": 95}, {"selection": "TGsRxN0E", "threshold": 61}], "use_newest_ticket_for_flexing": false}, "sessionQueueTimeoutSeconds": 97, "socialMatchmaking": true, "sub_gamemode_selection": "ticketOrder", "ticket_observability_enable": true, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdateMatchmakingChannel \
    --channelName 'Glpylzb3' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 19 'UpdateMatchmakingChannel' test.out

#- 20 CleanAllMocks
$CLI_EXE \
    --sn matchmaking \
    --op CleanAllMocks \
    --channelName 'fCyxD2ZE' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 20 'CleanAllMocks' test.out

#- 21 GetAllMockMatches
$CLI_EXE \
    --sn matchmaking \
    --op GetAllMockMatches \
    --channelName 'NlVzNrtK' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 21 'GetAllMockMatches' test.out

#- 22 GetMockMatchesByTimestamp
# body param: body
echo '{"timestamp_after": 17}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op GetMockMatchesByTimestamp \
    --channelName 'XKmuB2zh' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 22 'GetMockMatchesByTimestamp' test.out

#- 23 GetAllMockTickets
$CLI_EXE \
    --sn matchmaking \
    --op GetAllMockTickets \
    --channelName 'gOhbhGYT' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 23 'GetAllMockTickets' test.out

#- 24 CreateMockTickets
# body param: body
echo '{"attribute_name": "uRP96nQa", "count": 18, "mmrMax": 0.8892942142868321, "mmrMean": 0.16386409297732674, "mmrMin": 0.38191704652715686, "mmrStdDev": 0.3917439753994646}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateMockTickets \
    --channelName 'lgxtMtMb' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 24 'CreateMockTickets' test.out

#- 25 BulkCreateMockTickets
# body param: body
echo '[{"first_ticket_created_at": 40, "party_attributes": {"qEc6OG12": {}, "ffU2zGbM": {}, "x3uSXgEk": {}}, "party_id": "AktAYdm7", "party_members": [{"extra_attributes": {"SyNryR5d": {}, "LWcZvIwz": {}, "8Sx6lJJg": {}}, "user_id": "O4h9lzmG"}, {"extra_attributes": {"EVOujrgf": {}, "TLUv9xAT": {}, "t0rSCvzB": {}}, "user_id": "kWgnYTtp"}, {"extra_attributes": {"Z5SKJbnS": {}, "dpbzsCWs": {}, "aHYyc0Ar": {}}, "user_id": "v9FsZth4"}], "ticket_created_at": 22, "ticket_id": "91S5qF85"}, {"first_ticket_created_at": 46, "party_attributes": {"ZYx79q7e": {}, "cZ6jNMDf": {}, "Zbo7U6p0": {}}, "party_id": "W9VXuow7", "party_members": [{"extra_attributes": {"MqZt9LWe": {}, "wM8zdS3V": {}, "i53A4SyE": {}}, "user_id": "NZ3BEpMB"}, {"extra_attributes": {"o9nU60zz": {}, "18XEL3BP": {}, "hU0uoxDv": {}}, "user_id": "H3gLEQit"}, {"extra_attributes": {"ZgntvAYR": {}, "m84IFHYk": {}, "AHRZdlLo": {}}, "user_id": "WRSUiSNf"}], "ticket_created_at": 84, "ticket_id": "nZ9ZrZ3r"}, {"first_ticket_created_at": 73, "party_attributes": {"lmyeuh0L": {}, "odlE3FRw": {}, "l5tugFm1": {}}, "party_id": "rrNOwIpf", "party_members": [{"extra_attributes": {"18HGwX5B": {}, "QhwqtIp7": {}, "s8HDlvV4": {}}, "user_id": "s8O5VZyt"}, {"extra_attributes": {"T4AeOWNc": {}, "JgVvQIpt": {}, "X9OwFn5X": {}}, "user_id": "yDTpV7WN"}, {"extra_attributes": {"zpdWJ0bE": {}, "NTZyTLtM": {}, "Kd3CR3Oh": {}}, "user_id": "EEfMP6qI"}], "ticket_created_at": 55, "ticket_id": "lG8ig5vo"}]' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op BulkCreateMockTickets \
    --channelName 'fEwC7NOe' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 25 'BulkCreateMockTickets' test.out

#- 26 GetMockTicketsByTimestamp
# body param: body
echo '{"timestamp_after": 14}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op GetMockTicketsByTimestamp \
    --channelName 'JvLJW21F' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 26 'GetMockTicketsByTimestamp' test.out

#- 27 GetAllPartyInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInChannel \
    --channelName 'nHwTvB9k' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 27 'GetAllPartyInChannel' test.out

#- 28 GetAllSessionsInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllSessionsInChannel \
    --channelName 'IXoxWS0T' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 28 'GetAllSessionsInChannel' test.out

#- 29 AddUserIntoSessionInChannel
# body param: body
echo '{"blocked_players": ["jfNNwvv8", "XArx2LXL", "4t8536d7"], "party_id": "PWwiWeMh", "user_id": "srp0FDNN"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op AddUserIntoSessionInChannel \
    --channelName 'vaIurbVY' \
    --matchID 'UrIX1Xnj' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 29 'AddUserIntoSessionInChannel' test.out

#- 30 DeleteSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteSessionInChannel \
    --channelName 'cCtmOo9R' \
    --matchID 'fbMQ3sbO' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 30 'DeleteSessionInChannel' test.out

#- 31 DeleteUserFromSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteUserFromSessionInChannel \
    --channelName 'emJkWppO' \
    --matchID 'B55dfn0q' \
    --namespace $AB_NAMESPACE \
    --userID '9OMx9NyS' \
    > test.out 2>&1
eval_tap $? 31 'DeleteUserFromSessionInChannel' test.out

#- 32 GetStatData
$CLI_EXE \
    --sn matchmaking \
    --op GetStatData \
    --channelName '3nZrdZM3' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 32 'GetStatData' test.out

#- 33 SearchSessions
eval_tap 0 33 'SearchSessions # SKIP deprecated' test.out

#- 34 GetSessionHistoryDetailed
eval_tap 0 34 'GetSessionHistoryDetailed # SKIP deprecated' test.out

#- 35 PublicGetMessages
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetMessages \
    > test.out 2>&1
eval_tap $? 35 'PublicGetMessages' test.out

#- 36 PublicGetAllMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetAllMatchmakingChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 36 'PublicGetAllMatchmakingChannel' test.out

#- 37 PublicGetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetSingleMatchmakingChannel \
    --channelName 'jfBU7PW5' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 37 'PublicGetSingleMatchmakingChannel' test.out

#- 38 SearchSessionsV2
eval_tap 0 38 'SearchSessionsV2 # SKIP deprecated' test.out

#- 39 VersionCheckHandler
$CLI_EXE \
    --sn matchmaking \
    --op VersionCheckHandler \
    > test.out 2>&1
eval_tap $? 39 'VersionCheckHandler' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE