#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 
# - template file: 

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..39"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 GetHealthcheckInfo
$CLI_EXE \
    --sn matchmaking \
    --op GetHealthcheckInfo \
    > test.out 2>&1
eval_tap $? 2 'GetHealthcheckInfo' test.out

#- 3 HandlerV3Healthz
$CLI_EXE \
    --sn matchmaking \
    --op HandlerV3Healthz \
    > test.out 2>&1
eval_tap $? 3 'HandlerV3Healthz' test.out

#- 4 GetAllChannelsHandler
$CLI_EXE \
    --sn matchmaking \
    --op GetAllChannelsHandler \
    --namespace $AB_NAMESPACE \
    --limit '35' \
    --offset '14' \
    > test.out 2>&1
eval_tap $? 4 'GetAllChannelsHandler' test.out

#- 5 CreateChannelHandler
# body param: body
echo '{"blocked_player_option": "blockedPlayerCanMatch", "deployment": "d1cvR5iA", "description": "oRvWmde1", "find_match_timeout_seconds": 64, "game_mode": "oQbD1eUL", "joinable": true, "max_delay_ms": 4, "region_expansion_range_ms": 86, "region_expansion_rate_ms": 74, "region_latency_initial_range_ms": 84, "region_latency_max_ms": 18, "rule_set": {"alliance": {"combination": {"alliances": [[{"max": 97, "min": 89, "name": "g57gn328"}, {"max": 79, "min": 13, "name": "xsDZBhYs"}, {"max": 67, "min": 67, "name": "lE3YESO6"}], [{"max": 0, "min": 85, "name": "Ys0WgxNr"}, {"max": 59, "min": 90, "name": "IprBH8XK"}, {"max": 21, "min": 38, "name": "vSq6A99T"}], [{"max": 25, "min": 99, "name": "OWrJnSN8"}, {"max": 91, "min": 70, "name": "96XuBC8R"}, {"max": 13, "min": 32, "name": "tCbRWCeu"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 72, "role_flexing_second": 45}, "max_number": 30, "min_number": 64, "player_max_number": 14, "player_min_number": 94}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 21, "min": 8, "name": "7acCXxE2"}, {"max": 26, "min": 31, "name": "o9MsqBq2"}, {"max": 97, "min": 0, "name": "dt4FGeGc"}], [{"max": 27, "min": 41, "name": "fFdHExVd"}, {"max": 30, "min": 3, "name": "pxhAx4sX"}, {"max": 96, "min": 67, "name": "PU9ouOq8"}], [{"max": 62, "min": 75, "name": "Xakx7k9G"}, {"max": 34, "min": 98, "name": "McH5SaNh"}, {"max": 69, "min": 42, "name": "7sTtvX6E"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 12, "role_flexing_second": 69}, "duration": 92, "max_number": 79, "min_number": 3, "player_max_number": 44, "player_min_number": 32}, {"combination": {"alliances": [[{"max": 5, "min": 87, "name": "C4nzopzX"}, {"max": 91, "min": 1, "name": "TLizSC1X"}, {"max": 55, "min": 4, "name": "Ih9SjviJ"}], [{"max": 65, "min": 39, "name": "qbjFgPCK"}, {"max": 100, "min": 66, "name": "LTxjgHHY"}, {"max": 2, "min": 12, "name": "zdSmk4kI"}], [{"max": 83, "min": 93, "name": "PxSHP2FC"}, {"max": 7, "min": 7, "name": "l1gn7nkl"}, {"max": 94, "min": 1, "name": "jwkohsGW"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 67, "role_flexing_second": 50}, "duration": 73, "max_number": 51, "min_number": 86, "player_max_number": 93, "player_min_number": 15}, {"combination": {"alliances": [[{"max": 12, "min": 94, "name": "fvRSy7Ri"}, {"max": 31, "min": 94, "name": "BEGkwBkP"}, {"max": 33, "min": 49, "name": "Vm0dkeyM"}], [{"max": 46, "min": 16, "name": "c8GSOxb8"}, {"max": 59, "min": 0, "name": "WUf7uQlV"}, {"max": 44, "min": 12, "name": "32bO0DeF"}], [{"max": 91, "min": 50, "name": "Z1HSGTF4"}, {"max": 47, "min": 46, "name": "L0pUjC3i"}, {"max": 66, "min": 2, "name": "PkFN5yar"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 1, "role_flexing_second": 20}, "duration": 67, "max_number": 50, "min_number": 93, "player_max_number": 46, "player_min_number": 14}], "batch_size": 1, "bucket_mmr_rule": {"disable_authority": false, "flex_authority_count": 47, "flex_flat_step_range": 48, "flex_immunity_count": 75, "flex_range_max": 7, "flex_rate_ms": 28, "flex_step_max": 10, "force_authority_match": false, "initial_step_range": 42, "mmr_max": 95, "mmr_mean": 55, "mmr_min": 98, "mmr_std_dev": 89, "override_mmr_data": false, "use_bucket_mmr": false, "use_flat_flex_step": true}, "flexing_rule": [{"attribute": "z4NXPzmA", "criteria": "PDwQtkzi", "duration": 39, "reference": 0.9207986125151953}, {"attribute": "fRaq3Lvu", "criteria": "aCCR3IxD", "duration": 76, "reference": 0.6270158041852358}, {"attribute": "RzLLZPmW", "criteria": "QG61wDYO", "duration": 22, "reference": 0.216866039232252}], "match_options": {"options": [{"name": "R0RPcH2u", "type": "AsNWFDBl"}, {"name": "gVanh0It", "type": "qwMSSLL4"}, {"name": "w2QGQ0y1", "type": "71K1g8c2"}]}, "matching_rule": [{"attribute": "pcVia05u", "criteria": "qgz3IYmS", "reference": 0.558071204501447}, {"attribute": "nnY2wuQQ", "criteria": "sjxnFrmO", "reference": 0.3277232394931775}, {"attribute": "kAceVJ3v", "criteria": "QEXqjg7D", "reference": 0.5873084625100999}], "rebalance_enable": false, "sort_ticket": {"search_result": "distance", "ticket_queue": "largestPartySize"}, "sort_tickets": [{"search_result": "distance", "threshold": 18, "ticket_queue": "oldestTicketAge"}, {"search_result": "distance", "threshold": 4, "ticket_queue": "largestPartySize"}, {"search_result": "oldestTicketAge", "threshold": 43, "ticket_queue": "random"}], "sub_game_modes": {"1s2SqxgB": {"alliance": {"combination": {"alliances": [[{"max": 16, "min": 20, "name": "qFnAkYno"}, {"max": 84, "min": 83, "name": "IWFUK8dN"}, {"max": 39, "min": 67, "name": "sft18gE9"}], [{"max": 74, "min": 25, "name": "MTrQZ8WK"}, {"max": 73, "min": 94, "name": "J9MZ34lP"}, {"max": 8, "min": 7, "name": "ZW9uxn0w"}], [{"max": 62, "min": 72, "name": "4kgkDvLe"}, {"max": 57, "min": 19, "name": "F2dczcgj"}, {"max": 86, "min": 60, "name": "YHuJdbmD"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 48, "role_flexing_second": 68}, "max_number": 99, "min_number": 37, "player_max_number": 84, "player_min_number": 21}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 33, "min": 19, "name": "EpG5E0Tp"}, {"max": 13, "min": 72, "name": "EuZcBKef"}, {"max": 58, "min": 74, "name": "HLz8NqDF"}], [{"max": 61, "min": 40, "name": "jExpAxXW"}, {"max": 86, "min": 44, "name": "onEQiQ9V"}, {"max": 23, "min": 9, "name": "LZKNp189"}], [{"max": 33, "min": 93, "name": "x6S0cnK8"}, {"max": 42, "min": 94, "name": "LDSHIfVB"}, {"max": 77, "min": 87, "name": "qzMiCFAr"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 63, "role_flexing_second": 33}, "duration": 28, "max_number": 35, "min_number": 9, "player_max_number": 61, "player_min_number": 52}, {"combination": {"alliances": [[{"max": 32, "min": 44, "name": "KUE0BuNS"}, {"max": 63, "min": 1, "name": "WkLnp9sE"}, {"max": 51, "min": 55, "name": "naFVYXJr"}], [{"max": 53, "min": 32, "name": "HjtfFrZS"}, {"max": 25, "min": 25, "name": "Esd0By78"}, {"max": 91, "min": 75, "name": "5aGjX7bJ"}], [{"max": 54, "min": 81, "name": "dKbqAHHH"}, {"max": 30, "min": 50, "name": "KgYZvthi"}, {"max": 30, "min": 52, "name": "izGg01Vq"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 19, "role_flexing_second": 47}, "duration": 93, "max_number": 35, "min_number": 51, "player_max_number": 28, "player_min_number": 41}, {"combination": {"alliances": [[{"max": 80, "min": 86, "name": "72nxrnFC"}, {"max": 53, "min": 42, "name": "oFoNW8FM"}, {"max": 33, "min": 84, "name": "N6DmuRiB"}], [{"max": 75, "min": 28, "name": "hvCxHBeo"}, {"max": 92, "min": 46, "name": "1iSd0zJi"}, {"max": 51, "min": 15, "name": "AY5LuCOc"}], [{"max": 90, "min": 50, "name": "NHHeX742"}, {"max": 99, "min": 17, "name": "QHV3ruav"}, {"max": 55, "min": 1, "name": "2VQxR97G"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 33, "role_flexing_second": 6}, "duration": 3, "max_number": 81, "min_number": 34, "player_max_number": 49, "player_min_number": 52}], "name": "dxqg395B"}, "z9VsqpWP": {"alliance": {"combination": {"alliances": [[{"max": 43, "min": 60, "name": "4KC1pmoR"}, {"max": 16, "min": 37, "name": "oYfrcnyu"}, {"max": 73, "min": 77, "name": "dWngbzue"}], [{"max": 74, "min": 58, "name": "GZ6MJ1QU"}, {"max": 88, "min": 99, "name": "FPXJbwDj"}, {"max": 63, "min": 48, "name": "80XVWbm5"}], [{"max": 53, "min": 38, "name": "ulEau8zD"}, {"max": 90, "min": 42, "name": "O3tvyHJ2"}, {"max": 68, "min": 3, "name": "UOoLuTu0"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 24, "role_flexing_second": 64}, "max_number": 39, "min_number": 8, "player_max_number": 50, "player_min_number": 41}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 87, "min": 77, "name": "4ZaHrrzr"}, {"max": 78, "min": 30, "name": "SdejZIDY"}, {"max": 75, "min": 45, "name": "jyIcNCEX"}], [{"max": 91, "min": 44, "name": "0AVJT87f"}, {"max": 40, "min": 32, "name": "VaYxC0a2"}, {"max": 83, "min": 56, "name": "GKLHGZ6a"}], [{"max": 0, "min": 5, "name": "PLCFpr9p"}, {"max": 9, "min": 34, "name": "qbUZnSWD"}, {"max": 19, "min": 73, "name": "vftaFKRD"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 81, "role_flexing_second": 5}, "duration": 82, "max_number": 54, "min_number": 92, "player_max_number": 75, "player_min_number": 10}, {"combination": {"alliances": [[{"max": 10, "min": 9, "name": "LHlBwFSI"}, {"max": 7, "min": 74, "name": "gmOAeax0"}, {"max": 45, "min": 26, "name": "HZfK3C4R"}], [{"max": 4, "min": 33, "name": "E3ziJJhm"}, {"max": 57, "min": 71, "name": "SRWZl6em"}, {"max": 39, "min": 23, "name": "2d1b1bbV"}], [{"max": 50, "min": 15, "name": "DP4RgnpF"}, {"max": 57, "min": 60, "name": "JxohlvPL"}, {"max": 63, "min": 54, "name": "3Mpgdk3r"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 30, "role_flexing_second": 50}, "duration": 73, "max_number": 0, "min_number": 97, "player_max_number": 36, "player_min_number": 25}, {"combination": {"alliances": [[{"max": 49, "min": 37, "name": "EYCN3WC6"}, {"max": 34, "min": 34, "name": "CC6e3BSw"}, {"max": 25, "min": 59, "name": "cXHH7yYj"}], [{"max": 16, "min": 48, "name": "uYxa4TAB"}, {"max": 37, "min": 69, "name": "sfiL9f7Q"}, {"max": 96, "min": 3, "name": "xQG9K6VH"}], [{"max": 1, "min": 13, "name": "NkFKDHKd"}, {"max": 28, "min": 100, "name": "SMBjQTAs"}, {"max": 94, "min": 1, "name": "6hJ2JXJS"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 96, "role_flexing_second": 41}, "duration": 26, "max_number": 41, "min_number": 50, "player_max_number": 88, "player_min_number": 21}], "name": "WoT4PkV4"}, "qqt5mXJL": {"alliance": {"combination": {"alliances": [[{"max": 100, "min": 22, "name": "HKDROXZ4"}, {"max": 17, "min": 11, "name": "FxdamPf5"}, {"max": 36, "min": 18, "name": "uI30zR3S"}], [{"max": 35, "min": 17, "name": "amiR2CEq"}, {"max": 5, "min": 8, "name": "Kb4chNO5"}, {"max": 63, "min": 13, "name": "SOSiag3K"}], [{"max": 92, "min": 89, "name": "Fn1tx1BS"}, {"max": 67, "min": 96, "name": "9JoeR3Fo"}, {"max": 1, "min": 77, "name": "620c2J7g"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 45, "role_flexing_second": 91}, "max_number": 29, "min_number": 33, "player_max_number": 20, "player_min_number": 63}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 62, "min": 48, "name": "RNxXqAPs"}, {"max": 68, "min": 59, "name": "ya46jsD0"}, {"max": 67, "min": 62, "name": "LQ59Tw8g"}], [{"max": 67, "min": 3, "name": "2Yt27XIP"}, {"max": 66, "min": 0, "name": "LBhuMnaX"}, {"max": 3, "min": 83, "name": "unhuBCEW"}], [{"max": 91, "min": 2, "name": "iLcIY0DP"}, {"max": 54, "min": 87, "name": "71CTKjXB"}, {"max": 66, "min": 60, "name": "VQqYAZqL"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 100, "role_flexing_second": 88}, "duration": 37, "max_number": 27, "min_number": 66, "player_max_number": 38, "player_min_number": 26}, {"combination": {"alliances": [[{"max": 49, "min": 41, "name": "g8PAiy2k"}, {"max": 6, "min": 50, "name": "xQgd5ovn"}, {"max": 8, "min": 100, "name": "5Aroo9P2"}], [{"max": 29, "min": 2, "name": "sMaCO35p"}, {"max": 62, "min": 66, "name": "lcBTGcsg"}, {"max": 47, "min": 79, "name": "73WtH8G2"}], [{"max": 57, "min": 75, "name": "YV5HnRk2"}, {"max": 53, "min": 64, "name": "yr02Zmib"}, {"max": 9, "min": 89, "name": "cpcdrv3J"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 60, "role_flexing_second": 95}, "duration": 43, "max_number": 17, "min_number": 48, "player_max_number": 73, "player_min_number": 18}, {"combination": {"alliances": [[{"max": 29, "min": 23, "name": "aRSqfIGU"}, {"max": 51, "min": 3, "name": "0Vo4X4ld"}, {"max": 19, "min": 57, "name": "OVXa2wZt"}], [{"max": 3, "min": 48, "name": "3KFm0Xso"}, {"max": 28, "min": 42, "name": "ZLlsBYz5"}, {"max": 56, "min": 100, "name": "Xp4BGfCQ"}], [{"max": 80, "min": 13, "name": "TIx0Dolc"}, {"max": 37, "min": 64, "name": "d6ou7WCd"}, {"max": 46, "min": 37, "name": "W39iXwwj"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 14, "role_flexing_second": 18}, "duration": 41, "max_number": 100, "min_number": 76, "player_max_number": 31, "player_min_number": 28}], "name": "mmL81RMf"}}, "ticket_flexing_selection": "newest", "ticket_flexing_selections": [{"selection": "oldest", "threshold": 31}, {"selection": "newest", "threshold": 4}, {"selection": "pivot", "threshold": 43}], "use_newest_ticket_for_flexing": false}, "session_queue_timeout_seconds": 75, "social_matchmaking": false, "sub_gamemode_selection": "random", "ticket_observability_enable": true, "use_sub_gamemode": true}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateChannelHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 5 'CreateChannelHandler' test.out

#- 6 GetMatchPoolMetric
$CLI_EXE \
    --sn matchmaking \
    --op GetMatchPoolMetric \
    --channelName 'PPtZYuvb' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 6 'GetMatchPoolMetric' test.out

#- 7 DeleteChannelHandler
$CLI_EXE \
    --sn matchmaking \
    --op DeleteChannelHandler \
    --channel 'DIFesEe9' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 7 'DeleteChannelHandler' test.out

#- 8 StoreMatchResults
# body param: body
echo '{"match_id": "bQf7yZHC", "players": [{"results": [{"attribute": "Rj2VHkHa", "value": 0.6240196386872869}, {"attribute": "SReaZ0Vx", "value": 0.5661870501093974}, {"attribute": "Bk6VZvHy", "value": 0.6848085068859898}], "user_id": "3n6UCxya"}, {"results": [{"attribute": "Gj653OHV", "value": 0.9575206887062349}, {"attribute": "EWLr387F", "value": 0.20259546898037017}, {"attribute": "EzPe0Xe0", "value": 0.4423864880441484}], "user_id": "X6kQgQU5"}, {"results": [{"attribute": "yuIaMPW1", "value": 0.4601865007227516}, {"attribute": "PlwIsxOl", "value": 0.8810761558249837}, {"attribute": "djnCORpw", "value": 0.5228103918472651}], "user_id": "tlqHoR3D"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op StoreMatchResults \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 8 'StoreMatchResults' test.out

#- 9 Rebalance
# body param: body
echo '{"match_id": "LfMy0awJ"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op Rebalance \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 9 'Rebalance' test.out

#- 10 QueueSessionHandler
# body param: body
echo '{"channel": "E4YIMaT0", "client_version": "onfOzMQD", "deployment": "WVIbEFXz", "error_code": 18, "error_message": "RT2iK9kA", "game_mode": "yrPpojFy", "is_mock": "hWJo0mgC", "joinable": true, "match_id": "xIbf3kNw", "matching_allies": [{"matching_parties": [{"first_ticket_created_at": 83, "party_attributes": {"Msf2o9c0": {}, "V9pqT4LK": {}, "bAMP1sUM": {}}, "party_id": "u7RSlFc6", "party_members": [{"extra_attributes": {"RnJcMfFa": {}, "qnInUAdu": {}, "cBqn37zR": {}}, "user_id": "4FzYY6KZ"}, {"extra_attributes": {"DmFrv664": {}, "xEznEBtw": {}, "nmownH3o": {}}, "user_id": "ShdXy8PM"}, {"extra_attributes": {"Ixz4lUW0": {}, "mBI7FQg5": {}, "EabBAJNd": {}}, "user_id": "b2NEZDR8"}], "ticket_created_at": 8, "ticket_id": "5nmEw1de"}, {"first_ticket_created_at": 0, "party_attributes": {"acEFVpm8": {}, "wDlSo3TL": {}, "ANSqoN9Z": {}}, "party_id": "e7IfEu0w", "party_members": [{"extra_attributes": {"INBFaMXP": {}, "OKutx3fK": {}, "UNHMfq9I": {}}, "user_id": "ODt2ONIh"}, {"extra_attributes": {"lhdtFyoK": {}, "hPKiiXH2": {}, "dA5eaqNG": {}}, "user_id": "rBTROcxL"}, {"extra_attributes": {"HhoPSpG4": {}, "VZloioZv": {}, "ZVjIOV9K": {}}, "user_id": "O5SsxEXP"}], "ticket_created_at": 52, "ticket_id": "pn1pgMot"}, {"first_ticket_created_at": 52, "party_attributes": {"OKow58Ki": {}, "sxrbaAlb": {}, "byeROl58": {}}, "party_id": "1Wi0LC6y", "party_members": [{"extra_attributes": {"SKsHWlki": {}, "tvrTFOZQ": {}, "nU6KaC8B": {}}, "user_id": "ABKWfhtz"}, {"extra_attributes": {"DgzAKo2n": {}, "lQ25yCcH": {}, "Jclx18gr": {}}, "user_id": "Wk9cYuD4"}, {"extra_attributes": {"dgvTB8Zc": {}, "fl8dNgeV": {}, "HEqEK1J6": {}}, "user_id": "3gNb3lyZ"}], "ticket_created_at": 68, "ticket_id": "3XhS0iwo"}]}, {"matching_parties": [{"first_ticket_created_at": 70, "party_attributes": {"41LGlBnP": {}, "sioDhQZn": {}, "LTzqahYV": {}}, "party_id": "5n6dvOnt", "party_members": [{"extra_attributes": {"rWSMFe72": {}, "mY1W3XMZ": {}, "gGwEO619": {}}, "user_id": "JVJ3te4T"}, {"extra_attributes": {"ageLEu4N": {}, "Z1QQNow1": {}, "AU1tRH9M": {}}, "user_id": "On84C8AW"}, {"extra_attributes": {"UH6ZbWFy": {}, "8Muhy7kl": {}, "WVYwmAIb": {}}, "user_id": "n84jocZ3"}], "ticket_created_at": 60, "ticket_id": "876gNQn7"}, {"first_ticket_created_at": 34, "party_attributes": {"SIb0oyol": {}, "SuIgEERx": {}, "JGZ9hGYH": {}}, "party_id": "1VjoSk6z", "party_members": [{"extra_attributes": {"YUmmrfPB": {}, "9I9bbqFR": {}, "zenLsDfE": {}}, "user_id": "mvUbCcw5"}, {"extra_attributes": {"dGrwSowg": {}, "EAtY3ZfH": {}, "FkCp1Tg0": {}}, "user_id": "fSMckx7P"}, {"extra_attributes": {"iKTEIloG": {}, "CR7hoqqi": {}, "hAZcCEf7": {}}, "user_id": "pMnTpFUV"}], "ticket_created_at": 93, "ticket_id": "EWrGAYib"}, {"first_ticket_created_at": 72, "party_attributes": {"UrzTmy8L": {}, "cl8c0f4U": {}, "cv3NgWmr": {}}, "party_id": "Hv4YiJwm", "party_members": [{"extra_attributes": {"6J5Rlrkb": {}, "HQ0yAZbr": {}, "GLYFf728": {}}, "user_id": "Ev50grmL"}, {"extra_attributes": {"bkHEWDXK": {}, "JcZgezEy": {}, "he2wpMnw": {}}, "user_id": "gr4WE4gv"}, {"extra_attributes": {"SOaeK9nd": {}, "OlegtI5S": {}, "tB5hPLKc": {}}, "user_id": "YEZkK13t"}], "ticket_created_at": 25, "ticket_id": "54xaitmF"}]}, {"matching_parties": [{"first_ticket_created_at": 97, "party_attributes": {"hb0KULH7": {}, "6lJr24oa": {}, "WBvgPkDi": {}}, "party_id": "0lMgYiHb", "party_members": [{"extra_attributes": {"eebCJTfQ": {}, "o7Tc8e2L": {}, "liLhByiT": {}}, "user_id": "WQJuAWCI"}, {"extra_attributes": {"xdkUYOZO": {}, "CAoD1LpB": {}, "PGBrGCNH": {}}, "user_id": "bS1kNplc"}, {"extra_attributes": {"ELf5rPME": {}, "vJj4EkvA": {}, "1NXbdYyP": {}}, "user_id": "aJbPRfk4"}], "ticket_created_at": 52, "ticket_id": "PVtNtzKK"}, {"first_ticket_created_at": 91, "party_attributes": {"bgSLg55D": {}, "nt32nt5w": {}, "YOivEblM": {}}, "party_id": "j6mImZl1", "party_members": [{"extra_attributes": {"gUphTmbv": {}, "unN6vuZO": {}, "6te01N3z": {}}, "user_id": "HK7p824L"}, {"extra_attributes": {"tbEb6qmk": {}, "xY2HfdV5": {}, "fmZdNrfB": {}}, "user_id": "ASTevKts"}, {"extra_attributes": {"YB1oY2Ii": {}, "w4FoDepX": {}, "m5FxXJtl": {}}, "user_id": "OEi1aQOx"}], "ticket_created_at": 24, "ticket_id": "Hz4Tvc2q"}, {"first_ticket_created_at": 44, "party_attributes": {"HMJEkzWt": {}, "BnG1lK1W": {}, "Um254rju": {}}, "party_id": "Jp0gU4eM", "party_members": [{"extra_attributes": {"Ogl9DBwG": {}, "DAPNO9vB": {}, "3Neny6gD": {}}, "user_id": "iqsY5Tl7"}, {"extra_attributes": {"F3qougJo": {}, "yRZKbI00": {}, "xnqNPVcq": {}}, "user_id": "eNLE0ZmA"}, {"extra_attributes": {"LXFFtOhN": {}, "RprCl1Q0": {}, "hH3LuPot": {}}, "user_id": "m1eImUrI"}], "ticket_created_at": 25, "ticket_id": "Bpp6UunZ"}]}], "namespace": "ogm57R2p", "party_attributes": {"v5e0OT6R": {}, "KLo7UjA8": {}, "0x0zKm51": {}}, "party_id": "6Sc1XzKU", "queued_at": 81, "region": "zfpzhLMo", "server_name": "4XRvusgw", "status": "oNQ28kGX", "ticket_id": "7qxRZ0XV", "ticket_ids": ["SIaKHaLj", "4XJ71zHS", "zAQEU7Kp"], "updated_at": "1989-02-28T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op QueueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 10 'QueueSessionHandler' test.out

#- 11 DequeueSessionHandler
# body param: body
echo '{"match_id": "o2Rxwi5f"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op DequeueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 11 'DequeueSessionHandler' test.out

#- 12 QuerySessionHandler
$CLI_EXE \
    --sn matchmaking \
    --op QuerySessionHandler \
    --matchID 'rSdwxF9e' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 12 'QuerySessionHandler' test.out

#- 13 UpdatePlayTimeWeight
# body param: body
echo '{"playtime": 58, "userID": "l8vIotYl", "weight": 0.39540077414370034}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdatePlayTimeWeight \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 13 'UpdatePlayTimeWeight' test.out

#- 14 GetAllPartyInAllChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInAllChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 14 'GetAllPartyInAllChannel' test.out

#- 15 BulkGetSessions
$CLI_EXE \
    --sn matchmaking \
    --op BulkGetSessions \
    --namespace $AB_NAMESPACE \
    --matchIDs '3f5s4buT' \
    > test.out 2>&1
eval_tap $? 15 'BulkGetSessions' test.out

#- 16 ExportChannels
$CLI_EXE \
    --sn matchmaking \
    --op ExportChannels \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 16 'ExportChannels' test.out

#- 17 ImportChannels
# form data upload: file
echo 'tmp.dat' > $TEMP_FILE_UPLOAD
$CLI_EXE \
    --sn matchmaking \
    --op ImportChannels \
    --namespace $AB_NAMESPACE \
    --upload file $TEMP_FILE_UPLOAD \
    --strategy 'dvKVEJ4Z' \
    > test.out 2>&1
eval_tap $? 17 'ImportChannels' test.out

#- 18 GetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetSingleMatchmakingChannel \
    --channelName 'OH2MfReA' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 18 'GetSingleMatchmakingChannel' test.out

#- 19 UpdateMatchmakingChannel
# body param: body
echo '{"blocked_player_option": "blockedPlayerCanMatchOnDifferentTeam", "deployment": "YB4d00O6", "description": "Fni2l93l", "findMatchTimeoutSeconds": 32, "joinable": false, "max_delay_ms": 42, "region_expansion_range_ms": 2, "region_expansion_rate_ms": 47, "region_latency_initial_range_ms": 74, "region_latency_max_ms": 0, "ruleSet": {"alliance": {"combination": {"alliances": [[{"max": 25, "min": 43, "name": "STLJ9KdM"}, {"max": 32, "min": 72, "name": "Ruhtb2BG"}, {"max": 95, "min": 53, "name": "KmNUyvmF"}], [{"max": 65, "min": 41, "name": "mK1N7NFH"}, {"max": 46, "min": 57, "name": "PhhlrRZB"}, {"max": 12, "min": 76, "name": "LQ55b8TR"}], [{"max": 56, "min": 25, "name": "YnW2u55P"}, {"max": 9, "min": 12, "name": "4NnPaeMo"}, {"max": 38, "min": 60, "name": "vOXDCYfH"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 96, "role_flexing_second": 49}, "maxNumber": 22, "minNumber": 1, "playerMaxNumber": 18, "playerMinNumber": 75}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 18, "min": 2, "name": "EqnY0oti"}, {"max": 76, "min": 47, "name": "NdfjSvZ8"}, {"max": 33, "min": 71, "name": "EqZXsWcc"}], [{"max": 34, "min": 41, "name": "izwreW4E"}, {"max": 59, "min": 86, "name": "fK2dZLUY"}, {"max": 89, "min": 35, "name": "bTpD8dij"}], [{"max": 71, "min": 67, "name": "chjSRKIk"}, {"max": 91, "min": 39, "name": "6Z0A6lcv"}, {"max": 72, "min": 60, "name": "6LZM2tXZ"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 27, "role_flexing_second": 21}, "duration": 100, "max_number": 51, "min_number": 48, "player_max_number": 86, "player_min_number": 15}, {"combination": {"alliances": [[{"max": 53, "min": 35, "name": "4eiazSmS"}, {"max": 82, "min": 25, "name": "opPg5prf"}, {"max": 11, "min": 73, "name": "fkOx99Xb"}], [{"max": 90, "min": 7, "name": "faVdQ8VZ"}, {"max": 2, "min": 48, "name": "YaIZLj3k"}, {"max": 28, "min": 98, "name": "f8lSi6qN"}], [{"max": 19, "min": 54, "name": "oZ8V2461"}, {"max": 17, "min": 19, "name": "4uxWmi49"}, {"max": 55, "min": 22, "name": "nbvlnTlk"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 82, "role_flexing_second": 84}, "duration": 14, "max_number": 81, "min_number": 0, "player_max_number": 42, "player_min_number": 64}, {"combination": {"alliances": [[{"max": 29, "min": 9, "name": "Yp21cSWO"}, {"max": 42, "min": 76, "name": "0tdsOTnI"}, {"max": 12, "min": 97, "name": "TvhVJ1sU"}], [{"max": 66, "min": 46, "name": "YsiEvkSs"}, {"max": 46, "min": 100, "name": "C9kE1Dqx"}, {"max": 65, "min": 76, "name": "L7vyy3oI"}], [{"max": 85, "min": 23, "name": "iANvqyvi"}, {"max": 55, "min": 81, "name": "q9saeIxd"}, {"max": 29, "min": 70, "name": "bZmasdAv"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 77, "role_flexing_second": 56}, "duration": 48, "max_number": 10, "min_number": 29, "player_max_number": 76, "player_min_number": 3}], "batch_size": 59, "bucket_mmr_rule": {"disable_authority": true, "flex_authority_count": 16, "flex_flat_step_range": 6, "flex_immunity_count": 69, "flex_range_max": 33, "flex_rate_ms": 37, "flex_step_max": 31, "force_authority_match": false, "initial_step_range": 22, "mmr_max": 0, "mmr_mean": 85, "mmr_min": 23, "mmr_std_dev": 55, "override_mmr_data": false, "use_bucket_mmr": true, "use_flat_flex_step": false}, "flexingRules": [{"attribute": "lms4DYTB", "criteria": "5A1JXSkY", "duration": 97, "reference": 0.5355882885413737}, {"attribute": "NcXB7jw4", "criteria": "ZRrpZu8Y", "duration": 13, "reference": 0.697912788827656}, {"attribute": "BVzbCOQb", "criteria": "TLHVcpeE", "duration": 77, "reference": 0.48699255906039307}], "match_options": {"options": [{"name": "XsnR6nwC", "type": "p8L6O8ZL"}, {"name": "S11WMMTx", "type": "8m06Jmu1"}, {"name": "pIbmXoD0", "type": "rORNnlag"}]}, "matchingRules": [{"attribute": "rwxrVwlx", "criteria": "REZ2PL8b", "reference": 0.26364580206023935}, {"attribute": "tuMScC3t", "criteria": "bLFEF6AA", "reference": 0.501198676272844}, {"attribute": "xhBnvA4v", "criteria": "qjsS2HyS", "reference": 0.39973556749667194}], "sort_ticket": {"search_result": "random", "ticket_queue": "none"}, "sort_tickets": [{"search_result": "distance", "threshold": 97, "ticket_queue": "oldestTicketAge"}, {"search_result": "random", "threshold": 46, "ticket_queue": "largestPartySize"}, {"search_result": "distance", "threshold": 75, "ticket_queue": "random"}], "sub_game_modes": {}, "ticket_flexing_selection": "pivot", "ticket_flexing_selections": [{"selection": "pivot", "threshold": 75}, {"selection": "pivot", "threshold": 23}, {"selection": "newest", "threshold": 94}], "use_newest_ticket_for_flexing": true}, "sessionQueueTimeoutSeconds": 72, "socialMatchmaking": true, "sub_gamemode_selection": "random", "ticket_observability_enable": true, "use_sub_gamemode": true}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdateMatchmakingChannel \
    --channelName 'KDKvvCGR' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 19 'UpdateMatchmakingChannel' test.out

#- 20 CleanAllMocks
$CLI_EXE \
    --sn matchmaking \
    --op CleanAllMocks \
    --channelName 'f1CBTI9F' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 20 'CleanAllMocks' test.out

#- 21 GetAllMockMatches
$CLI_EXE \
    --sn matchmaking \
    --op GetAllMockMatches \
    --channelName '4c69kBl9' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 21 'GetAllMockMatches' test.out

#- 22 GetMockMatchesByTimestamp
# body param: body
echo '{"timestamp_after": 44}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op GetMockMatchesByTimestamp \
    --channelName 'rFR7VRa3' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 22 'GetMockMatchesByTimestamp' test.out

#- 23 GetAllMockTickets
$CLI_EXE \
    --sn matchmaking \
    --op GetAllMockTickets \
    --channelName '4G1EnKjI' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 23 'GetAllMockTickets' test.out

#- 24 CreateMockTickets
# body param: body
echo '{"attribute_name": "dYmFeqon", "count": 11, "mmrMax": 0.719206022090824, "mmrMean": 0.9707803097127, "mmrMin": 0.6991150280234927, "mmrStdDev": 0.6107527604869208}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateMockTickets \
    --channelName '4texg3na' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 24 'CreateMockTickets' test.out

#- 25 BulkCreateMockTickets
# body param: body
echo '[{"first_ticket_created_at": 54, "party_attributes": {"ZLOd8X1e": {}, "JYuej2h6": {}, "KgKG2XFB": {}}, "party_id": "3opbhkGx", "party_members": [{"extra_attributes": {"jhO0qVF5": {}, "PqnYz0dk": {}, "GUC9MzGD": {}}, "user_id": "5bA91vVt"}, {"extra_attributes": {"cSVF5dBM": {}, "3ti8R7yo": {}, "vvubriPY": {}}, "user_id": "Db2Sdh6G"}, {"extra_attributes": {"jNXNhEWG": {}, "roM4dO4q": {}, "43TB1SbE": {}}, "user_id": "QjbftIbX"}], "ticket_created_at": 92, "ticket_id": "pu8jYiDk"}, {"first_ticket_created_at": 88, "party_attributes": {"RpPeD9g6": {}, "wizkbUlc": {}, "4aW4wkvo": {}}, "party_id": "vZpTW3mB", "party_members": [{"extra_attributes": {"h81WCpNu": {}, "u7179kBI": {}, "5jScDkzN": {}}, "user_id": "U3bH7DqG"}, {"extra_attributes": {"G1gKBzAD": {}, "70NZXxTb": {}, "ECf8Srmt": {}}, "user_id": "NfUODklh"}, {"extra_attributes": {"zXed5bez": {}, "th5VtPI9": {}, "aePFNPVA": {}}, "user_id": "LfBN6DJd"}], "ticket_created_at": 67, "ticket_id": "3z9IU7fC"}, {"first_ticket_created_at": 23, "party_attributes": {"S819eoFL": {}, "CrSv2VYe": {}, "XP9X6yy8": {}}, "party_id": "dgXiiXZW", "party_members": [{"extra_attributes": {"wIB6pDS7": {}, "XersRzF8": {}, "JT979Tqy": {}}, "user_id": "MTnF6z5m"}, {"extra_attributes": {"DDfagVEv": {}, "gI2qF8So": {}, "orEYRAo7": {}}, "user_id": "DnUiTfTe"}, {"extra_attributes": {"ThETrdcP": {}, "HMY8ejxD": {}, "n1mWQYab": {}}, "user_id": "sIvEhh6s"}], "ticket_created_at": 94, "ticket_id": "1N9GyaAq"}]' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op BulkCreateMockTickets \
    --channelName 'CLCED9I5' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 25 'BulkCreateMockTickets' test.out

#- 26 GetMockTicketsByTimestamp
# body param: body
echo '{"timestamp_after": 58}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op GetMockTicketsByTimestamp \
    --channelName 'kjTggka4' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 26 'GetMockTicketsByTimestamp' test.out

#- 27 GetAllPartyInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInChannel \
    --channelName 'KKaTYtur' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 27 'GetAllPartyInChannel' test.out

#- 28 GetAllSessionsInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllSessionsInChannel \
    --channelName 'w1Ls94bs' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 28 'GetAllSessionsInChannel' test.out

#- 29 AddUserIntoSessionInChannel
# body param: body
echo '{"blocked_players": ["4UNNnp7f", "WEchbUu5", "w9t6BsFw"], "party_id": "xghtIZmJ", "user_id": "hvdqIUmJ"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op AddUserIntoSessionInChannel \
    --channelName '5D5rudHZ' \
    --matchID 'HMMcBHXa' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 29 'AddUserIntoSessionInChannel' test.out

#- 30 DeleteSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteSessionInChannel \
    --channelName '7iqaOvkG' \
    --matchID 'N3YEhiG0' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 30 'DeleteSessionInChannel' test.out

#- 31 DeleteUserFromSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteUserFromSessionInChannel \
    --channelName '112Hqp8Z' \
    --matchID 'mN92BFlY' \
    --namespace $AB_NAMESPACE \
    --userID 'J6qu5PT8' \
    > test.out 2>&1
eval_tap $? 31 'DeleteUserFromSessionInChannel' test.out

#- 32 GetStatData
$CLI_EXE \
    --sn matchmaking \
    --op GetStatData \
    --channelName 'iTJCmpCL' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 32 'GetStatData' test.out

#- 33 SearchSessions
eval_tap 0 33 'SearchSessions # SKIP deprecated' test.out

#- 34 GetSessionHistoryDetailed
eval_tap 0 34 'GetSessionHistoryDetailed # SKIP deprecated' test.out

#- 35 PublicGetMessages
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetMessages \
    > test.out 2>&1
eval_tap $? 35 'PublicGetMessages' test.out

#- 36 PublicGetAllMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetAllMatchmakingChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 36 'PublicGetAllMatchmakingChannel' test.out

#- 37 PublicGetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetSingleMatchmakingChannel \
    --channelName 'U89iDBRI' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 37 'PublicGetSingleMatchmakingChannel' test.out

#- 38 SearchSessionsV2
eval_tap 0 38 'SearchSessionsV2 # SKIP deprecated' test.out

#- 39 VersionCheckHandler
$CLI_EXE \
    --sn matchmaking \
    --op VersionCheckHandler \
    > test.out 2>&1
eval_tap $? 39 'VersionCheckHandler' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE