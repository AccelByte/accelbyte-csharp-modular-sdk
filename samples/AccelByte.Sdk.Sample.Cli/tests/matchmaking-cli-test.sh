#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 
# - template file: 

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..39"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 GetHealthcheckInfo
$CLI_EXE \
    --sn matchmaking \
    --op GetHealthcheckInfo \
    > test.out 2>&1
eval_tap $? 2 'GetHealthcheckInfo' test.out

#- 3 HandlerV3Healthz
$CLI_EXE \
    --sn matchmaking \
    --op HandlerV3Healthz \
    > test.out 2>&1
eval_tap $? 3 'HandlerV3Healthz' test.out

#- 4 GetAllChannelsHandler
$CLI_EXE \
    --sn matchmaking \
    --op GetAllChannelsHandler \
    --namespace $AB_NAMESPACE \
    --limit '94' \
    --offset '81' \
    > test.out 2>&1
eval_tap $? 4 'GetAllChannelsHandler' test.out

#- 5 CreateChannelHandler
# body param: body
echo '{"deployment": "Hf27quDU", "description": "go8F26jk", "find_match_timeout_seconds": 8, "game_mode": "Gzj0r8Pq", "joinable": true, "max_delay_ms": 94, "region_expansion_range_ms": 60, "region_expansion_rate_ms": 55, "region_latency_initial_range_ms": 68, "region_latency_max_ms": 80, "rule_set": {"alliance": {"combination": {"alliances": [[{"max": 97, "min": 12, "name": "0Yw7IuYI"}, {"max": 58, "min": 47, "name": "syZJ0Mk9"}, {"max": 9, "min": 47, "name": "OfFamfoc"}], [{"max": 72, "min": 29, "name": "X1EXZrUZ"}, {"max": 37, "min": 91, "name": "yMialnOD"}, {"max": 85, "min": 58, "name": "FF7lbJaD"}], [{"max": 47, "min": 99, "name": "a2oYLhTq"}, {"max": 19, "min": 32, "name": "1KlUhbv0"}, {"max": 0, "min": 8, "name": "kFZi7Fr6"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 27, "role_flexing_second": 35}, "max_number": 60, "min_number": 52, "player_max_number": 47, "player_min_number": 63}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 39, "min": 33, "name": "LfqY1NML"}, {"max": 31, "min": 15, "name": "u27sjsqH"}, {"max": 38, "min": 99, "name": "8TRlsJCx"}], [{"max": 89, "min": 58, "name": "gkOW9KYP"}, {"max": 60, "min": 63, "name": "hIiR8aqI"}, {"max": 13, "min": 21, "name": "9KMWzwxK"}], [{"max": 74, "min": 61, "name": "xlVja208"}, {"max": 97, "min": 55, "name": "1rWNGfth"}, {"max": 83, "min": 68, "name": "AQYVG0pq"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 29, "role_flexing_second": 71}, "duration": 39, "max_number": 10, "min_number": 77, "player_max_number": 51, "player_min_number": 73}, {"combination": {"alliances": [[{"max": 93, "min": 65, "name": "Zk9ijvRO"}, {"max": 26, "min": 33, "name": "KMdhzlPb"}, {"max": 12, "min": 11, "name": "7pHVNQT1"}], [{"max": 74, "min": 36, "name": "wulVpGg4"}, {"max": 10, "min": 84, "name": "JqIytIgF"}, {"max": 28, "min": 88, "name": "v9855BZ9"}], [{"max": 83, "min": 20, "name": "8inRUQoP"}, {"max": 97, "min": 83, "name": "RJmPwJf8"}, {"max": 63, "min": 69, "name": "JWaPviqD"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 56, "role_flexing_second": 13}, "duration": 85, "max_number": 30, "min_number": 30, "player_max_number": 87, "player_min_number": 68}, {"combination": {"alliances": [[{"max": 95, "min": 17, "name": "J01GQFai"}, {"max": 90, "min": 90, "name": "2kqeFteq"}, {"max": 52, "min": 77, "name": "l1ujtV5u"}], [{"max": 42, "min": 56, "name": "a8Yr1Hje"}, {"max": 51, "min": 45, "name": "OYGLAcAY"}, {"max": 98, "min": 56, "name": "u3tK0gxj"}], [{"max": 100, "min": 42, "name": "P2ZsDom1"}, {"max": 17, "min": 15, "name": "p2MrEgnh"}, {"max": 48, "min": 100, "name": "EWCjckPy"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 16, "role_flexing_second": 60}, "duration": 50, "max_number": 50, "min_number": 6, "player_max_number": 6, "player_min_number": 12}], "bucket_mmr_rule": {"disable_authority": true, "flex_authority_count": 83, "flex_flat_step_range": 82, "flex_immunity_count": 60, "flex_range_max": 22, "flex_rate_ms": 66, "flex_step_max": 55, "force_authority_match": false, "initial_step_range": 44, "mmr_max": 43, "mmr_mean": 47, "mmr_min": 92, "mmr_std_dev": 6, "override_mmr_data": true, "use_bucket_mmr": true, "use_flat_flex_step": true}, "flexing_rule": [{"attribute": "9H3LmjMi", "criteria": "gp14pSt3", "duration": 21, "reference": 0.5991399577633183}, {"attribute": "ziIkya9y", "criteria": "bMktsnMH", "duration": 67, "reference": 0.8541435795228248}, {"attribute": "QgxnyTJA", "criteria": "fT3kG57L", "duration": 13, "reference": 0.4253978854579721}], "match_options": {"options": [{"name": "qKxET7cm", "type": "aUMfhWmm"}, {"name": "t4FIltJH", "type": "njSxpJA5"}, {"name": "bAn4P8RQ", "type": "LZrMobon"}]}, "matching_rule": [{"attribute": "hXTCpum3", "criteria": "j5DBx7qb", "reference": 0.03911468659541095}, {"attribute": "LDn6BD25", "criteria": "iUa87NEp", "reference": 0.7728594119746863}, {"attribute": "BEQPnaAq", "criteria": "wk6P5B6q", "reference": 0.6416571998343782}], "rebalance_enable": false, "sub_game_modes": {"Jwyawk5N": {"alliance": {"combination": {"alliances": [[{"max": 70, "min": 64, "name": "LBIVE47b"}, {"max": 59, "min": 37, "name": "SnlDXyCr"}, {"max": 91, "min": 9, "name": "v5oMyriD"}], [{"max": 10, "min": 50, "name": "dSXcYYx5"}, {"max": 29, "min": 39, "name": "uTOO6Mis"}, {"max": 63, "min": 8, "name": "UQEc9U6K"}], [{"max": 58, "min": 20, "name": "vJmMR75j"}, {"max": 2, "min": 58, "name": "zaVbIB9R"}, {"max": 90, "min": 58, "name": "5ADh7gpO"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 1, "role_flexing_second": 41}, "max_number": 99, "min_number": 41, "player_max_number": 77, "player_min_number": 54}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 4, "min": 100, "name": "D8YO1bIN"}, {"max": 63, "min": 44, "name": "CYoaiwOy"}, {"max": 85, "min": 42, "name": "X0rKjxhY"}], [{"max": 91, "min": 6, "name": "b5DbixDE"}, {"max": 16, "min": 47, "name": "vh67H8TR"}, {"max": 16, "min": 35, "name": "8wgZoa5L"}], [{"max": 95, "min": 4, "name": "7rKQoJOW"}, {"max": 40, "min": 66, "name": "4J0P9BsS"}, {"max": 98, "min": 42, "name": "9eIt6MEb"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 78, "role_flexing_second": 13}, "duration": 17, "max_number": 14, "min_number": 11, "player_max_number": 77, "player_min_number": 23}, {"combination": {"alliances": [[{"max": 79, "min": 64, "name": "65141bMZ"}, {"max": 27, "min": 44, "name": "1weOEf7u"}, {"max": 47, "min": 92, "name": "js5CEd1t"}], [{"max": 72, "min": 58, "name": "RKrKZN9w"}, {"max": 24, "min": 99, "name": "aQVTAcWh"}, {"max": 25, "min": 49, "name": "czFxjdKb"}], [{"max": 61, "min": 3, "name": "HrxdQlF6"}, {"max": 69, "min": 12, "name": "f4wyL72z"}, {"max": 69, "min": 24, "name": "qsAHiN4A"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 18, "role_flexing_second": 76}, "duration": 18, "max_number": 67, "min_number": 61, "player_max_number": 93, "player_min_number": 79}, {"combination": {"alliances": [[{"max": 29, "min": 36, "name": "XtvSx6zE"}, {"max": 90, "min": 49, "name": "b6OtMoqM"}, {"max": 72, "min": 16, "name": "rEywKA93"}], [{"max": 98, "min": 16, "name": "OyPEh9IN"}, {"max": 40, "min": 78, "name": "01UdHWZ7"}, {"max": 46, "min": 16, "name": "KpXJCoNq"}], [{"max": 78, "min": 96, "name": "0UvhurBw"}, {"max": 95, "min": 26, "name": "K4a0fnHF"}, {"max": 48, "min": 58, "name": "XGbHIzYe"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 53, "role_flexing_second": 76}, "duration": 53, "max_number": 64, "min_number": 2, "player_max_number": 68, "player_min_number": 68}], "name": "4NyWVWCz"}, "1wCQ50y7": {"alliance": {"combination": {"alliances": [[{"max": 80, "min": 81, "name": "992tilNe"}, {"max": 54, "min": 70, "name": "oUkwkCw4"}, {"max": 58, "min": 26, "name": "aciYkuzk"}], [{"max": 28, "min": 16, "name": "daKoOp57"}, {"max": 50, "min": 85, "name": "rB4PwBes"}, {"max": 27, "min": 31, "name": "uQVnqCQj"}], [{"max": 81, "min": 35, "name": "vWyniKQ5"}, {"max": 87, "min": 3, "name": "NHgvM0jU"}, {"max": 15, "min": 59, "name": "ADxAlviK"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 26, "role_flexing_second": 54}, "max_number": 81, "min_number": 32, "player_max_number": 79, "player_min_number": 36}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 32, "min": 35, "name": "P3pTVZUi"}, {"max": 11, "min": 63, "name": "4hQv9GCy"}, {"max": 43, "min": 65, "name": "9fM3VWqb"}], [{"max": 32, "min": 88, "name": "QvwXfgIc"}, {"max": 74, "min": 22, "name": "qxCDsQKK"}, {"max": 42, "min": 76, "name": "9oRCOCEF"}], [{"max": 97, "min": 57, "name": "ajC4vLUy"}, {"max": 41, "min": 1, "name": "fdbpHz5s"}, {"max": 41, "min": 23, "name": "6Z9Y1iUL"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 87, "role_flexing_second": 38}, "duration": 96, "max_number": 7, "min_number": 1, "player_max_number": 73, "player_min_number": 89}, {"combination": {"alliances": [[{"max": 90, "min": 28, "name": "rBCJjmd9"}, {"max": 32, "min": 24, "name": "ya7k9QAN"}, {"max": 25, "min": 81, "name": "DM8RzWY0"}], [{"max": 36, "min": 71, "name": "foC2bPbb"}, {"max": 31, "min": 47, "name": "kWpPM8oT"}, {"max": 15, "min": 21, "name": "YKJHbr9y"}], [{"max": 41, "min": 95, "name": "GGTu9kou"}, {"max": 26, "min": 32, "name": "SvF0XFMl"}, {"max": 48, "min": 95, "name": "0RhTELUx"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 13, "role_flexing_second": 91}, "duration": 31, "max_number": 87, "min_number": 24, "player_max_number": 12, "player_min_number": 5}, {"combination": {"alliances": [[{"max": 2, "min": 20, "name": "TJk75Yn1"}, {"max": 13, "min": 46, "name": "7GFIzNti"}, {"max": 88, "min": 45, "name": "VuG1Vd0P"}], [{"max": 61, "min": 87, "name": "UyeV9e3V"}, {"max": 10, "min": 92, "name": "pkud59vA"}, {"max": 99, "min": 97, "name": "kKHHhb5U"}], [{"max": 70, "min": 21, "name": "GXQ1xjlq"}, {"max": 11, "min": 52, "name": "q8tkLiOb"}, {"max": 100, "min": 0, "name": "yvRwGyw1"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 29, "role_flexing_second": 25}, "duration": 10, "max_number": 1, "min_number": 2, "player_max_number": 15, "player_min_number": 10}], "name": "NdgHKA6f"}, "b9knP78J": {"alliance": {"combination": {"alliances": [[{"max": 3, "min": 45, "name": "sc3ViFVk"}, {"max": 60, "min": 54, "name": "7F5wxnai"}, {"max": 99, "min": 56, "name": "gwf3YhRH"}], [{"max": 59, "min": 27, "name": "N6AuwlXQ"}, {"max": 53, "min": 12, "name": "7fUQjdll"}, {"max": 32, "min": 71, "name": "81hisNCv"}], [{"max": 27, "min": 97, "name": "wVcs8VEt"}, {"max": 42, "min": 64, "name": "nybEewWe"}, {"max": 46, "min": 60, "name": "5iWZ04YK"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 33, "role_flexing_second": 89}, "max_number": 45, "min_number": 57, "player_max_number": 14, "player_min_number": 94}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 49, "min": 22, "name": "FFzb3ubw"}, {"max": 48, "min": 78, "name": "lcNoUNJS"}, {"max": 70, "min": 52, "name": "C0XHYkYL"}], [{"max": 100, "min": 91, "name": "Nt3FaMiT"}, {"max": 60, "min": 7, "name": "Tk8AoEn5"}, {"max": 52, "min": 50, "name": "EFvrDUCT"}], [{"max": 93, "min": 35, "name": "8bKYo8kH"}, {"max": 3, "min": 1, "name": "FIce9gox"}, {"max": 11, "min": 40, "name": "aBynGM4T"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 41, "role_flexing_second": 75}, "duration": 38, "max_number": 74, "min_number": 34, "player_max_number": 8, "player_min_number": 91}, {"combination": {"alliances": [[{"max": 6, "min": 25, "name": "x5cGAAyi"}, {"max": 77, "min": 49, "name": "XlzbuGkE"}, {"max": 73, "min": 86, "name": "Y98zYP2H"}], [{"max": 26, "min": 80, "name": "Enw6ODHy"}, {"max": 20, "min": 10, "name": "vAZXvlXo"}, {"max": 84, "min": 54, "name": "szdiy6Mc"}], [{"max": 54, "min": 95, "name": "Z8a5peeb"}, {"max": 59, "min": 2, "name": "sSzTWzR8"}, {"max": 88, "min": 71, "name": "CPlhxkTn"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 76, "role_flexing_second": 22}, "duration": 99, "max_number": 91, "min_number": 34, "player_max_number": 90, "player_min_number": 8}, {"combination": {"alliances": [[{"max": 32, "min": 2, "name": "ahXRCOcQ"}, {"max": 92, "min": 76, "name": "ptDAROcz"}, {"max": 71, "min": 86, "name": "dQITzM4h"}], [{"max": 18, "min": 90, "name": "yntmpsn2"}, {"max": 67, "min": 3, "name": "XPE6q2xT"}, {"max": 48, "min": 36, "name": "q20GPgVg"}], [{"max": 5, "min": 37, "name": "KFnVPrDr"}, {"max": 72, "min": 96, "name": "BUMq7s5F"}, {"max": 90, "min": 97, "name": "EgysrLaN"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 63, "role_flexing_second": 51}, "duration": 5, "max_number": 65, "min_number": 62, "player_max_number": 83, "player_min_number": 53}], "name": "4CJjX4IP"}}, "use_newest_ticket_for_flexing": true}, "session_queue_timeout_seconds": 37, "social_matchmaking": false, "ticket_observability_enable": false, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateChannelHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 5 'CreateChannelHandler' test.out

#- 6 GetMatchPoolMetric
$CLI_EXE \
    --sn matchmaking \
    --op GetMatchPoolMetric \
    --channelName 'ozLs6zBX' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 6 'GetMatchPoolMetric' test.out

#- 7 DeleteChannelHandler
$CLI_EXE \
    --sn matchmaking \
    --op DeleteChannelHandler \
    --channel '16VTv9R1' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 7 'DeleteChannelHandler' test.out

#- 8 StoreMatchResults
# body param: body
echo '{"match_id": "nhCpB6fC", "players": [{"results": [{"attribute": "21zNv4wC", "value": 0.5623995328197053}, {"attribute": "3GPq2mOC", "value": 0.9478367805192272}, {"attribute": "szqiHmTy", "value": 0.6943013927275639}], "user_id": "21fRFMPN"}, {"results": [{"attribute": "G2hMH224", "value": 0.41588221084658716}, {"attribute": "h0ci9e30", "value": 0.7642752872188976}, {"attribute": "hVE7VjVS", "value": 0.8721663628131028}], "user_id": "G4TNZvDP"}, {"results": [{"attribute": "Ze2d1By0", "value": 0.2646068042470068}, {"attribute": "3y0swM2x", "value": 0.6675744735875873}, {"attribute": "HZ4b6PMa", "value": 0.46505795357446056}], "user_id": "fT8uJ1gb"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op StoreMatchResults \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 8 'StoreMatchResults' test.out

#- 9 Rebalance
# body param: body
echo '{"match_id": "gcToskV6"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op Rebalance \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 9 'Rebalance' test.out

#- 10 QueueSessionHandler
# body param: body
echo '{"channel": "SVKfCBSi", "client_version": "Mx6xLW2E", "deployment": "KA60A19n", "error_code": 57, "error_message": "21aQw3Zs", "game_mode": "hIpx7Pcw", "is_mock": "12WjbWtZ", "joinable": true, "match_id": "LUCndbuE", "matching_allies": [{"matching_parties": [{"first_ticket_created_at": 35, "party_attributes": {"WLj2cI8o": {}, "135DbgyW": {}, "WFEIPRBo": {}}, "party_id": "yNTAN551", "party_members": [{"extra_attributes": {"9S5ml9uw": {}, "ika8hqJ5": {}, "ZoVYfGPT": {}}, "user_id": "2CLnDTyI"}, {"extra_attributes": {"XrZDxGO2": {}, "4vpjhN1I": {}, "IFIA0etY": {}}, "user_id": "FkpwPol5"}, {"extra_attributes": {"V3v8bwGk": {}, "Fj93CHWv": {}, "rDCugniJ": {}}, "user_id": "LJidYvZe"}], "ticket_created_at": 98, "ticket_id": "aVVTiQrb"}, {"first_ticket_created_at": 2, "party_attributes": {"XHgRmBSs": {}, "nXT4giOZ": {}, "YxP4M8S6": {}}, "party_id": "XKtl7Q0m", "party_members": [{"extra_attributes": {"f3kBVQrh": {}, "uPPPLl39": {}, "5RywNffJ": {}}, "user_id": "vOxr2ksb"}, {"extra_attributes": {"kHwErhbE": {}, "wO5LFoCq": {}, "8WrRIU8k": {}}, "user_id": "MhkWyLoM"}, {"extra_attributes": {"prPF1uSa": {}, "ozxa2kSJ": {}, "CSJHsxIK": {}}, "user_id": "UJJLiOmh"}], "ticket_created_at": 97, "ticket_id": "Niv7wnJs"}, {"first_ticket_created_at": 48, "party_attributes": {"DSuXH1aE": {}, "ucsoQwNF": {}, "LtnpI3pa": {}}, "party_id": "C0l1ysAk", "party_members": [{"extra_attributes": {"YoFWdE1d": {}, "ngiH3Vmd": {}, "Iru4HX5A": {}}, "user_id": "U6timzuo"}, {"extra_attributes": {"IFS0mh9R": {}, "CXBUMFCu": {}, "POgKRF1t": {}}, "user_id": "oXEznivo"}, {"extra_attributes": {"E4MxDYrn": {}, "Eods9cPC": {}, "f8Z2DGdM": {}}, "user_id": "uG1RkkkM"}], "ticket_created_at": 69, "ticket_id": "AlhBscm4"}]}, {"matching_parties": [{"first_ticket_created_at": 6, "party_attributes": {"WU5mN88Z": {}, "3S2ObLpz": {}, "tRcWmF7o": {}}, "party_id": "wJ9Txxni", "party_members": [{"extra_attributes": {"t4UhTcth": {}, "Ne4Y25Ha": {}, "zgLGFcb9": {}}, "user_id": "3FmschrS"}, {"extra_attributes": {"AqVUjtIE": {}, "HpMtbrOV": {}, "hjCwa20N": {}}, "user_id": "ekghKQeA"}, {"extra_attributes": {"DqeV20hT": {}, "F0ILeOKS": {}, "zO2E9G39": {}}, "user_id": "7qk8BEEY"}], "ticket_created_at": 4, "ticket_id": "JBs3OvRb"}, {"first_ticket_created_at": 27, "party_attributes": {"kiNfHe20": {}, "NxH1Z7VR": {}, "gg1v1EtS": {}}, "party_id": "3sjsFgnr", "party_members": [{"extra_attributes": {"4RyAQT2o": {}, "y1qHqfKb": {}, "ecIEoGsg": {}}, "user_id": "rGCzGvX6"}, {"extra_attributes": {"QNRrp342": {}, "Xg0gmWLW": {}, "5wy7SaBx": {}}, "user_id": "RAaWOUCj"}, {"extra_attributes": {"peA8Ihxu": {}, "Wx2tleWB": {}, "6oDqZe1r": {}}, "user_id": "gSu9Y8bR"}], "ticket_created_at": 43, "ticket_id": "VMrc3AAq"}, {"first_ticket_created_at": 90, "party_attributes": {"Zf5lXbSl": {}, "89kYyomh": {}, "oviOxhIT": {}}, "party_id": "j0wPXHnB", "party_members": [{"extra_attributes": {"WLu9ul9f": {}, "7u36FgAx": {}, "PYy7f4nV": {}}, "user_id": "BivAfWhS"}, {"extra_attributes": {"wUs1ZhBy": {}, "ukLgWJjU": {}, "jj07HTFh": {}}, "user_id": "hN4O5Kxm"}, {"extra_attributes": {"GZbyqpi6": {}, "nUcln4H4": {}, "zZuHBEvV": {}}, "user_id": "bZbNdnbI"}], "ticket_created_at": 10, "ticket_id": "fKjW7XWy"}]}, {"matching_parties": [{"first_ticket_created_at": 91, "party_attributes": {"YMzYEuAB": {}, "97yrTXse": {}, "ryKYUKqD": {}}, "party_id": "dFJPGslI", "party_members": [{"extra_attributes": {"VjbtfQLk": {}, "TFFxJANl": {}, "WUjVBb1X": {}}, "user_id": "5XyayThE"}, {"extra_attributes": {"G1d7QbKF": {}, "SQSn1Dey": {}, "IsgSBwZC": {}}, "user_id": "0tfdvaKS"}, {"extra_attributes": {"SlGsl36g": {}, "T7WOpJiM": {}, "WpJoVq4K": {}}, "user_id": "kW4mgBKM"}], "ticket_created_at": 56, "ticket_id": "b3vKEqiW"}, {"first_ticket_created_at": 99, "party_attributes": {"wrvhymzo": {}, "hbBLEcms": {}, "ThfA6cLI": {}}, "party_id": "uHg3bxWK", "party_members": [{"extra_attributes": {"vE1BQHRO": {}, "M29b3vkW": {}, "4yt1C6k2": {}}, "user_id": "TicqBoAp"}, {"extra_attributes": {"JniQFs9Z": {}, "fiIHwVjj": {}, "Er2Z7Jjo": {}}, "user_id": "MYLs0JNc"}, {"extra_attributes": {"x8a6GjKf": {}, "SfBZYHEY": {}, "Oc2l31gy": {}}, "user_id": "7PeuOP7c"}], "ticket_created_at": 21, "ticket_id": "6id9rm6m"}, {"first_ticket_created_at": 74, "party_attributes": {"GsTgtq5r": {}, "xy2fHSVU": {}, "V2OLu7LM": {}}, "party_id": "H64y2afq", "party_members": [{"extra_attributes": {"VJgAbmSJ": {}, "dQs7jYWj": {}, "tniizB17": {}}, "user_id": "HoXDQSCD"}, {"extra_attributes": {"F5123eQa": {}, "buwwDKH1": {}, "HId6B0I0": {}}, "user_id": "Uy0ZAiTr"}, {"extra_attributes": {"QMW0Sb5T": {}, "hZ3K0XaN": {}, "xQC44ahh": {}}, "user_id": "LuSgniEF"}], "ticket_created_at": 19, "ticket_id": "8LKws4Rv"}]}], "namespace": "DrhEC8pH", "party_attributes": {"zoDN4hKd": {}, "z28jMqsx": {}, "hXMQpsoE": {}}, "party_id": "zI9eXv5S", "queued_at": 9, "region": "TQfdc07P", "server_name": "nWeKU3s7", "status": "Z7HlJZRe", "ticket_id": "lhSNbhvY", "ticket_ids": ["9ym1IqTb", "obIo5BDN", "HKp3KEaB"], "updated_at": "1973-04-11T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op QueueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 10 'QueueSessionHandler' test.out

#- 11 DequeueSessionHandler
# body param: body
echo '{"match_id": "o0KI4OQ4"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op DequeueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 11 'DequeueSessionHandler' test.out

#- 12 QuerySessionHandler
$CLI_EXE \
    --sn matchmaking \
    --op QuerySessionHandler \
    --matchID 'irsNzg2O' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 12 'QuerySessionHandler' test.out

#- 13 UpdatePlayTimeWeight
# body param: body
echo '{"playtime": 76, "userID": "VkhbGHco", "weight": 0.34710074878905806}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdatePlayTimeWeight \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 13 'UpdatePlayTimeWeight' test.out

#- 14 GetAllPartyInAllChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInAllChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 14 'GetAllPartyInAllChannel' test.out

#- 15 BulkGetSessions
$CLI_EXE \
    --sn matchmaking \
    --op BulkGetSessions \
    --namespace $AB_NAMESPACE \
    --matchIDs 'PnW26flo' \
    > test.out 2>&1
eval_tap $? 15 'BulkGetSessions' test.out

#- 16 ExportChannels
$CLI_EXE \
    --sn matchmaking \
    --op ExportChannels \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 16 'ExportChannels' test.out

#- 17 ImportChannels
# form data upload: file
echo 'tmp.dat' > $TEMP_FILE_UPLOAD
$CLI_EXE \
    --sn matchmaking \
    --op ImportChannels \
    --namespace $AB_NAMESPACE \
    --upload $TEMP_FILE_UPLOAD \
    --strategy 'fu0F4v6X' \
    > test.out 2>&1
eval_tap $? 17 'ImportChannels' test.out

#- 18 GetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetSingleMatchmakingChannel \
    --channelName 'LRHcedgO' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 18 'GetSingleMatchmakingChannel' test.out

#- 19 UpdateMatchmakingChannel
# body param: body
echo '{"deployment": "ZGRnQOFQ", "description": "hgUXMbgO", "findMatchTimeoutSeconds": 44, "joinable": false, "max_delay_ms": 68, "region_expansion_range_ms": 20, "region_expansion_rate_ms": 51, "region_latency_initial_range_ms": 62, "region_latency_max_ms": 21, "ruleSet": {"alliance": {"combination": {"alliances": [[{"max": 18, "min": 4, "name": "WCZPmV6F"}, {"max": 23, "min": 94, "name": "2cJLbvdI"}, {"max": 80, "min": 62, "name": "JFuE29Cw"}], [{"max": 40, "min": 54, "name": "FDbNYjeW"}, {"max": 81, "min": 34, "name": "i7B96Fga"}, {"max": 51, "min": 38, "name": "pydI1lfm"}], [{"max": 53, "min": 56, "name": "skhZlX9V"}, {"max": 37, "min": 84, "name": "6taB3HBd"}, {"max": 19, "min": 66, "name": "s10k6RwT"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 28, "role_flexing_second": 91}, "maxNumber": 53, "minNumber": 76, "playerMaxNumber": 9, "playerMinNumber": 90}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 54, "min": 57, "name": "Em3me9We"}, {"max": 37, "min": 44, "name": "BJsHsZSD"}, {"max": 94, "min": 28, "name": "FJvKpn7I"}], [{"max": 80, "min": 40, "name": "V7R5bpzk"}, {"max": 10, "min": 42, "name": "LGcTzIKg"}, {"max": 33, "min": 3, "name": "RBv0ZtIm"}], [{"max": 65, "min": 81, "name": "q1OTkNKg"}, {"max": 90, "min": 82, "name": "grGSGRdZ"}, {"max": 0, "min": 87, "name": "eeqpuAZ6"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 21, "role_flexing_second": 32}, "duration": 66, "max_number": 98, "min_number": 74, "player_max_number": 59, "player_min_number": 64}, {"combination": {"alliances": [[{"max": 55, "min": 88, "name": "EjW3am8Q"}, {"max": 55, "min": 9, "name": "EMpBB6kS"}, {"max": 88, "min": 7, "name": "DNNzolq5"}], [{"max": 51, "min": 45, "name": "wsC5f6Li"}, {"max": 76, "min": 87, "name": "iEXdofBe"}, {"max": 93, "min": 65, "name": "N4Np1YvZ"}], [{"max": 60, "min": 26, "name": "NacRjRJD"}, {"max": 94, "min": 63, "name": "uDVQqV5t"}, {"max": 44, "min": 12, "name": "uunXcnJX"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 65, "role_flexing_second": 62}, "duration": 48, "max_number": 43, "min_number": 22, "player_max_number": 1, "player_min_number": 63}, {"combination": {"alliances": [[{"max": 17, "min": 51, "name": "Oaq33swo"}, {"max": 36, "min": 81, "name": "6ojw0fHD"}, {"max": 80, "min": 54, "name": "SFHDzyAS"}], [{"max": 76, "min": 37, "name": "Lgtg8fvd"}, {"max": 97, "min": 28, "name": "6D3jt7vI"}, {"max": 88, "min": 62, "name": "mZPMEwBe"}], [{"max": 99, "min": 31, "name": "DcovrERf"}, {"max": 49, "min": 0, "name": "j84KQU2B"}, {"max": 77, "min": 70, "name": "2W2aw3JL"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 57, "role_flexing_second": 38}, "duration": 62, "max_number": 64, "min_number": 57, "player_max_number": 23, "player_min_number": 1}], "bucket_mmr_rule": {"disable_authority": true, "flex_authority_count": 38, "flex_flat_step_range": 32, "flex_immunity_count": 9, "flex_range_max": 24, "flex_rate_ms": 25, "flex_step_max": 32, "force_authority_match": true, "initial_step_range": 34, "mmr_max": 92, "mmr_mean": 30, "mmr_min": 48, "mmr_std_dev": 80, "override_mmr_data": false, "use_bucket_mmr": false, "use_flat_flex_step": true}, "flexingRules": [{"attribute": "qh8EgLBn", "criteria": "VfM7sz1J", "duration": 0, "reference": 0.04019744010364623}, {"attribute": "WynFGgHZ", "criteria": "UxFmywCf", "duration": 94, "reference": 0.5357911706837076}, {"attribute": "x8OA1x2b", "criteria": "8lQdXdMs", "duration": 65, "reference": 0.15911743360590735}], "match_options": {"options": [{"name": "KxiXMpxQ", "type": "WGgw7EtJ"}, {"name": "Zt4R6V8o", "type": "PmOVAzD7"}, {"name": "KzNV5XwA", "type": "h3edUCij"}]}, "matchingRules": [{"attribute": "GYQu5hY7", "criteria": "A7jlyLau", "reference": 0.4480600857641255}, {"attribute": "5EXQGeBT", "criteria": "00tXhpkX", "reference": 0.2858224066241202}, {"attribute": "OFDHzXih", "criteria": "vQvG8s5u", "reference": 0.6971950758519817}], "sub_game_modes": {}, "use_newest_ticket_for_flexing": false}, "sessionQueueTimeoutSeconds": 35, "socialMatchmaking": true, "ticket_observability_enable": false, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdateMatchmakingChannel \
    --channelName 'dZgRZdgt' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 19 'UpdateMatchmakingChannel' test.out

#- 20 CleanAllMocks
$CLI_EXE \
    --sn matchmaking \
    --op CleanAllMocks \
    --channelName 'YVZUNB2d' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 20 'CleanAllMocks' test.out

#- 21 GetAllMockMatches
$CLI_EXE \
    --sn matchmaking \
    --op GetAllMockMatches \
    --channelName 'hVUCd3Fo' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 21 'GetAllMockMatches' test.out

#- 22 GetMockMatchesByTimestamp
# body param: body
echo '{"timestamp_after": 16}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op GetMockMatchesByTimestamp \
    --channelName 'mJnMbo9s' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 22 'GetMockMatchesByTimestamp' test.out

#- 23 GetAllMockTickets
$CLI_EXE \
    --sn matchmaking \
    --op GetAllMockTickets \
    --channelName 'eat7ngjQ' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 23 'GetAllMockTickets' test.out

#- 24 CreateMockTickets
# body param: body
echo '{"attribute_name": "CxEpFc7j", "count": 29, "mmrMax": 0.2949322406225169, "mmrMean": 0.692686425529071, "mmrMin": 0.7214225631801996, "mmrStdDev": 0.36365281304277297}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateMockTickets \
    --channelName 'mii9UJga' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 24 'CreateMockTickets' test.out

#- 25 BulkCreateMockTickets
# body param: body
echo '[{"first_ticket_created_at": 79, "party_attributes": {"40PwemBS": {}, "Z5L3mJ2i": {}, "7IOYgHfM": {}}, "party_id": "VvygL9h2", "party_members": [{"extra_attributes": {"WEnTWVlY": {}, "0YQ3uDJW": {}, "v1thCyYG": {}}, "user_id": "TG041uim"}, {"extra_attributes": {"VgPDikfE": {}, "hE5oBM9V": {}, "h4oQei5T": {}}, "user_id": "NI1tlpds"}, {"extra_attributes": {"8mewtjdh": {}, "yWFiTOaj": {}, "c2KTSKws": {}}, "user_id": "I8lawXJ0"}], "ticket_created_at": 44, "ticket_id": "9BImDGvU"}, {"first_ticket_created_at": 96, "party_attributes": {"U3OfdzuJ": {}, "iuwznYqH": {}, "DWgPyGMG": {}}, "party_id": "b3ACQ4aO", "party_members": [{"extra_attributes": {"LG3lo2gx": {}, "VeW1eC1d": {}, "LFI2SqYk": {}}, "user_id": "GESgoB1n"}, {"extra_attributes": {"axm1zH18": {}, "G7VkiJ3g": {}, "Uw80D3d2": {}}, "user_id": "iLfmU6gO"}, {"extra_attributes": {"1NIAAVqt": {}, "YH3obZFe": {}, "49B862wJ": {}}, "user_id": "KAMq0R82"}], "ticket_created_at": 40, "ticket_id": "8M0XchCq"}, {"first_ticket_created_at": 14, "party_attributes": {"Ymej6UEH": {}, "0gzHm3Na": {}, "EJxDAbdh": {}}, "party_id": "xnN6mJRd", "party_members": [{"extra_attributes": {"op7t6W67": {}, "F5GWGpMT": {}, "LzPqW6rm": {}}, "user_id": "WpK9Wq9Y"}, {"extra_attributes": {"wvnYMvpU": {}, "dK7M2vtD": {}, "JHYvHTvI": {}}, "user_id": "Vtg7kIPe"}, {"extra_attributes": {"6U8wh6ld": {}, "491eOtUF": {}, "RdUjUbzZ": {}}, "user_id": "hOwH3AlH"}], "ticket_created_at": 40, "ticket_id": "gQr30BXn"}]' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op BulkCreateMockTickets \
    --channelName 'KvXqqVa2' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 25 'BulkCreateMockTickets' test.out

#- 26 GetMockTicketsByTimestamp
# body param: body
echo '{"timestamp_after": 20}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op GetMockTicketsByTimestamp \
    --channelName 'bOnwU4Yo' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 26 'GetMockTicketsByTimestamp' test.out

#- 27 GetAllPartyInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInChannel \
    --channelName 'DTB7TBql' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 27 'GetAllPartyInChannel' test.out

#- 28 GetAllSessionsInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllSessionsInChannel \
    --channelName 'fh3XRfoZ' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 28 'GetAllSessionsInChannel' test.out

#- 29 AddUserIntoSessionInChannel
# body param: body
echo '{"blocked_players": ["j9mvEuGH", "fEmWKuM7", "qD9f1xpZ"], "party_id": "0I1HoPMF", "user_id": "2XU1CO27"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op AddUserIntoSessionInChannel \
    --channelName 'YVyHGyo1' \
    --matchID 'gozZKNkR' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 29 'AddUserIntoSessionInChannel' test.out

#- 30 DeleteSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteSessionInChannel \
    --channelName 'Fuyh95Ub' \
    --matchID 'eIfqH91k' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 30 'DeleteSessionInChannel' test.out

#- 31 DeleteUserFromSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteUserFromSessionInChannel \
    --channelName 'HSRcxXyv' \
    --matchID 'jKLoy1MH' \
    --namespace $AB_NAMESPACE \
    --userID 'DD68oByQ' \
    > test.out 2>&1
eval_tap $? 31 'DeleteUserFromSessionInChannel' test.out

#- 32 GetStatData
$CLI_EXE \
    --sn matchmaking \
    --op GetStatData \
    --channelName 'G7PKs3Vo' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 32 'GetStatData' test.out

#- 33 SearchSessions
eval_tap 0 33 'SearchSessions # SKIP deprecated' test.out

#- 34 GetSessionHistoryDetailed
eval_tap 0 34 'GetSessionHistoryDetailed # SKIP deprecated' test.out

#- 35 PublicGetMessages
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetMessages \
    > test.out 2>&1
eval_tap $? 35 'PublicGetMessages' test.out

#- 36 PublicGetAllMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetAllMatchmakingChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 36 'PublicGetAllMatchmakingChannel' test.out

#- 37 PublicGetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetSingleMatchmakingChannel \
    --channelName 'NDpLmuVa' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 37 'PublicGetSingleMatchmakingChannel' test.out

#- 38 SearchSessionsV2
eval_tap 0 38 'SearchSessionsV2 # SKIP deprecated' test.out

#- 39 VersionCheckHandler
$CLI_EXE \
    --sn matchmaking \
    --op VersionCheckHandler \
    > test.out 2>&1
eval_tap $? 39 'VersionCheckHandler' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE