#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 
# - template file: 

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..39"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 GetHealthcheckInfo
$CLI_EXE \
    --sn matchmaking \
    --op GetHealthcheckInfo \
    > test.out 2>&1
eval_tap $? 2 'GetHealthcheckInfo' test.out

#- 3 HandlerV3Healthz
$CLI_EXE \
    --sn matchmaking \
    --op HandlerV3Healthz \
    > test.out 2>&1
eval_tap $? 3 'HandlerV3Healthz' test.out

#- 4 GetAllChannelsHandler
$CLI_EXE \
    --sn matchmaking \
    --op GetAllChannelsHandler \
    --namespace $AB_NAMESPACE \
    --limit '44' \
    --offset '76' \
    > test.out 2>&1
eval_tap $? 4 'GetAllChannelsHandler' test.out

#- 5 CreateChannelHandler
# body param: body
echo '{"deployment": "TFMg97aP", "description": "GgAzTocL", "find_match_timeout_seconds": 69, "game_mode": "gVCmgCeK", "joinable": false, "max_delay_ms": 47, "region_expansion_range_ms": 59, "region_expansion_rate_ms": 87, "region_latency_initial_range_ms": 100, "region_latency_max_ms": 20, "rule_set": {"alliance": {"combination": {"alliances": [[{"max": 3, "min": 24, "name": "w6m91gm3"}, {"max": 32, "min": 26, "name": "xVm9ggDN"}, {"max": 12, "min": 77, "name": "MvlrnCIg"}], [{"max": 32, "min": 58, "name": "LoUIqYTg"}, {"max": 26, "min": 90, "name": "LxgFJaKv"}, {"max": 76, "min": 81, "name": "4Yk37D7S"}], [{"max": 41, "min": 87, "name": "5M2dTn57"}, {"max": 91, "min": 16, "name": "PwK2BVtW"}, {"max": 97, "min": 73, "name": "lKXYFddU"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 71, "role_flexing_second": 57}, "max_number": 58, "min_number": 74, "player_max_number": 66, "player_min_number": 71}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 22, "min": 17, "name": "ZBFaBM9n"}, {"max": 54, "min": 32, "name": "yu4VHztz"}, {"max": 42, "min": 89, "name": "7FGFZfLc"}], [{"max": 17, "min": 48, "name": "B1UCiOQM"}, {"max": 8, "min": 90, "name": "CdFkKFZi"}, {"max": 9, "min": 78, "name": "Dz3nUl9N"}], [{"max": 0, "min": 16, "name": "Z06ZwgHl"}, {"max": 68, "min": 61, "name": "h393ppbv"}, {"max": 10, "min": 91, "name": "llozjKcy"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 23, "role_flexing_second": 23}, "duration": 62, "max_number": 94, "min_number": 44, "player_max_number": 55, "player_min_number": 78}, {"combination": {"alliances": [[{"max": 66, "min": 83, "name": "MWGope0L"}, {"max": 41, "min": 22, "name": "CaCb2POf"}, {"max": 68, "min": 74, "name": "SKQZz6P7"}], [{"max": 68, "min": 8, "name": "nSxWHwLB"}, {"max": 11, "min": 16, "name": "ec9TJzmN"}, {"max": 96, "min": 98, "name": "ENXx1O9S"}], [{"max": 17, "min": 9, "name": "x5nzuHyw"}, {"max": 65, "min": 89, "name": "x1MjR64h"}, {"max": 38, "min": 10, "name": "IaqXm9xn"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 78, "role_flexing_second": 27}, "duration": 61, "max_number": 1, "min_number": 96, "player_max_number": 42, "player_min_number": 71}, {"combination": {"alliances": [[{"max": 27, "min": 70, "name": "bxgTDXHn"}, {"max": 60, "min": 90, "name": "Iw1OmUS9"}, {"max": 14, "min": 43, "name": "98rdPzTY"}], [{"max": 25, "min": 29, "name": "URGOzAMF"}, {"max": 24, "min": 100, "name": "SU29D4eJ"}, {"max": 91, "min": 4, "name": "UGJoBimT"}], [{"max": 67, "min": 33, "name": "io9eebsS"}, {"max": 54, "min": 18, "name": "CTr3Re6U"}, {"max": 88, "min": 34, "name": "CfR0oJcB"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 2, "role_flexing_second": 65}, "duration": 71, "max_number": 62, "min_number": 18, "player_max_number": 97, "player_min_number": 65}], "bucket_mmr_rule": {"disable_authority": false, "flex_authority_count": 17, "flex_flat_step_range": 69, "flex_immunity_count": 61, "flex_range_max": 60, "flex_rate_ms": 78, "flex_step_max": 1, "force_authority_match": false, "initial_step_range": 55, "mmr_max": 81, "mmr_mean": 43, "mmr_min": 87, "mmr_std_dev": 78, "override_mmr_data": false, "use_bucket_mmr": true, "use_flat_flex_step": false}, "flexing_rule": [{"attribute": "RoyzI8As", "criteria": "IICQIQZr", "duration": 9, "reference": 0.12718691531878012}, {"attribute": "YmmoFtS2", "criteria": "e9efVrPI", "duration": 92, "reference": 0.43782275472216914}, {"attribute": "9Bs7rsRw", "criteria": "aA6D9MnT", "duration": 83, "reference": 0.7070374447680373}], "match_options": {"options": [{"name": "SkMrvsJR", "type": "0OYLddFK"}, {"name": "3eFYASkU", "type": "e9pHa6jg"}, {"name": "FCyVfWay", "type": "HLF13BBe"}]}, "matching_rule": [{"attribute": "gQ6CVSGO", "criteria": "qOtKZASL", "reference": 0.43880336292570477}, {"attribute": "KexSaskT", "criteria": "N2OVMmxC", "reference": 0.21555153483846434}, {"attribute": "s7zTkwEz", "criteria": "aTf23lVs", "reference": 0.038062240743066966}], "rebalance_enable": false, "sub_game_modes": {"15uutWxI": {"alliance": {"combination": {"alliances": [[{"max": 41, "min": 21, "name": "MbRZXKRh"}, {"max": 48, "min": 27, "name": "KbCUPbfv"}, {"max": 57, "min": 42, "name": "mbmOptua"}], [{"max": 42, "min": 94, "name": "VSyWVE9a"}, {"max": 51, "min": 24, "name": "noiOd8sn"}, {"max": 83, "min": 94, "name": "c5pA5fFI"}], [{"max": 34, "min": 73, "name": "2O2nVtWQ"}, {"max": 50, "min": 36, "name": "5BYoygZ1"}, {"max": 2, "min": 47, "name": "V7smHcEr"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 49, "role_flexing_second": 30}, "max_number": 20, "min_number": 53, "player_max_number": 86, "player_min_number": 75}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 26, "min": 9, "name": "QMMKDJKP"}, {"max": 49, "min": 61, "name": "s6hHrhUE"}, {"max": 65, "min": 61, "name": "we2gTOyp"}], [{"max": 82, "min": 1, "name": "dOBxUxcb"}, {"max": 11, "min": 4, "name": "CTJ5foZL"}, {"max": 38, "min": 74, "name": "zHcDcyaw"}], [{"max": 42, "min": 67, "name": "g4VolrY9"}, {"max": 62, "min": 37, "name": "kzL5hORQ"}, {"max": 49, "min": 24, "name": "n4w1hdob"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 39, "role_flexing_second": 81}, "duration": 13, "max_number": 0, "min_number": 92, "player_max_number": 25, "player_min_number": 32}, {"combination": {"alliances": [[{"max": 81, "min": 99, "name": "XxXTIzjO"}, {"max": 48, "min": 33, "name": "evxJ1HJb"}, {"max": 42, "min": 46, "name": "ErPny9n1"}], [{"max": 81, "min": 51, "name": "KJbyCifd"}, {"max": 80, "min": 61, "name": "P8rTNGiH"}, {"max": 83, "min": 15, "name": "P5G6NSR9"}], [{"max": 35, "min": 78, "name": "4gmlHvjF"}, {"max": 54, "min": 58, "name": "KuvVaHKl"}, {"max": 15, "min": 86, "name": "bGwSmN3N"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 16, "role_flexing_second": 72}, "duration": 96, "max_number": 30, "min_number": 5, "player_max_number": 33, "player_min_number": 64}, {"combination": {"alliances": [[{"max": 10, "min": 6, "name": "jbMAhUUO"}, {"max": 20, "min": 18, "name": "jw2bDRX9"}, {"max": 2, "min": 32, "name": "6qdwDsNl"}], [{"max": 97, "min": 28, "name": "jX2SmQOO"}, {"max": 35, "min": 75, "name": "SU4To2HR"}, {"max": 41, "min": 4, "name": "6IoxQSb5"}], [{"max": 56, "min": 76, "name": "nfeKXDlv"}, {"max": 32, "min": 22, "name": "Di5P0ti4"}, {"max": 67, "min": 91, "name": "vTvQCpSC"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 69, "role_flexing_second": 23}, "duration": 39, "max_number": 48, "min_number": 87, "player_max_number": 98, "player_min_number": 19}], "name": "Z1zahlc5"}, "gsNMLVnx": {"alliance": {"combination": {"alliances": [[{"max": 31, "min": 64, "name": "3fQcVtw7"}, {"max": 64, "min": 17, "name": "YGTyMXmi"}, {"max": 83, "min": 49, "name": "NaWCc1Sa"}], [{"max": 60, "min": 95, "name": "4Xz7TE0d"}, {"max": 37, "min": 6, "name": "tFjPitoZ"}, {"max": 89, "min": 28, "name": "ZShmz0q2"}], [{"max": 15, "min": 86, "name": "u8LoKAhL"}, {"max": 16, "min": 5, "name": "YyxcJecK"}, {"max": 71, "min": 48, "name": "9I3ckmmt"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 13, "role_flexing_second": 9}, "max_number": 92, "min_number": 12, "player_max_number": 93, "player_min_number": 0}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 61, "min": 5, "name": "nstpxw1u"}, {"max": 93, "min": 70, "name": "MkNJuaIH"}, {"max": 31, "min": 60, "name": "hs0QsBo0"}], [{"max": 98, "min": 75, "name": "EaXZ0Q9p"}, {"max": 84, "min": 91, "name": "gxOyu1is"}, {"max": 67, "min": 5, "name": "ORbt3ysQ"}], [{"max": 36, "min": 86, "name": "mzQz1LvY"}, {"max": 27, "min": 47, "name": "61HkmCjW"}, {"max": 3, "min": 6, "name": "tVyWJoDf"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 47, "role_flexing_second": 14}, "duration": 24, "max_number": 38, "min_number": 52, "player_max_number": 24, "player_min_number": 9}, {"combination": {"alliances": [[{"max": 97, "min": 18, "name": "FJffdsT2"}, {"max": 89, "min": 100, "name": "fQS8e80c"}, {"max": 32, "min": 37, "name": "qBJK73xm"}], [{"max": 28, "min": 91, "name": "Qo2vjv37"}, {"max": 0, "min": 72, "name": "1PkMDozY"}, {"max": 47, "min": 94, "name": "ALsjrPRP"}], [{"max": 75, "min": 38, "name": "OedP1DPf"}, {"max": 64, "min": 35, "name": "HdHdQ0Ov"}, {"max": 80, "min": 65, "name": "3ZSnEfjo"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 92, "role_flexing_second": 46}, "duration": 19, "max_number": 56, "min_number": 24, "player_max_number": 26, "player_min_number": 32}, {"combination": {"alliances": [[{"max": 57, "min": 45, "name": "EcjqPqBq"}, {"max": 78, "min": 11, "name": "UmKEUSiM"}, {"max": 75, "min": 44, "name": "7uxgp3UN"}], [{"max": 36, "min": 78, "name": "5owWZgYt"}, {"max": 96, "min": 0, "name": "kOQtdUIu"}, {"max": 64, "min": 3, "name": "NF0r3uJV"}], [{"max": 98, "min": 15, "name": "ObtFQyGO"}, {"max": 90, "min": 35, "name": "YWbkMdH5"}, {"max": 15, "min": 54, "name": "Tjaql7et"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 68, "role_flexing_second": 99}, "duration": 74, "max_number": 10, "min_number": 41, "player_max_number": 24, "player_min_number": 78}], "name": "GrQtNbhl"}, "8uYWTjPi": {"alliance": {"combination": {"alliances": [[{"max": 63, "min": 74, "name": "dZEFPcrf"}, {"max": 53, "min": 46, "name": "tiCC9LZo"}, {"max": 51, "min": 59, "name": "e2Izm5jB"}], [{"max": 94, "min": 48, "name": "GsGneyWg"}, {"max": 12, "min": 43, "name": "oDAxJyU3"}, {"max": 92, "min": 91, "name": "Vq4PdhNt"}], [{"max": 82, "min": 10, "name": "U0ZfzaY5"}, {"max": 2, "min": 83, "name": "JtPBEY8N"}, {"max": 95, "min": 64, "name": "AKUmfwuz"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 78, "role_flexing_second": 83}, "max_number": 59, "min_number": 5, "player_max_number": 95, "player_min_number": 59}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 94, "min": 30, "name": "uJFiv6kF"}, {"max": 19, "min": 25, "name": "KIJWo293"}, {"max": 65, "min": 48, "name": "LKhORvWa"}], [{"max": 51, "min": 67, "name": "poapHVeQ"}, {"max": 84, "min": 63, "name": "8lAvCpEa"}, {"max": 10, "min": 56, "name": "F9LA0FEv"}], [{"max": 14, "min": 59, "name": "tMRRHnVM"}, {"max": 16, "min": 83, "name": "FkoQRFcN"}, {"max": 63, "min": 10, "name": "F9IVXu3r"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 73, "role_flexing_second": 16}, "duration": 29, "max_number": 24, "min_number": 19, "player_max_number": 40, "player_min_number": 39}, {"combination": {"alliances": [[{"max": 40, "min": 59, "name": "6RNIqaXg"}, {"max": 85, "min": 39, "name": "e0fOJgdK"}, {"max": 57, "min": 98, "name": "XjiRNl6e"}], [{"max": 28, "min": 95, "name": "15rnyhps"}, {"max": 96, "min": 5, "name": "KV4bAhx5"}, {"max": 72, "min": 85, "name": "2P1Wh33h"}], [{"max": 1, "min": 38, "name": "jEKSZCM1"}, {"max": 26, "min": 70, "name": "ZcVX4Edc"}, {"max": 48, "min": 67, "name": "eexzJh7g"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 30, "role_flexing_second": 49}, "duration": 91, "max_number": 51, "min_number": 34, "player_max_number": 65, "player_min_number": 72}, {"combination": {"alliances": [[{"max": 39, "min": 69, "name": "GVgGIRvq"}, {"max": 87, "min": 97, "name": "t15m6tmI"}, {"max": 20, "min": 38, "name": "88bhZ6X5"}], [{"max": 13, "min": 26, "name": "WnUxpluj"}, {"max": 14, "min": 22, "name": "9ycMNRLu"}, {"max": 95, "min": 85, "name": "KCMiYxSS"}], [{"max": 40, "min": 66, "name": "smcfB1px"}, {"max": 1, "min": 67, "name": "oN5jN3X8"}, {"max": 76, "min": 82, "name": "SJvCLbX6"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 30, "role_flexing_second": 46}, "duration": 64, "max_number": 83, "min_number": 48, "player_max_number": 59, "player_min_number": 87}], "name": "HcrAeKLz"}}, "use_newest_ticket_for_flexing": true}, "session_queue_timeout_seconds": 3, "social_matchmaking": true, "ticket_observability_enable": false, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateChannelHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 5 'CreateChannelHandler' test.out

#- 6 GetMatchPoolMetric
$CLI_EXE \
    --sn matchmaking \
    --op GetMatchPoolMetric \
    --channelName 'xp34YMzF' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 6 'GetMatchPoolMetric' test.out

#- 7 DeleteChannelHandler
$CLI_EXE \
    --sn matchmaking \
    --op DeleteChannelHandler \
    --channel 'LY7P7aTb' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 7 'DeleteChannelHandler' test.out

#- 8 StoreMatchResults
# body param: body
echo '{"match_id": "r0ZcZkLI", "players": [{"results": [{"attribute": "ZohONqFA", "value": 0.6436220013733135}, {"attribute": "3H65tYxf", "value": 0.7307193633429343}, {"attribute": "xtO8Vaq2", "value": 0.41456641585066845}], "user_id": "CHYEnr8m"}, {"results": [{"attribute": "85sQ1ewL", "value": 0.48255655912323336}, {"attribute": "BuKSo3VE", "value": 0.023269773909386116}, {"attribute": "1WfmYAWP", "value": 0.9903869108091462}], "user_id": "zhARuPsV"}, {"results": [{"attribute": "56ibkGs6", "value": 0.9249764207050538}, {"attribute": "BiWmWt9P", "value": 0.38753890473873087}, {"attribute": "Yscpzo7T", "value": 0.5405608516125074}], "user_id": "k1atyl8b"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op StoreMatchResults \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 8 'StoreMatchResults' test.out

#- 9 Rebalance
# body param: body
echo '{"match_id": "jWHfbFnr"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op Rebalance \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 9 'Rebalance' test.out

#- 10 QueueSessionHandler
# body param: body
echo '{"channel": "qLM1emZg", "client_version": "U8AR910k", "deployment": "37B8A6wJ", "error_code": 99, "error_message": "r8Vmp71b", "game_mode": "jp4JYXe4", "is_mock": "8NbOg4Db", "joinable": true, "match_id": "BDSfFwgd", "matching_allies": [{"matching_parties": [{"first_ticket_created_at": 63, "party_attributes": {"MUkTICGs": {}, "tf4gW7gQ": {}, "s4h31mGw": {}}, "party_id": "tmKCpYnQ", "party_members": [{"extra_attributes": {"7K3KXwml": {}, "4FbZFopf": {}, "3gervkdG": {}}, "user_id": "caOEoCAu"}, {"extra_attributes": {"DeKSoV6Z": {}, "uTOzzagW": {}, "J8Jov10U": {}}, "user_id": "3JvhNtXr"}, {"extra_attributes": {"KagRHWAV": {}, "UwfDyt8f": {}, "LFVCtHCw": {}}, "user_id": "pr98OTIX"}], "ticket_created_at": 46, "ticket_id": "ZDmczia6"}, {"first_ticket_created_at": 57, "party_attributes": {"Cun7ildL": {}, "vU2Z3M4E": {}, "sNHUaN8A": {}}, "party_id": "RPc2Q6n9", "party_members": [{"extra_attributes": {"yfC9dPRq": {}, "qS46WDQs": {}, "mgFX2Xe7": {}}, "user_id": "cOtqDv8X"}, {"extra_attributes": {"XQswYhlc": {}, "xo84oXmM": {}, "T70neoeH": {}}, "user_id": "sR68GamE"}, {"extra_attributes": {"6yEFdxGX": {}, "mCxlrfI2": {}, "neNWHG56": {}}, "user_id": "91ougMHN"}], "ticket_created_at": 92, "ticket_id": "USwKsb2R"}, {"first_ticket_created_at": 93, "party_attributes": {"fitPQnod": {}, "YRkAeBjN": {}, "SG5qxd7Z": {}}, "party_id": "EqdFRkmC", "party_members": [{"extra_attributes": {"Xs3aYYO4": {}, "ynnbukWm": {}, "J1IduUq2": {}}, "user_id": "XWDAIaHn"}, {"extra_attributes": {"QTQtwo6z": {}, "YR7ZQgQP": {}, "lWiiP9YT": {}}, "user_id": "1iHlABsY"}, {"extra_attributes": {"WjcdkT79": {}, "LgxDVfXO": {}, "djelvSQq": {}}, "user_id": "OGniVA8n"}], "ticket_created_at": 37, "ticket_id": "sgRXVglO"}]}, {"matching_parties": [{"first_ticket_created_at": 74, "party_attributes": {"ydEiBCC8": {}, "D5trIh2L": {}, "TZnu6N2I": {}}, "party_id": "nLAOAuLk", "party_members": [{"extra_attributes": {"OOluLXPN": {}, "E5X6I1XZ": {}, "dqGdOnW7": {}}, "user_id": "PTy2iMCU"}, {"extra_attributes": {"6MVmzyIN": {}, "39l52tER": {}, "sA8jNnt8": {}}, "user_id": "nrdhoVqK"}, {"extra_attributes": {"tbhDEnuW": {}, "BJefmiQU": {}, "8qkMGNEI": {}}, "user_id": "w2EQVDAc"}], "ticket_created_at": 51, "ticket_id": "SndCEAjZ"}, {"first_ticket_created_at": 70, "party_attributes": {"v9CHbOs4": {}, "SdzawuuY": {}, "TFftlVTK": {}}, "party_id": "RQLFSmMf", "party_members": [{"extra_attributes": {"OHZONgAx": {}, "Fm9QzgYs": {}, "7JPzSWt2": {}}, "user_id": "Mii8hWzd"}, {"extra_attributes": {"eT7uh00u": {}, "TXx62DBt": {}, "Ea9siahz": {}}, "user_id": "ChV358RT"}, {"extra_attributes": {"GjGszVqb": {}, "Qfr9lMF4": {}, "vdIHIQWM": {}}, "user_id": "94jR7q97"}], "ticket_created_at": 9, "ticket_id": "P46EZIi1"}, {"first_ticket_created_at": 79, "party_attributes": {"o9d8emMT": {}, "6m5lNrHB": {}, "YziAbXKt": {}}, "party_id": "pksAzxaI", "party_members": [{"extra_attributes": {"gsbUqfrx": {}, "z5Jckml5": {}, "9LxABZjL": {}}, "user_id": "S5leM686"}, {"extra_attributes": {"B8p9ZGsj": {}, "TwsHP7np": {}, "mcKoizBD": {}}, "user_id": "HA7JmCCs"}, {"extra_attributes": {"c8DZNgCn": {}, "eFJflgCr": {}, "X6TB5QR1": {}}, "user_id": "JPNYaey6"}], "ticket_created_at": 85, "ticket_id": "59blNSvo"}]}, {"matching_parties": [{"first_ticket_created_at": 6, "party_attributes": {"Tq5kUrlh": {}, "XIqx3Pi8": {}, "KKq4GdIh": {}}, "party_id": "vaIlBdWK", "party_members": [{"extra_attributes": {"YvrRukBE": {}, "DPNgrvtc": {}, "ecxlbmgA": {}}, "user_id": "U28qJ6KC"}, {"extra_attributes": {"f0c9nQ9u": {}, "Fr2Vzd5I": {}, "iowaD7Vj": {}}, "user_id": "MWrx7wxd"}, {"extra_attributes": {"unzFRna9": {}, "rchgMGea": {}, "lIaxHO6F": {}}, "user_id": "7fKflj9T"}], "ticket_created_at": 46, "ticket_id": "ZE0pYGhv"}, {"first_ticket_created_at": 80, "party_attributes": {"IUyWt9v4": {}, "1XZQkq4v": {}, "Lvu4SNDA": {}}, "party_id": "QQfzTzqu", "party_members": [{"extra_attributes": {"mTkHK340": {}, "JdANdPGt": {}, "dZX66JDs": {}}, "user_id": "F2ScWHu8"}, {"extra_attributes": {"ChgcXfCp": {}, "DeS0WjVz": {}, "JdE4NzP6": {}}, "user_id": "Fl4BiqOw"}, {"extra_attributes": {"MlMSp4sr": {}, "lEHwZcca": {}, "CdK8zEaP": {}}, "user_id": "0AuqcZ8c"}], "ticket_created_at": 92, "ticket_id": "kXMfZG3w"}, {"first_ticket_created_at": 40, "party_attributes": {"3q4ulN0w": {}, "eLY9GYE7": {}, "TWcOaHO1": {}}, "party_id": "RhVvCvb6", "party_members": [{"extra_attributes": {"GlmCp7N6": {}, "o1nfp5rS": {}, "LUIpntdP": {}}, "user_id": "iWY9yKyY"}, {"extra_attributes": {"tkHWjGCZ": {}, "HhwKVX6b": {}, "UkxSGVQd": {}}, "user_id": "njIV52lo"}, {"extra_attributes": {"LbT5sNLI": {}, "qe8NV7OH": {}, "oZ5Mv6Xo": {}}, "user_id": "uieun3To"}], "ticket_created_at": 42, "ticket_id": "GwpSpU84"}]}], "namespace": "rcXEDo46", "party_attributes": {"58HpOOqI": {}, "KIDly0Nu": {}, "7NLM7Mwf": {}}, "party_id": "LPNfjxtM", "queued_at": 43, "region": "aEUmO3zm", "server_name": "sTXT7Jkc", "status": "7nYnDGYM", "ticket_id": "8CAgNvK4", "ticket_ids": ["1JKQOIsb", "38og7rPp", "Z4gBwV50"], "updated_at": "1995-03-28T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op QueueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 10 'QueueSessionHandler' test.out

#- 11 DequeueSessionHandler
# body param: body
echo '{"match_id": "MRwySAhQ"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op DequeueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 11 'DequeueSessionHandler' test.out

#- 12 QuerySessionHandler
$CLI_EXE \
    --sn matchmaking \
    --op QuerySessionHandler \
    --matchID 'pFAtjRmJ' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 12 'QuerySessionHandler' test.out

#- 13 UpdatePlayTimeWeight
# body param: body
echo '{"playtime": 44, "userID": "mpTBpd0l", "weight": 0.785748901335563}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdatePlayTimeWeight \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 13 'UpdatePlayTimeWeight' test.out

#- 14 GetAllPartyInAllChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInAllChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 14 'GetAllPartyInAllChannel' test.out

#- 15 BulkGetSessions
$CLI_EXE \
    --sn matchmaking \
    --op BulkGetSessions \
    --namespace $AB_NAMESPACE \
    --matchIDs '0k6mIBcT' \
    > test.out 2>&1
eval_tap $? 15 'BulkGetSessions' test.out

#- 16 ExportChannels
$CLI_EXE \
    --sn matchmaking \
    --op ExportChannels \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 16 'ExportChannels' test.out

#- 17 ImportChannels
# form data upload: file
echo 'tmp.dat' > $TEMP_FILE_UPLOAD
$CLI_EXE \
    --sn matchmaking \
    --op ImportChannels \
    --namespace $AB_NAMESPACE \
    --upload $TEMP_FILE_UPLOAD \
    --strategy 'Y6JsaLHt' \
    > test.out 2>&1
eval_tap $? 17 'ImportChannels' test.out

#- 18 GetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetSingleMatchmakingChannel \
    --channelName 'YRIf1Dml' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 18 'GetSingleMatchmakingChannel' test.out

#- 19 UpdateMatchmakingChannel
# body param: body
echo '{"deployment": "n1F3UAgc", "description": "F5urkOdn", "findMatchTimeoutSeconds": 83, "joinable": true, "max_delay_ms": 58, "region_expansion_range_ms": 32, "region_expansion_rate_ms": 66, "region_latency_initial_range_ms": 83, "region_latency_max_ms": 61, "ruleSet": {"alliance": {"combination": {"alliances": [[{"max": 28, "min": 23, "name": "vAwYo1fH"}, {"max": 49, "min": 16, "name": "BhZ6qonr"}, {"max": 45, "min": 15, "name": "HCckgUj5"}], [{"max": 98, "min": 49, "name": "4EFtQAKe"}, {"max": 1, "min": 1, "name": "VXF5cWa7"}, {"max": 14, "min": 28, "name": "rCHSW2tt"}], [{"max": 77, "min": 73, "name": "ixEvvg0V"}, {"max": 8, "min": 18, "name": "hwjsxCEH"}, {"max": 4, "min": 87, "name": "uO6IxwO6"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 53, "role_flexing_second": 45}, "maxNumber": 56, "minNumber": 16, "playerMaxNumber": 2, "playerMinNumber": 42}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 14, "min": 90, "name": "XIk77AOg"}, {"max": 7, "min": 74, "name": "OgWNszZx"}, {"max": 7, "min": 7, "name": "tjIN66e0"}], [{"max": 57, "min": 28, "name": "xS2gB3TY"}, {"max": 44, "min": 78, "name": "jH4u0fBU"}, {"max": 65, "min": 32, "name": "FRIDkZtr"}], [{"max": 76, "min": 69, "name": "kPSIizOZ"}, {"max": 93, "min": 1, "name": "UxuEgFzW"}, {"max": 32, "min": 21, "name": "c9ACr0ZT"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 25, "role_flexing_second": 80}, "duration": 91, "max_number": 31, "min_number": 49, "player_max_number": 15, "player_min_number": 9}, {"combination": {"alliances": [[{"max": 59, "min": 3, "name": "lDbjdOin"}, {"max": 24, "min": 31, "name": "pUYmTI7m"}, {"max": 7, "min": 68, "name": "NDyNlit6"}], [{"max": 53, "min": 41, "name": "PVxDC4I0"}, {"max": 45, "min": 93, "name": "1ppO1uFF"}, {"max": 67, "min": 87, "name": "4LPgIkxn"}], [{"max": 98, "min": 69, "name": "rkAOlBg0"}, {"max": 6, "min": 28, "name": "oZM2n6ds"}, {"max": 58, "min": 33, "name": "rE9sUihv"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 80, "role_flexing_second": 47}, "duration": 18, "max_number": 15, "min_number": 19, "player_max_number": 61, "player_min_number": 34}, {"combination": {"alliances": [[{"max": 60, "min": 26, "name": "NRKINtsP"}, {"max": 78, "min": 9, "name": "OFDqch9w"}, {"max": 9, "min": 84, "name": "zdJ1ULXz"}], [{"max": 98, "min": 55, "name": "deIh7wtj"}, {"max": 70, "min": 39, "name": "ngBFL1Mz"}, {"max": 68, "min": 45, "name": "YuERcUZM"}], [{"max": 5, "min": 0, "name": "noysWkyP"}, {"max": 59, "min": 69, "name": "Fe34H7qs"}, {"max": 78, "min": 75, "name": "ccJqYvBz"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 2, "role_flexing_second": 43}, "duration": 5, "max_number": 34, "min_number": 28, "player_max_number": 84, "player_min_number": 33}], "bucket_mmr_rule": {"disable_authority": true, "flex_authority_count": 50, "flex_flat_step_range": 84, "flex_immunity_count": 71, "flex_range_max": 41, "flex_rate_ms": 62, "flex_step_max": 80, "force_authority_match": true, "initial_step_range": 74, "mmr_max": 36, "mmr_mean": 0, "mmr_min": 44, "mmr_std_dev": 49, "override_mmr_data": false, "use_bucket_mmr": true, "use_flat_flex_step": true}, "flexingRules": [{"attribute": "leXp0lyk", "criteria": "N0iATeUN", "duration": 11, "reference": 0.4788015955232715}, {"attribute": "ccEqF3qF", "criteria": "bObFDbbU", "duration": 91, "reference": 0.05421904530519028}, {"attribute": "0Z6Izv72", "criteria": "gvjkr5HY", "duration": 50, "reference": 0.8306338560791474}], "match_options": {"options": [{"name": "QpHUKcN9", "type": "Pe16SWOj"}, {"name": "RpmBTAt4", "type": "XxbrhGeq"}, {"name": "ydZO6Xvk", "type": "YzbAhTdO"}]}, "matchingRules": [{"attribute": "KZ8mhYjl", "criteria": "sxuYOAUQ", "reference": 0.7860581575494685}, {"attribute": "1ExEjtCH", "criteria": "EsuYHOZL", "reference": 0.4521739484072633}, {"attribute": "WAGUO2Ml", "criteria": "asWyc1DM", "reference": 0.5021473642027936}], "sub_game_modes": {}, "use_newest_ticket_for_flexing": true}, "sessionQueueTimeoutSeconds": 16, "socialMatchmaking": false, "ticket_observability_enable": false, "use_sub_gamemode": false}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdateMatchmakingChannel \
    --channelName 't7lx8ef2' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 19 'UpdateMatchmakingChannel' test.out

#- 20 CleanAllMocks
$CLI_EXE \
    --sn matchmaking \
    --op CleanAllMocks \
    --channelName 'sSAUuHg1' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 20 'CleanAllMocks' test.out

#- 21 GetAllMockMatches
$CLI_EXE \
    --sn matchmaking \
    --op GetAllMockMatches \
    --channelName 'IBG6bybg' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 21 'GetAllMockMatches' test.out

#- 22 GetMockMatchesByTimestamp
# body param: body
echo '{"timestamp_after": 87}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op GetMockMatchesByTimestamp \
    --channelName 'pBwHMZl7' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 22 'GetMockMatchesByTimestamp' test.out

#- 23 GetAllMockTickets
$CLI_EXE \
    --sn matchmaking \
    --op GetAllMockTickets \
    --channelName '1fWtnDnS' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 23 'GetAllMockTickets' test.out

#- 24 CreateMockTickets
# body param: body
echo '{"attribute_name": "CLZFIWLL", "count": 53, "mmrMax": 0.3069336639351178, "mmrMean": 0.515281955862992, "mmrMin": 0.33684643640264356, "mmrStdDev": 0.23142169521780154}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateMockTickets \
    --channelName 'ix0ITdtJ' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 24 'CreateMockTickets' test.out

#- 25 BulkCreateMockTickets
# body param: body
echo '[{"first_ticket_created_at": 94, "party_attributes": {"9EV6te1y": {}, "hgQR7qQs": {}, "SahhlY0Q": {}}, "party_id": "2AsnZANw", "party_members": [{"extra_attributes": {"ywXjGRfi": {}, "ACBmjwRQ": {}, "9eOLf9fl": {}}, "user_id": "s9nBbnTg"}, {"extra_attributes": {"KnRRet2d": {}, "XVFxPpXT": {}, "OpFfu5DE": {}}, "user_id": "2lhIBM8h"}, {"extra_attributes": {"v8nJbF1v": {}, "0YRe43p0": {}, "mhSW1RrF": {}}, "user_id": "QoqE5GN1"}], "ticket_created_at": 17, "ticket_id": "DBOpnWjH"}, {"first_ticket_created_at": 51, "party_attributes": {"H6LGlaTO": {}, "eVzBBUMP": {}, "qFeAZXuM": {}}, "party_id": "C7EnWpql", "party_members": [{"extra_attributes": {"GtP4rl74": {}, "V4LVwk7P": {}, "Dfjskhxh": {}}, "user_id": "JSRGP2wC"}, {"extra_attributes": {"QlE1OEL0": {}, "GSwBJDSZ": {}, "2AwYnPim": {}}, "user_id": "EaiJanrw"}, {"extra_attributes": {"1ysyohKs": {}, "CbjLuRhs": {}, "Ivzmn60g": {}}, "user_id": "JjvWcI3P"}], "ticket_created_at": 98, "ticket_id": "9FDZJuJr"}, {"first_ticket_created_at": 48, "party_attributes": {"hXxJ1CE9": {}, "yJ896Ai7": {}, "K3OeQOwX": {}}, "party_id": "8oh3PDKs", "party_members": [{"extra_attributes": {"NvRkCkJn": {}, "thtCIlkw": {}, "lt3kTGXx": {}}, "user_id": "CEHIAFUm"}, {"extra_attributes": {"lcZVcepQ": {}, "pdG8Zxq6": {}, "IF6dKuGG": {}}, "user_id": "Jme2qAvv"}, {"extra_attributes": {"2lBe8GEv": {}, "q95Udem0": {}, "v8RMrXum": {}}, "user_id": "emxla22i"}], "ticket_created_at": 58, "ticket_id": "O4xniQCQ"}]' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op BulkCreateMockTickets \
    --channelName '3yCXhNGn' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 25 'BulkCreateMockTickets' test.out

#- 26 GetMockTicketsByTimestamp
# body param: body
echo '{"timestamp_after": 38}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op GetMockTicketsByTimestamp \
    --channelName 'NJuHCogi' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 26 'GetMockTicketsByTimestamp' test.out

#- 27 GetAllPartyInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInChannel \
    --channelName 'CcYhIfbj' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 27 'GetAllPartyInChannel' test.out

#- 28 GetAllSessionsInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllSessionsInChannel \
    --channelName 'jaUWfcJT' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 28 'GetAllSessionsInChannel' test.out

#- 29 AddUserIntoSessionInChannel
# body param: body
echo '{"blocked_players": ["PuJDqJgo", "9pEsRehB", "kZ23A8xK"], "party_id": "sVpBgB6l", "user_id": "xyYEvSgW"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op AddUserIntoSessionInChannel \
    --channelName '9afdS0AF' \
    --matchID 'PYfJoEm5' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 29 'AddUserIntoSessionInChannel' test.out

#- 30 DeleteSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteSessionInChannel \
    --channelName 'LVQuptEy' \
    --matchID 'awbeHMFh' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 30 'DeleteSessionInChannel' test.out

#- 31 DeleteUserFromSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteUserFromSessionInChannel \
    --channelName 'NoHybGrJ' \
    --matchID 'iV1FBvSx' \
    --namespace $AB_NAMESPACE \
    --userID 'Chcl77FI' \
    > test.out 2>&1
eval_tap $? 31 'DeleteUserFromSessionInChannel' test.out

#- 32 GetStatData
$CLI_EXE \
    --sn matchmaking \
    --op GetStatData \
    --channelName 'gt9uLiWj' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 32 'GetStatData' test.out

#- 33 SearchSessions
eval_tap 0 33 'SearchSessions # SKIP deprecated' test.out

#- 34 GetSessionHistoryDetailed
eval_tap 0 34 'GetSessionHistoryDetailed # SKIP deprecated' test.out

#- 35 PublicGetMessages
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetMessages \
    > test.out 2>&1
eval_tap $? 35 'PublicGetMessages' test.out

#- 36 PublicGetAllMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetAllMatchmakingChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 36 'PublicGetAllMatchmakingChannel' test.out

#- 37 PublicGetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetSingleMatchmakingChannel \
    --channelName 'DnWglCVl' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 37 'PublicGetSingleMatchmakingChannel' test.out

#- 38 SearchSessionsV2
eval_tap 0 38 'SearchSessionsV2 # SKIP deprecated' test.out

#- 39 VersionCheckHandler
$CLI_EXE \
    --sn matchmaking \
    --op VersionCheckHandler \
    > test.out 2>&1
eval_tap $? 39 'VersionCheckHandler' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE