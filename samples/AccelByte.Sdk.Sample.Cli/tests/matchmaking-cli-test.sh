#!/usr/bin/env bash

# Copyright (c) 2021 AccelByte Inc. All Rights Reserved.
# This is licensed software from AccelByte Inc, for limitations
# and restrictions contact your company contract manager.

# This code is generated by tool. DO NOT EDIT.

# Meta:
# - random seed: 
# - template file: 

# Instructions:
# - Run the Justice SDK Mock Server first before running this script.

export AB_BASE_URL="http://127.0.0.1:8080"
export AB_CLIENT_ID="admin"
export AB_CLIENT_SECRET="admin"
export AB_NAMESPACE="test"
export AB_APP_NAME="UnitTest"

EXIT_CODE=0

eval_tap() {
  if [ $1 -eq 0 ]; then
    echo "ok $2 - $3"
  else
    EXIT_CODE=1
    echo "not ok $2 - $3"
    sed 's/^/# /g' $4
  fi
  rm -f $4
}

CLI_EXE="AccelByte.Sdk.Sample.Cli"
CLI_TOKEN_FILE="$(dirname "$(which $CLI_EXE)")/token.json"
TEMP_JSON_INPUT="input_json.json"
TEMP_FILE_UPLOAD="file_upload.bin"

echo "TAP version 13"
echo "1..39"

#- 1 Login
$CLI_EXE --op login --lt user --user user --pass user > test.out 2>&1
eval_tap $? 1 'Login' test.out

if [ $EXIT_CODE -ne 0 ]; then
  echo "Bail out! Login failed."
  exit $EXIT_CODE
fi

# echo "foo" > "$CLI_TOKEN_FILE"

#- 2 GetHealthcheckInfo
$CLI_EXE \
    --sn matchmaking \
    --op GetHealthcheckInfo \
    > test.out 2>&1
eval_tap $? 2 'GetHealthcheckInfo' test.out

#- 3 HandlerV3Healthz
$CLI_EXE \
    --sn matchmaking \
    --op HandlerV3Healthz \
    > test.out 2>&1
eval_tap $? 3 'HandlerV3Healthz' test.out

#- 4 GetAllChannelsHandler
$CLI_EXE \
    --sn matchmaking \
    --op GetAllChannelsHandler \
    --namespace $AB_NAMESPACE \
    --limit '50' \
    --offset '87' \
    > test.out 2>&1
eval_tap $? 4 'GetAllChannelsHandler' test.out

#- 5 CreateChannelHandler
# body param: body
echo '{"blocked_player_option": "blockedPlayerCannotMatch", "deployment": "t8X6EHDs", "description": "wln848yd", "find_match_timeout_seconds": 0, "game_mode": "qlB6RISC", "joinable": true, "max_delay_ms": 69, "region_expansion_range_ms": 9, "region_expansion_rate_ms": 14, "region_latency_initial_range_ms": 96, "region_latency_max_ms": 70, "rule_set": {"alliance": {"combination": {"alliances": [[{"max": 91, "min": 84, "name": "bGJgxflN"}, {"max": 79, "min": 84, "name": "5NfuzNrM"}, {"max": 54, "min": 2, "name": "mputLWQJ"}], [{"max": 49, "min": 65, "name": "zJeXQMUE"}, {"max": 77, "min": 99, "name": "SSAY0X0v"}, {"max": 55, "min": 19, "name": "KU1Sde25"}], [{"max": 11, "min": 76, "name": "dbp4Sv6V"}, {"max": 59, "min": 31, "name": "TyOBKKxS"}, {"max": 94, "min": 61, "name": "FGqZE4Im"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 94, "role_flexing_second": 46}, "max_number": 42, "min_number": 62, "player_max_number": 6, "player_min_number": 93}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 67, "min": 55, "name": "EkXicNGP"}, {"max": 27, "min": 66, "name": "LsMIOiaO"}, {"max": 16, "min": 72, "name": "S4nkD8Qi"}], [{"max": 87, "min": 94, "name": "ECUTNAyT"}, {"max": 63, "min": 28, "name": "B8XeMjlc"}, {"max": 41, "min": 82, "name": "hIpB1drL"}], [{"max": 37, "min": 4, "name": "1u8OxZDG"}, {"max": 42, "min": 77, "name": "mwKVvWrS"}, {"max": 20, "min": 96, "name": "FsIK1x00"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 46, "role_flexing_second": 67}, "duration": 0, "max_number": 29, "min_number": 3, "player_max_number": 42, "player_min_number": 52}, {"combination": {"alliances": [[{"max": 100, "min": 44, "name": "tXicBzUi"}, {"max": 40, "min": 68, "name": "OdZ3D8Tc"}, {"max": 36, "min": 95, "name": "Zvch6Xy3"}], [{"max": 96, "min": 89, "name": "2FBBFPw4"}, {"max": 63, "min": 82, "name": "uT3J8Vhc"}, {"max": 62, "min": 88, "name": "nd6jknSh"}], [{"max": 14, "min": 10, "name": "EWzSQUEd"}, {"max": 7, "min": 74, "name": "QcCozV85"}, {"max": 58, "min": 16, "name": "upcH8z8d"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 57, "role_flexing_second": 76}, "duration": 34, "max_number": 33, "min_number": 1, "player_max_number": 91, "player_min_number": 21}, {"combination": {"alliances": [[{"max": 55, "min": 45, "name": "wqlOPwEC"}, {"max": 53, "min": 72, "name": "kRkDfdNY"}, {"max": 32, "min": 99, "name": "0LbeypnV"}], [{"max": 58, "min": 95, "name": "9fNTf3Uv"}, {"max": 0, "min": 38, "name": "G0HWfhda"}, {"max": 73, "min": 16, "name": "4rLp47ez"}], [{"max": 91, "min": 7, "name": "xi61nNLQ"}, {"max": 62, "min": 71, "name": "RaWwvg08"}, {"max": 98, "min": 84, "name": "HZSRCrtV"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 70, "role_flexing_second": 21}, "duration": 94, "max_number": 49, "min_number": 84, "player_max_number": 64, "player_min_number": 95}], "batch_size": 24, "bucket_mmr_rule": {"disable_authority": true, "flex_authority_count": 47, "flex_flat_step_range": 39, "flex_immunity_count": 2, "flex_range_max": 88, "flex_rate_ms": 64, "flex_step_max": 40, "force_authority_match": true, "initial_step_range": 32, "mmr_max": 8, "mmr_mean": 83, "mmr_min": 93, "mmr_std_dev": 92, "override_mmr_data": false, "use_bucket_mmr": false, "use_flat_flex_step": true}, "flexing_rule": [{"attribute": "4g3Q43c8", "criteria": "WWsIDILi", "duration": 62, "reference": 0.186796673944282}, {"attribute": "4koVbQHk", "criteria": "aGB07OZr", "duration": 55, "reference": 0.05124948044467126}, {"attribute": "57YfUa82", "criteria": "GCwCpeLo", "duration": 28, "reference": 0.4289726497935147}], "match_options": {"options": [{"name": "bRki0u65", "type": "Kid52vvP"}, {"name": "Hl30oXgq", "type": "1ieBprQf"}, {"name": "pzQdrphk", "type": "tjPwzXRB"}]}, "matching_rule": [{"attribute": "TsdlUrZM", "criteria": "piw28tZv", "reference": 0.515096817314998}, {"attribute": "UfxImUi0", "criteria": "rYlpCZg5", "reference": 0.8373782005539033}, {"attribute": "ZIpjsv5l", "criteria": "H9w2aFmf", "reference": 0.02213522463837747}], "rebalance_enable": true, "sort_ticket": {"search_result": "random", "ticket_queue": "none"}, "sort_tickets": [{"search_result": "none", "threshold": 20, "ticket_queue": "distance"}, {"search_result": "oldestTicketAge", "threshold": 24, "ticket_queue": "random"}, {"search_result": "oldestTicketAge", "threshold": 56, "ticket_queue": "largestPartySize"}], "sub_game_modes": {"e2ENQ3Pn": {"alliance": {"combination": {"alliances": [[{"max": 68, "min": 54, "name": "wgz3WWBy"}, {"max": 41, "min": 96, "name": "xlGfqyo5"}, {"max": 39, "min": 69, "name": "Vtz8Ys6u"}], [{"max": 26, "min": 62, "name": "hMHivXS1"}, {"max": 61, "min": 72, "name": "tYd5uigB"}, {"max": 14, "min": 26, "name": "nFEC9ig8"}], [{"max": 45, "min": 48, "name": "uuyZHoYx"}, {"max": 4, "min": 17, "name": "iFLPE2WH"}, {"max": 3, "min": 41, "name": "TtVcUYZC"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 20, "role_flexing_second": 5}, "max_number": 84, "min_number": 31, "player_max_number": 13, "player_min_number": 2}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 29, "min": 76, "name": "Gz7xZIr2"}, {"max": 69, "min": 65, "name": "XbTruxMo"}, {"max": 41, "min": 69, "name": "RjX8LY2s"}], [{"max": 60, "min": 84, "name": "0pAH4mFE"}, {"max": 24, "min": 14, "name": "Oq4GQ9NZ"}, {"max": 83, "min": 92, "name": "sztVwHyA"}], [{"max": 75, "min": 89, "name": "9AhJ5ufr"}, {"max": 76, "min": 28, "name": "4aRoJeV3"}, {"max": 9, "min": 17, "name": "BFCVIjzN"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 10, "role_flexing_second": 92}, "duration": 21, "max_number": 59, "min_number": 73, "player_max_number": 5, "player_min_number": 92}, {"combination": {"alliances": [[{"max": 58, "min": 31, "name": "pp1KslXL"}, {"max": 29, "min": 90, "name": "8mcmpnSy"}, {"max": 97, "min": 36, "name": "oKvyx8lN"}], [{"max": 81, "min": 26, "name": "a52SbhDr"}, {"max": 84, "min": 21, "name": "aMB299vy"}, {"max": 14, "min": 26, "name": "mXE64ywV"}], [{"max": 81, "min": 64, "name": "gn6jii94"}, {"max": 21, "min": 12, "name": "5tp7qplz"}, {"max": 74, "min": 39, "name": "NA8T8cnK"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 0, "role_flexing_second": 28}, "duration": 10, "max_number": 33, "min_number": 40, "player_max_number": 42, "player_min_number": 55}, {"combination": {"alliances": [[{"max": 84, "min": 33, "name": "2Qa5E9Sl"}, {"max": 63, "min": 78, "name": "Mp98eDfS"}, {"max": 84, "min": 69, "name": "LZPdlRUD"}], [{"max": 48, "min": 18, "name": "DFe8j2wN"}, {"max": 55, "min": 69, "name": "oqdKq23X"}, {"max": 46, "min": 77, "name": "gqf3iYWA"}], [{"max": 77, "min": 73, "name": "x6Hd4vnD"}, {"max": 9, "min": 66, "name": "qNSZEpW8"}, {"max": 71, "min": 75, "name": "Fl3uzMRG"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 11, "role_flexing_second": 20}, "duration": 80, "max_number": 82, "min_number": 55, "player_max_number": 48, "player_min_number": 67}], "name": "uagOLtyg"}, "jMDXwmNs": {"alliance": {"combination": {"alliances": [[{"max": 29, "min": 19, "name": "VuIPa1Ph"}, {"max": 51, "min": 30, "name": "PhvzefRJ"}, {"max": 22, "min": 45, "name": "apbVjobj"}], [{"max": 60, "min": 63, "name": "4Vfg8DGW"}, {"max": 32, "min": 93, "name": "ydcCeak2"}, {"max": 86, "min": 78, "name": "iybt74Tz"}], [{"max": 74, "min": 39, "name": "Zf9K5Yw6"}, {"max": 47, "min": 81, "name": "RI8WI2Di"}, {"max": 23, "min": 21, "name": "d7EkzciI"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 30, "role_flexing_second": 41}, "max_number": 18, "min_number": 87, "player_max_number": 77, "player_min_number": 28}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 2, "min": 75, "name": "zDe4eb2A"}, {"max": 59, "min": 24, "name": "tQmX01iM"}, {"max": 92, "min": 16, "name": "6cjnrKO5"}], [{"max": 72, "min": 1, "name": "7U9oA2kH"}, {"max": 95, "min": 34, "name": "0SaHbdgE"}, {"max": 81, "min": 27, "name": "Pz63pRtw"}], [{"max": 17, "min": 38, "name": "d33Zas2x"}, {"max": 95, "min": 26, "name": "AHxUiDlR"}, {"max": 85, "min": 27, "name": "ialSGkK9"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 89, "role_flexing_second": 15}, "duration": 16, "max_number": 33, "min_number": 75, "player_max_number": 91, "player_min_number": 74}, {"combination": {"alliances": [[{"max": 26, "min": 78, "name": "3DhXQW8n"}, {"max": 13, "min": 100, "name": "6LkpXQc5"}, {"max": 72, "min": 53, "name": "TFH1PFBh"}], [{"max": 18, "min": 52, "name": "GCrI93og"}, {"max": 23, "min": 46, "name": "0EJh6orq"}, {"max": 55, "min": 0, "name": "ZgHSfkZw"}], [{"max": 92, "min": 67, "name": "UOrLH1Lv"}, {"max": 52, "min": 80, "name": "hdloaPV2"}, {"max": 11, "min": 80, "name": "IW1DyD71"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 22, "role_flexing_second": 83}, "duration": 57, "max_number": 63, "min_number": 89, "player_max_number": 41, "player_min_number": 10}, {"combination": {"alliances": [[{"max": 69, "min": 14, "name": "uvLZvwwj"}, {"max": 30, "min": 46, "name": "3hMYSaqa"}, {"max": 2, "min": 26, "name": "eMGaXosD"}], [{"max": 52, "min": 84, "name": "SmDi7lvK"}, {"max": 3, "min": 82, "name": "TpV9mQr5"}, {"max": 84, "min": 55, "name": "ZEr664lA"}], [{"max": 59, "min": 71, "name": "yPeZRG6Q"}, {"max": 3, "min": 5, "name": "WSNgXaN9"}, {"max": 70, "min": 31, "name": "p40qwXNS"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 88, "role_flexing_second": 85}, "duration": 55, "max_number": 46, "min_number": 17, "player_max_number": 59, "player_min_number": 28}], "name": "gu0ZF8Cp"}, "lmIBmA1L": {"alliance": {"combination": {"alliances": [[{"max": 74, "min": 12, "name": "bpRw9ozv"}, {"max": 45, "min": 8, "name": "42FcZ7J1"}, {"max": 83, "min": 58, "name": "fIFi7XDk"}], [{"max": 39, "min": 25, "name": "JciUgsUp"}, {"max": 40, "min": 46, "name": "9bwxUlGi"}, {"max": 54, "min": 20, "name": "3ZWottFo"}], [{"max": 63, "min": 3, "name": "X2gRPZHx"}, {"max": 25, "min": 9, "name": "OG6ivZQI"}, {"max": 80, "min": 55, "name": "MakkewXg"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 49, "role_flexing_second": 86}, "max_number": 73, "min_number": 69, "player_max_number": 59, "player_min_number": 92}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 68, "min": 8, "name": "O1R1lmv4"}, {"max": 96, "min": 89, "name": "WJKadtH9"}, {"max": 49, "min": 2, "name": "vV4VOQjT"}], [{"max": 52, "min": 71, "name": "PKaWQcSP"}, {"max": 90, "min": 66, "name": "aYsxAmjo"}, {"max": 92, "min": 77, "name": "YPMkWuds"}], [{"max": 42, "min": 36, "name": "EqwsDMGb"}, {"max": 54, "min": 38, "name": "BrnMTKMV"}, {"max": 41, "min": 73, "name": "Ld1Exeta"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 37, "role_flexing_second": 98}, "duration": 89, "max_number": 43, "min_number": 58, "player_max_number": 45, "player_min_number": 50}, {"combination": {"alliances": [[{"max": 50, "min": 9, "name": "79P5wdru"}, {"max": 6, "min": 45, "name": "1QFZj3bA"}, {"max": 41, "min": 8, "name": "xeUfYbRV"}], [{"max": 77, "min": 52, "name": "8lUkC8iQ"}, {"max": 87, "min": 36, "name": "yvqS4Zwz"}, {"max": 52, "min": 16, "name": "wEkKfVR3"}], [{"max": 23, "min": 78, "name": "Mzbs6qGX"}, {"max": 4, "min": 85, "name": "mCV2OJra"}, {"max": 72, "min": 62, "name": "cjo0XKbI"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 48, "role_flexing_second": 32}, "duration": 4, "max_number": 12, "min_number": 37, "player_max_number": 36, "player_min_number": 29}, {"combination": {"alliances": [[{"max": 19, "min": 98, "name": "bxbiycNQ"}, {"max": 7, "min": 65, "name": "327YAeok"}, {"max": 38, "min": 15, "name": "8kEOBGaY"}], [{"max": 30, "min": 32, "name": "gozWeXgc"}, {"max": 69, "min": 94, "name": "SJCuz2jr"}, {"max": 35, "min": 71, "name": "dWC43F7x"}], [{"max": 5, "min": 9, "name": "99KYNPE7"}, {"max": 56, "min": 27, "name": "zxMh1zw0"}, {"max": 96, "min": 45, "name": "OtrMABy7"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 46, "role_flexing_second": 1}, "duration": 11, "max_number": 90, "min_number": 61, "player_max_number": 64, "player_min_number": 95}], "name": "y6AtBMbb"}}, "ticket_flexing_selection": "newest", "ticket_flexing_selections": [{"selection": "random", "threshold": 28}, {"selection": "random", "threshold": 87}, {"selection": "newest", "threshold": 79}], "use_newest_ticket_for_flexing": false}, "session_queue_timeout_seconds": 32, "social_matchmaking": true, "sub_gamemode_selection": "random", "ticket_observability_enable": false, "use_sub_gamemode": true}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateChannelHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 5 'CreateChannelHandler' test.out

#- 6 GetMatchPoolMetric
$CLI_EXE \
    --sn matchmaking \
    --op GetMatchPoolMetric \
    --channelName 'BDlqulmi' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 6 'GetMatchPoolMetric' test.out

#- 7 DeleteChannelHandler
$CLI_EXE \
    --sn matchmaking \
    --op DeleteChannelHandler \
    --channel 'YR7XAjmb' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 7 'DeleteChannelHandler' test.out

#- 8 StoreMatchResults
# body param: body
echo '{"match_id": "a5cPP216", "players": [{"results": [{"attribute": "NYL56wDz", "value": 0.43626358044542113}, {"attribute": "Pv49Dijl", "value": 0.11660072746930039}, {"attribute": "jnJqIgUU", "value": 0.06563171730318629}], "user_id": "WPTROKvt"}, {"results": [{"attribute": "SsmvPPDK", "value": 0.10365025960265761}, {"attribute": "cWFshprP", "value": 0.3908928003237129}, {"attribute": "B0PNhcCL", "value": 0.49480058047843434}], "user_id": "6fybr7eE"}, {"results": [{"attribute": "Qe6uXaJu", "value": 0.2615150901581085}, {"attribute": "sAy2xW8N", "value": 0.9185439347860116}, {"attribute": "1G5nZk7j", "value": 0.8403811077199659}], "user_id": "TVXA2Jxu"}]}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op StoreMatchResults \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 8 'StoreMatchResults' test.out

#- 9 Rebalance
# body param: body
echo '{"match_id": "LrlYDFCa"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op Rebalance \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 9 'Rebalance' test.out

#- 10 QueueSessionHandler
# body param: body
echo '{"channel": "XYL49jWL", "client_version": "60cAOREn", "deployment": "gmzuhuNj", "error_code": 35, "error_message": "AoXsZIXC", "game_mode": "7tYoLkBm", "is_mock": "rFEh3QY3", "joinable": false, "match_id": "GfgcrYqy", "matching_allies": [{"matching_parties": [{"first_ticket_created_at": 86, "party_attributes": {"nrGRcqMP": {}, "YyGwIDsK": {}, "ul7J9D89": {}}, "party_id": "RlU1U3Sw", "party_members": [{"extra_attributes": {"p3KHe0Z8": {}, "Rx3MH4r0": {}, "xqrdJ5Om": {}}, "user_id": "XOwy3pmK"}, {"extra_attributes": {"UFTvtTFw": {}, "0yQqulGS": {}, "q41vqhBe": {}}, "user_id": "P1wTm1iH"}, {"extra_attributes": {"KfSK8yDX": {}, "3gKA4Our": {}, "OAPvfjDw": {}}, "user_id": "wpiytRdq"}], "ticket_created_at": 78, "ticket_id": "14FcOrOk"}, {"first_ticket_created_at": 21, "party_attributes": {"Dhsg5CVG": {}, "LpsvRBnn": {}, "lX7h4BIy": {}}, "party_id": "FttHm9us", "party_members": [{"extra_attributes": {"ck8DE5PW": {}, "p9sP6UoX": {}, "WekShCwB": {}}, "user_id": "lrGh6PLI"}, {"extra_attributes": {"Gcr7f7HE": {}, "dL60GXs8": {}, "krH8EOKD": {}}, "user_id": "QLDBwCpg"}, {"extra_attributes": {"lYnNTKON": {}, "cKAB5rUW": {}, "HG5jQ31P": {}}, "user_id": "6V3GtXH5"}], "ticket_created_at": 59, "ticket_id": "C5TglaKp"}, {"first_ticket_created_at": 21, "party_attributes": {"Fgv1BL0B": {}, "lQJz9mwH": {}, "mquzXDLq": {}}, "party_id": "FnNGFjYA", "party_members": [{"extra_attributes": {"dFMKxZAM": {}, "nOUWkmwv": {}, "2KA6M6p6": {}}, "user_id": "eEdN0KCg"}, {"extra_attributes": {"I3Qy551Z": {}, "LhHt4Zaz": {}, "BVHvzlt3": {}}, "user_id": "zqQJFvX8"}, {"extra_attributes": {"u9fsAkWM": {}, "K3PEFCLs": {}, "qeOVV6yk": {}}, "user_id": "TRYrqzTT"}], "ticket_created_at": 5, "ticket_id": "mBHkOefR"}]}, {"matching_parties": [{"first_ticket_created_at": 63, "party_attributes": {"kD36QQtP": {}, "59CrBCHh": {}, "FZ9TWPj9": {}}, "party_id": "GkEn0oKV", "party_members": [{"extra_attributes": {"RAQegtOm": {}, "Msc9k9on": {}, "4V67XmB1": {}}, "user_id": "QVHCWzgH"}, {"extra_attributes": {"Cld62aFH": {}, "zdyAL68Q": {}, "TM0ovPoN": {}}, "user_id": "dQJI5kZd"}, {"extra_attributes": {"XyZxpeey": {}, "qHivpgpz": {}, "Anw5ww14": {}}, "user_id": "srjXaQEG"}], "ticket_created_at": 72, "ticket_id": "CDr0VR0u"}, {"first_ticket_created_at": 16, "party_attributes": {"bQyW4dva": {}, "sWmNH0Tz": {}, "gTnL15Ea": {}}, "party_id": "PAkxFJNw", "party_members": [{"extra_attributes": {"6foFc9Uu": {}, "hQ3iWEBH": {}, "f08Opy2H": {}}, "user_id": "XA562xDX"}, {"extra_attributes": {"KaUQUuAq": {}, "nCxidtKB": {}, "ZH4YcHOh": {}}, "user_id": "4mPe4hbb"}, {"extra_attributes": {"BitVUD94": {}, "0ClFPtEQ": {}, "XKVoc69A": {}}, "user_id": "Cbi80ePQ"}], "ticket_created_at": 98, "ticket_id": "m1ytQEIe"}, {"first_ticket_created_at": 37, "party_attributes": {"ifhgLy5e": {}, "DLEGaW4I": {}, "Hb82tSao": {}}, "party_id": "mgBjRMRM", "party_members": [{"extra_attributes": {"i9XX2Tfq": {}, "n6bIkedU": {}, "AioSbdXP": {}}, "user_id": "nfcVFrSl"}, {"extra_attributes": {"SgEJwBXJ": {}, "r2ITyBgl": {}, "Q5IVtiH8": {}}, "user_id": "mMMrPM3M"}, {"extra_attributes": {"58kzyu3P": {}, "AH0Yc8yE": {}, "u0rpjZEY": {}}, "user_id": "TbX6jPOT"}], "ticket_created_at": 63, "ticket_id": "gsfOld1c"}]}, {"matching_parties": [{"first_ticket_created_at": 63, "party_attributes": {"zPwLdUeZ": {}, "4WG9NltR": {}, "PrF1l8lw": {}}, "party_id": "UMJkCylE", "party_members": [{"extra_attributes": {"gc69tD53": {}, "QPoxKdjK": {}, "Yp4e9nmm": {}}, "user_id": "TFrSMZal"}, {"extra_attributes": {"JvxDKJdg": {}, "Vaq8EEAJ": {}, "k5XKjLhN": {}}, "user_id": "AFs9PCOk"}, {"extra_attributes": {"MdIJEz28": {}, "dTXLNq23": {}, "xsGmgFwq": {}}, "user_id": "7cFJ2dI0"}], "ticket_created_at": 84, "ticket_id": "Vay9bj1S"}, {"first_ticket_created_at": 31, "party_attributes": {"D5La9yX0": {}, "9Viz2IK8": {}, "Hq2g50id": {}}, "party_id": "p1CNAAgp", "party_members": [{"extra_attributes": {"zQGVOgCT": {}, "fc4HxDLq": {}, "xj0nOZJA": {}}, "user_id": "hts8H8pe"}, {"extra_attributes": {"GV9luTYo": {}, "VNQRK1aA": {}, "jBWmFzcF": {}}, "user_id": "EqxkEvoq"}, {"extra_attributes": {"4T8R57fz": {}, "p54VrR7U": {}, "pMAW6WO5": {}}, "user_id": "DM7UWLOl"}], "ticket_created_at": 28, "ticket_id": "6sSTHwfj"}, {"first_ticket_created_at": 80, "party_attributes": {"avMjbGwr": {}, "HFlD9TPt": {}, "eCn5NUQV": {}}, "party_id": "8zaUz012", "party_members": [{"extra_attributes": {"hZX5CNhb": {}, "BlSl9bjF": {}, "KM2wDZhk": {}}, "user_id": "dAhrMN2O"}, {"extra_attributes": {"UE4IcQb1": {}, "xxtHMRwM": {}, "LVnlxJO3": {}}, "user_id": "9eZvlwWU"}, {"extra_attributes": {"xsKqCovj": {}, "VNDi0jP5": {}, "2ZY0NxNl": {}}, "user_id": "MBH5O0mX"}], "ticket_created_at": 32, "ticket_id": "NJIB3wwU"}]}], "namespace": "IOE0TQgy", "party_attributes": {"rcCYfg7w": {}, "nfndNjqj": {}, "DbeJbTag": {}}, "party_id": "xGHRZNjB", "queued_at": 1, "region": "6nGYQiwG", "server_name": "oiS1kTEf", "status": "Q2BjF7F4", "ticket_id": "mU7ORAXJ", "ticket_ids": ["e5U6Sgyo", "cIdw84WS", "vJH69gY2"], "updated_at": "1976-04-17T00:00:00Z"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op QueueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 10 'QueueSessionHandler' test.out

#- 11 DequeueSessionHandler
# body param: body
echo '{"match_id": "wop8lTWZ"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op DequeueSessionHandler \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 11 'DequeueSessionHandler' test.out

#- 12 QuerySessionHandler
$CLI_EXE \
    --sn matchmaking \
    --op QuerySessionHandler \
    --matchID '601B4q2h' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 12 'QuerySessionHandler' test.out

#- 13 UpdatePlayTimeWeight
# body param: body
echo '{"playtime": 34, "userID": "EZRf7DUO", "weight": 0.024147620260923652}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdatePlayTimeWeight \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 13 'UpdatePlayTimeWeight' test.out

#- 14 GetAllPartyInAllChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInAllChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 14 'GetAllPartyInAllChannel' test.out

#- 15 BulkGetSessions
$CLI_EXE \
    --sn matchmaking \
    --op BulkGetSessions \
    --namespace $AB_NAMESPACE \
    --matchIDs 'alb7auVa' \
    > test.out 2>&1
eval_tap $? 15 'BulkGetSessions' test.out

#- 16 ExportChannels
$CLI_EXE \
    --sn matchmaking \
    --op ExportChannels \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 16 'ExportChannels' test.out

#- 17 ImportChannels
# form data upload: file
echo 'tmp.dat' > $TEMP_FILE_UPLOAD
$CLI_EXE \
    --sn matchmaking \
    --op ImportChannels \
    --namespace $AB_NAMESPACE \
    --upload file $TEMP_FILE_UPLOAD \
    --strategy 'NU263Gvp' \
    > test.out 2>&1
eval_tap $? 17 'ImportChannels' test.out

#- 18 GetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetSingleMatchmakingChannel \
    --channelName '6zvySulo' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 18 'GetSingleMatchmakingChannel' test.out

#- 19 UpdateMatchmakingChannel
# body param: body
echo '{"blocked_player_option": "blockedPlayerCanMatchOnDifferentTeam", "deployment": "XomDstAg", "description": "6RyTCFYd", "findMatchTimeoutSeconds": 86, "joinable": true, "max_delay_ms": 17, "region_expansion_range_ms": 80, "region_expansion_rate_ms": 95, "region_latency_initial_range_ms": 62, "region_latency_max_ms": 18, "ruleSet": {"alliance": {"combination": {"alliances": [[{"max": 5, "min": 95, "name": "GWOZuWtO"}, {"max": 83, "min": 60, "name": "O4RLPCP9"}, {"max": 69, "min": 79, "name": "y5tWic6P"}], [{"max": 41, "min": 19, "name": "Ftbq4uEo"}, {"max": 63, "min": 93, "name": "vIO5ZTcj"}, {"max": 45, "min": 94, "name": "NV1nVUUe"}], [{"max": 59, "min": 29, "name": "X8UU4dWf"}, {"max": 4, "min": 7, "name": "cS0YUPDz"}, {"max": 41, "min": 12, "name": "7ARJw4na"}]], "has_combination": false, "role_flexing_enable": true, "role_flexing_player": 74, "role_flexing_second": 8}, "maxNumber": 35, "minNumber": 60, "playerMaxNumber": 37, "playerMinNumber": 83}, "alliance_flexing_rule": [{"combination": {"alliances": [[{"max": 88, "min": 93, "name": "67DaUQ9f"}, {"max": 68, "min": 92, "name": "ChgQ2DBZ"}, {"max": 80, "min": 56, "name": "6f9fiqUZ"}], [{"max": 80, "min": 90, "name": "YvrBwrUf"}, {"max": 14, "min": 22, "name": "nSoOSQpH"}, {"max": 99, "min": 27, "name": "27a1a6mv"}], [{"max": 89, "min": 6, "name": "a0T7X6P8"}, {"max": 26, "min": 83, "name": "sRfisNZ3"}, {"max": 80, "min": 60, "name": "JfCT6x9B"}]], "has_combination": false, "role_flexing_enable": false, "role_flexing_player": 43, "role_flexing_second": 26}, "duration": 71, "max_number": 40, "min_number": 80, "player_max_number": 88, "player_min_number": 93}, {"combination": {"alliances": [[{"max": 45, "min": 72, "name": "jo8T8lg4"}, {"max": 61, "min": 24, "name": "dfUvOwIm"}, {"max": 46, "min": 28, "name": "A7qThvUx"}], [{"max": 100, "min": 5, "name": "1XtpNJqq"}, {"max": 85, "min": 46, "name": "v4kZ7x20"}, {"max": 69, "min": 7, "name": "0VqXLxs8"}], [{"max": 4, "min": 57, "name": "YftXe44G"}, {"max": 82, "min": 76, "name": "2YbIG3mZ"}, {"max": 15, "min": 89, "name": "ZYoBvuHc"}]], "has_combination": true, "role_flexing_enable": false, "role_flexing_player": 80, "role_flexing_second": 4}, "duration": 55, "max_number": 45, "min_number": 96, "player_max_number": 85, "player_min_number": 82}, {"combination": {"alliances": [[{"max": 27, "min": 30, "name": "mlshyoZT"}, {"max": 59, "min": 43, "name": "jMIAXKB8"}, {"max": 82, "min": 96, "name": "LaJGNs9c"}], [{"max": 11, "min": 66, "name": "Z56toFCx"}, {"max": 61, "min": 57, "name": "1AaTjrTA"}, {"max": 70, "min": 64, "name": "xhkhRegv"}], [{"max": 25, "min": 58, "name": "IAcEySnh"}, {"max": 47, "min": 83, "name": "P9Wxb1bc"}, {"max": 5, "min": 94, "name": "pWG8rDEx"}]], "has_combination": true, "role_flexing_enable": true, "role_flexing_player": 1, "role_flexing_second": 80}, "duration": 72, "max_number": 8, "min_number": 100, "player_max_number": 95, "player_min_number": 92}], "batch_size": 59, "bucket_mmr_rule": {"disable_authority": false, "flex_authority_count": 27, "flex_flat_step_range": 42, "flex_immunity_count": 78, "flex_range_max": 35, "flex_rate_ms": 93, "flex_step_max": 34, "force_authority_match": false, "initial_step_range": 10, "mmr_max": 13, "mmr_mean": 16, "mmr_min": 65, "mmr_std_dev": 86, "override_mmr_data": false, "use_bucket_mmr": true, "use_flat_flex_step": false}, "flexingRules": [{"attribute": "13JDyKEc", "criteria": "DX1PxQ6l", "duration": 55, "reference": 0.25760966812822994}, {"attribute": "TZjfRdfj", "criteria": "3EIvO3kD", "duration": 96, "reference": 0.7796096242499043}, {"attribute": "AA3hNKvR", "criteria": "7nrpStEg", "duration": 27, "reference": 0.9086747995806035}], "match_options": {"options": [{"name": "nW6LB9jI", "type": "NZ9fe4OW"}, {"name": "FMyyMsvE", "type": "O5rfT9gQ"}, {"name": "z0Ej90s8", "type": "WST5ascc"}]}, "matchingRules": [{"attribute": "B40drdfL", "criteria": "PUSvuydC", "reference": 0.038063896093480154}, {"attribute": "D46y79V3", "criteria": "aDG24V1D", "reference": 0.5853036190900228}, {"attribute": "8zkXrQE5", "criteria": "DbZifw2g", "reference": 0.020346399127407766}], "sort_ticket": {"search_result": "largestPartySize", "ticket_queue": "random"}, "sort_tickets": [{"search_result": "random", "threshold": 35, "ticket_queue": "oldestTicketAge"}, {"search_result": "none", "threshold": 15, "ticket_queue": "distance"}, {"search_result": "largestPartySize", "threshold": 52, "ticket_queue": "none"}], "sub_game_modes": {}, "ticket_flexing_selection": "pivot", "ticket_flexing_selections": [{"selection": "oldest", "threshold": 55}, {"selection": "pivot", "threshold": 62}, {"selection": "oldest", "threshold": 48}], "use_newest_ticket_for_flexing": false}, "sessionQueueTimeoutSeconds": 20, "socialMatchmaking": false, "sub_gamemode_selection": "ticketOrder", "ticket_observability_enable": false, "use_sub_gamemode": true}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op UpdateMatchmakingChannel \
    --channelName 'qoytfikl' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 19 'UpdateMatchmakingChannel' test.out

#- 20 CleanAllMocks
$CLI_EXE \
    --sn matchmaking \
    --op CleanAllMocks \
    --channelName '5Z0EN2h5' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 20 'CleanAllMocks' test.out

#- 21 GetAllMockMatches
$CLI_EXE \
    --sn matchmaking \
    --op GetAllMockMatches \
    --channelName 'TZTWC0C7' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 21 'GetAllMockMatches' test.out

#- 22 GetMockMatchesByTimestamp
# body param: body
echo '{"timestamp_after": 92}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op GetMockMatchesByTimestamp \
    --channelName 'pN0lcv10' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 22 'GetMockMatchesByTimestamp' test.out

#- 23 GetAllMockTickets
$CLI_EXE \
    --sn matchmaking \
    --op GetAllMockTickets \
    --channelName 'h02GIKMP' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 23 'GetAllMockTickets' test.out

#- 24 CreateMockTickets
# body param: body
echo '{"attribute_name": "Fw1Amdvy", "count": 52, "mmrMax": 0.9750959641827378, "mmrMean": 0.7493697374061172, "mmrMin": 0.14262594323506061, "mmrStdDev": 0.16177937512854534}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op CreateMockTickets \
    --channelName 'Z7TF2kS9' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 24 'CreateMockTickets' test.out

#- 25 BulkCreateMockTickets
# body param: body
echo '[{"first_ticket_created_at": 72, "party_attributes": {"mWtm9dFb": {}, "fIjqeJlz": {}, "RHsXaIt6": {}}, "party_id": "4RAl1IqO", "party_members": [{"extra_attributes": {"Y9RnlaXy": {}, "QY8tu4tj": {}, "u4hf2eU9": {}}, "user_id": "vubi4Ea9"}, {"extra_attributes": {"3ykXEYrO": {}, "RHgHxswF": {}, "dQuZJ5uu": {}}, "user_id": "0YU93RCR"}, {"extra_attributes": {"yv9DW3R6": {}, "UNlnTQ2q": {}, "ODlprhYJ": {}}, "user_id": "c6CgFlpD"}], "ticket_created_at": 43, "ticket_id": "jVmZ2MrJ"}, {"first_ticket_created_at": 83, "party_attributes": {"T85pvlHH": {}, "g6WsP0hH": {}, "EerK4dI3": {}}, "party_id": "D7drMWJX", "party_members": [{"extra_attributes": {"2ptEYB3U": {}, "Ef8UGYvv": {}, "juIYDSxJ": {}}, "user_id": "MDDYTydb"}, {"extra_attributes": {"L4mXjiHk": {}, "uVR24VDX": {}, "cSQnnPvD": {}}, "user_id": "UwNvf7uC"}, {"extra_attributes": {"orQ0gLBu": {}, "3uMemXuS": {}, "tppf6GZs": {}}, "user_id": "bRlBWGaY"}], "ticket_created_at": 38, "ticket_id": "psNG21CR"}, {"first_ticket_created_at": 57, "party_attributes": {"FOj6LBAY": {}, "Ur2eiqNv": {}, "uyGJ4tvg": {}}, "party_id": "aW8F8Ng4", "party_members": [{"extra_attributes": {"92iOchsg": {}, "GA12cCY0": {}, "hFymp3VX": {}}, "user_id": "hJ7LtJxq"}, {"extra_attributes": {"QwiaSzcG": {}, "wI61iYMr": {}, "iBgjuclN": {}}, "user_id": "N27aIPsR"}, {"extra_attributes": {"BlsBPMUE": {}, "PiZeKzxN": {}, "i87nDmUk": {}}, "user_id": "ydIXuda2"}], "ticket_created_at": 64, "ticket_id": "W3rPTwAQ"}]' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op BulkCreateMockTickets \
    --channelName '1N8GdcCa' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 25 'BulkCreateMockTickets' test.out

#- 26 GetMockTicketsByTimestamp
# body param: body
echo '{"timestamp_after": 75}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op GetMockTicketsByTimestamp \
    --channelName 'h8ADocIr' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 26 'GetMockTicketsByTimestamp' test.out

#- 27 GetAllPartyInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllPartyInChannel \
    --channelName 'jpGOieYI' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 27 'GetAllPartyInChannel' test.out

#- 28 GetAllSessionsInChannel
$CLI_EXE \
    --sn matchmaking \
    --op GetAllSessionsInChannel \
    --channelName 'flHCab7O' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 28 'GetAllSessionsInChannel' test.out

#- 29 AddUserIntoSessionInChannel
# body param: body
echo '{"blocked_players": ["iX29cVAy", "AxheL1KM", "rwtEXhJT"], "party_id": "zjIwTroo", "user_id": "apn4xhkw"}' > $TEMP_JSON_INPUT
$CLI_EXE \
    --sn matchmaking \
    --op AddUserIntoSessionInChannel \
    --channelName '2CX6vZJf' \
    --matchID 'FI9bYKrG' \
    --namespace $AB_NAMESPACE \
    --reqfile $TEMP_JSON_INPUT \
    > test.out 2>&1
eval_tap $? 29 'AddUserIntoSessionInChannel' test.out

#- 30 DeleteSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteSessionInChannel \
    --channelName '70RTgHQy' \
    --matchID 'mMcu3gEa' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 30 'DeleteSessionInChannel' test.out

#- 31 DeleteUserFromSessionInChannel
$CLI_EXE \
    --sn matchmaking \
    --op DeleteUserFromSessionInChannel \
    --channelName 'yQCFxbyN' \
    --matchID 'Q9V0Z5OM' \
    --namespace $AB_NAMESPACE \
    --userID '67c8laT0' \
    > test.out 2>&1
eval_tap $? 31 'DeleteUserFromSessionInChannel' test.out

#- 32 GetStatData
$CLI_EXE \
    --sn matchmaking \
    --op GetStatData \
    --channelName 'qeS1aERY' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 32 'GetStatData' test.out

#- 33 SearchSessions
eval_tap 0 33 'SearchSessions # SKIP deprecated' test.out

#- 34 GetSessionHistoryDetailed
eval_tap 0 34 'GetSessionHistoryDetailed # SKIP deprecated' test.out

#- 35 PublicGetMessages
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetMessages \
    > test.out 2>&1
eval_tap $? 35 'PublicGetMessages' test.out

#- 36 PublicGetAllMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetAllMatchmakingChannel \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 36 'PublicGetAllMatchmakingChannel' test.out

#- 37 PublicGetSingleMatchmakingChannel
$CLI_EXE \
    --sn matchmaking \
    --op PublicGetSingleMatchmakingChannel \
    --channelName 'yPEHuYEn' \
    --namespace $AB_NAMESPACE \
    > test.out 2>&1
eval_tap $? 37 'PublicGetSingleMatchmakingChannel' test.out

#- 38 SearchSessionsV2
eval_tap 0 38 'SearchSessionsV2 # SKIP deprecated' test.out

#- 39 VersionCheckHandler
$CLI_EXE \
    --sn matchmaking \
    --op VersionCheckHandler \
    > test.out 2>&1
eval_tap $? 39 'VersionCheckHandler' test.out


# remove artifacts
rm -f "$CLI_TOKEN_FILE"
rm -f "$TEMP_JSON_INPUT"
rm -f "$TEMP_FILE_UPLOAD"

exit $EXIT_CODE