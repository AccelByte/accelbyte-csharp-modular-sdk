// Copyright (c) 2022-2026 AccelByte Inc. All Rights Reserved.
// This is licensed software from AccelByte Inc, for limitations
// and restrictions contact your company contract manager.

// This code is generated by tool. DO NOT EDIT.

using System;
using System.Collections.Generic;
using System.Text;
using System.Text.Json;
using System.Net;
using System.Net.Http;
using System.IO;
using System.Threading.Tasks;

using AccelByte.Sdk.Core;
using AccelByte.Sdk.Core.Net.Http;

using AccelByte.Sdk.Api.Platform.Model;

namespace AccelByte.Sdk.Api.Platform.Operation
{
    /// <summary>
    /// refundPaymentOrderByDedicated
    ///
    ///  [Not supported yet in AGS Shared Cloud]
    /// 
    /// This API is used to refund payment order by paymentOrderNo from non justice service. e.g. dedicated server.
    /// 
    ///   * if the status field of response json is "REFUNDED", usually wallet paid, it indicates payment order already refunded
    ///   * if the status field of response json is "REFUNDING", usually real money paid, platform will send notification to registered notify url once refund successfully
    /// 
    /// 
    /// 
    /// Path Parameter:
    /// 
    /// 
    ///      Parameter     | Type   | Required | Description
    ///     ---------------|--------|----------|-----------------------------------------
    ///     namespace      | String | Yes      | Namespace that payment order resides in
    ///     paymentOrderNo | String | Yes      | Payment order number
    /// 
    /// 
    /// 
    ///  Request Body Parameters:
    /// 
    /// 
    ///      Parameter  | Type   | Required | Description
    ///     ------------|--------|----------|--------------------
    ///     description | String | Yes      | Refund description
    /// 
    /// 
    /// 
    ///  Request Body Example:
    /// 
    /// 
    ///     {
    /// 
    ///                "description": "Repeated item."
    /// 
    ///     }
    /// 
    /// `
    /// 
    /// #### Refund Notification:
    /// 
    /// It will send notification to configured web hook after refund successfully, http status code should return 200 or 204 once you resolve notification successfully, otherwise payment system will retry notification in interval
    /// 
    ///  Refund notification parameter:
    /// 
    /// 
    ///      Parameter | Type   | Required | Description
    ///     -----------|--------|----------|------------------------------------------------
    ///     payload    | String | Yes      | Refund notification payload in json string
    ///     sign       | String | Yes      | sha1 hex signature for payload and private key
    /// 
    /// 
    /// 
    ///  Refund notification Example:
    /// 
    /// 
    ///     {
    /// 
    ///            "payload": "{
    ///                "type": "payment",
    ///                "nonceStr": "34c1dcf3eb58455eb161465bbfc0b590",
    ///                "paymentOrderNo": "18081239088",
    ///                "namespace": "accelbyte",
    ///                "targetNamespace": "game1",
    ///                "targetUserId": "94451623768940d58416ca33ca767ec3",
    ///                "extOrderNo": "123456789",
    ///                "sku": "sku",
    ///                "extUserId": "678",
    ///                "price": 100,
    ///                "paymentProvider": "XSOLLA",
    ///                "vat": 0,
    ///                "salesTax": 0,
    ///                "paymentProviderFee": 0,
    ///                "paymentMethodFee": 0,
    ///                "currency": {
    ///                        "currencyCode": "USD",
    ///                        "currencySymbol": "$",
    ///                        "currencyType": "REAL",
    ///                        "namespace": "accelbyte",
    ///                        "decimals": 2
    ///                    },
    ///                "status": "REFUNDED",
    ///                "createdTime": "2018-07-28T00:39:16.274Z",
    ///                "chargedTime": "2018-07-28T00:39:16.274Z",
    ///                "refundedTime": "2018-07-28T00:39:16.274Z"
    ///            }",
    /// 
    ///            "sign":"e31fb92516cc9faaf50ad70343e1293acec6f3d5"
    /// 
    ///     }
    /// 
    /// `
    /// 
    ///  Refund notification payload parameter list:
    /// 
    /// 
    ///      Parameter         | Type     | Required | Description
    ///     -------------------|----------|----------|--------------------------------------------------------------------------------------
    ///     type               | String   | Yes      | Notification type: 'payment'
    ///     paymentOrderNo     | String   | Yes      | Payment system generated order number
    ///     extOrderNo         | String   | No       | External order number that passed by invoker
    ///     namespace          | String   | Yes      | Namespace that related payment order resides in
    ///     targetNamespace    | String   | Yes      | The game namespace
    ///     targetUserId       | String   | Yes      | The user id in game namespace
    ///     sku                | String   | No       | Item identify, it will return if pass it when create payment
    ///     extUserId          | String   | No       | External user id, can be character id, it will return if pass it when create payment
    ///     price              | int      | Yes      | Price of item
    ///     paymentProvider    | String   | Yes      | Payment provider: xsolla/alipay/wxpay/wallet
    ///     vat                | int      | Yes      | Payment order VAT
    ///     salesTax           | int      | Yes      | Payment order sales tax
    ///     paymentProviderFee | int      | Yes      | Payment provider fee
    ///     paymentMethodFee   | int      | Yes      | Payment method fee
    ///     currency           | Map      | Yes      | Payment order currency info
    ///     status             | String   | Yes      | Payment order status
    ///     statusReason       | String   | No       | Payment order refund status reason
    ///     createdTime        | Datetime | No       | The time of the order created
    ///     chargedTime        | Datetime | No       | The time of the order charged
    ///     refundedTime       | Datetime | No       | The time of the order refunded
    ///     customParameters   | Map      | No       | custom parameters, will return if pass it when create payment
    ///     nonceStr           | String   | Yes      | Random string, max length is 32,
    /// 
    /// 
    /// 
    /// Currency info parameter list:
    /// 
    /// 
    ///      Parameter     | Type   | Required | Description
    ///     ---------------|--------|----------|-----------------------------
    ///     currencyCode   | String | Yes      | Currency Code
    ///     currencySymbol | String | Yes      | Currency Symbol
    ///     currencyType   | String | Yes      | Currency type(REAL/VIRTUAL)
    ///     namespace      | String | Yes      | Currency namespace
    ///     decimals       | int    | Yes      | Currency decimals
    /// 
    /// 
    /// 
    /// #### Encryption Rule:
    /// 
    /// Concat payload json string and private key and then do sha1Hex.
    /// 
    /// #### Other detail info:
    /// 
    ///   * Token type : client token
    ///   *  cross namespace allowed
    /// </summary>
    public class RefundPaymentOrderByDedicated : AccelByte.Sdk.Core.Operation
    {
        #region Builder Part
        public static RefundPaymentOrderByDedicatedBuilder Builder { get => new RefundPaymentOrderByDedicatedBuilder(); }

        public interface IRefundPaymentOrderByDedicatedBuilder
        {





        }

        public abstract class RefundPaymentOrderByDedicatedAbstractBuilder<TImpl>
            : OperationBuilder<TImpl>, IRefundPaymentOrderByDedicatedBuilder
            where TImpl : RefundPaymentOrderByDedicatedAbstractBuilder<TImpl>
        {





            public RefundPaymentOrderByDedicatedAbstractBuilder() { }

            public RefundPaymentOrderByDedicatedAbstractBuilder(IAccelByteSdk sdk)
            {
                _Sdk = sdk;
            }






            public RefundPaymentOrderByDedicated Build(
                PaymentOrderRefund body,
                string namespace_,
                string paymentOrderNo
            )
            {
                RefundPaymentOrderByDedicated op = new RefundPaymentOrderByDedicated(this,
                    body,                    
                    namespace_,                    
                    paymentOrderNo                    
                );

                op.SetBaseFields<TImpl>(this);
                return op;
            }

            protected RefundPaymentOrderByDedicated.Response InternalExecute(
                PaymentOrderRefund body,
                string namespace_,
                string paymentOrderNo
            )
            {
                RefundPaymentOrderByDedicated op = Build(
                    body,
                    namespace_,
                    paymentOrderNo
                );

                if (_Sdk == null)
                    throw IncompleteComponentException.NoSdkObject;

                var response = _Sdk.RunRequest(op);
                return op.ParseResponse(
                    response.Code, 
                    response.ContentType,
                    response.Payload);
            }
            protected async Task<RefundPaymentOrderByDedicated.Response> InternalExecuteAsync(
                PaymentOrderRefund body,
                string namespace_,
                string paymentOrderNo
            )
            {
                RefundPaymentOrderByDedicated op = Build(
                    body,
                    namespace_,
                    paymentOrderNo
                );

                if (_Sdk == null)
                    throw IncompleteComponentException.NoSdkObject;

                var response = await _Sdk.RunRequestAsync(op);
                return op.ParseResponse(
                    response.Code, 
                    response.ContentType,
                    response.Payload);
            }
        }

        public class RefundPaymentOrderByDedicatedBuilder : RefundPaymentOrderByDedicatedAbstractBuilder<RefundPaymentOrderByDedicatedBuilder>
        {
            public RefundPaymentOrderByDedicatedBuilder() : base() { }

            public RefundPaymentOrderByDedicatedBuilder(IAccelByteSdk sdk) : base(sdk) { }

            public RefundPaymentOrderByDedicated.Response Execute(
                PaymentOrderRefund body,
                string namespace_,
                string paymentOrderNo
            )
            {
                return InternalExecute(
                    body,
                    namespace_,
                    paymentOrderNo
                );
            }
            public async Task<RefundPaymentOrderByDedicated.Response> ExecuteAsync(
                PaymentOrderRefund body,
                string namespace_,
                string paymentOrderNo
            )
            {
                return await InternalExecuteAsync(
                    body,
                    namespace_,
                    paymentOrderNo
                );
            }
        }


        public RefundPaymentOrderByDedicated(IRefundPaymentOrderByDedicatedBuilder builder,
            PaymentOrderRefund body,
            string namespace_,
            string paymentOrderNo
        )
        {
            PathParams["namespace"] = namespace_;
            PathParams["paymentOrderNo"] = paymentOrderNo;
            
            

            
            
            BodyParams = body;
            

            Securities.Add(AccelByte.Sdk.Core.Operation.SECURITY_BEARER);
        }
        #endregion

        #region Response Part        
        public class Response : ApiResponse<Model.PaymentOrderRefundResult>
        {

            public ErrorEntity? Error404 { get; set; } = null;

            public ErrorEntity? Error409 { get; set; } = null;

            public ValidationErrorEntity? Error422 { get; set; } = null;


            protected override string GetFullOperationId() => "Platform::PaymentDedicated::RefundPaymentOrderByDedicated";
        }

        #endregion

        public RefundPaymentOrderByDedicated(
            string namespace_,            
            string paymentOrderNo,            
            Model.PaymentOrderRefund body            
        )
        {
            PathParams["namespace"] = namespace_;
            PathParams["paymentOrderNo"] = paymentOrderNo;
            
            

            
            
            BodyParams = body;
            

            Securities.Add(AccelByte.Sdk.Core.Operation.SECURITY_BEARER);
        }

        public override string Path => "/platform/admin/namespaces/{namespace}/payment/orders/{paymentOrderNo}/refund";

        public override HttpMethod Method => HttpMethod.Put;

        public override List<string> Consumes => new() { "application/json" };

        public override List<string> Produces => new() { "application/json" };
        
        public RefundPaymentOrderByDedicated.Response ParseResponse(HttpStatusCode code, string contentType, Stream payload)
        {
            var response = new RefundPaymentOrderByDedicated.Response()
            {
                StatusCode = code,
                ContentType = contentType
            };

            if (code == (HttpStatusCode)204)
            {
                response.IsSuccess = true;
            }
            else if ((code == (HttpStatusCode)201) || (code == (HttpStatusCode)202) || (code == (HttpStatusCode)200))
            {
                response.Payload = payload.ReadToString();
                response.Data = JsonSerializer.Deserialize<Model.PaymentOrderRefundResult>(response.Payload, ResponseJsonOptions);
                response.IsSuccess = true;
            }
            else if (code == (HttpStatusCode)404)
            {
                response.Payload = payload.ReadToString();
                response.Error404 = JsonSerializer.Deserialize<ErrorEntity>(response.Payload, ResponseJsonOptions);
                response.Error = response.Error404!.TranslateToApiError();
            }
            else if (code == (HttpStatusCode)409)
            {
                response.Payload = payload.ReadToString();
                response.Error409 = JsonSerializer.Deserialize<ErrorEntity>(response.Payload, ResponseJsonOptions);
                response.Error = response.Error409!.TranslateToApiError();
            }
            else if (code == (HttpStatusCode)422)
            {
                response.Payload = payload.ReadToString();
                response.Error422 = JsonSerializer.Deserialize<ValidationErrorEntity>(response.Payload, ResponseJsonOptions);
                response.Error = response.Error422!.TranslateToApiError();
            }

            return response;
        }
    }

}